<!DOCTYPE html>

<html>
<head>
  <title>Cascade mixin</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="../core/animation-loop.html">
                  ./source/core/animation-loop.js
                </a>
              
                
                <a class="source" href="../core/display-cycle.html">
                  ./source/core/display-cycle.js
                </a>
              
                
                <a class="source" href="../core/document-root-elements.html">
                  ./source/core/document-root-elements.js
                </a>
              
                
                <a class="source" href="../core/document.html">
                  ./source/core/document.js
                </a>
              
                
                <a class="source" href="../core/events.html">
                  ./source/core/events.js
                </a>
              
                
                <a class="source" href="../core/init.html">
                  ./source/core/init.js
                </a>
              
                
                <a class="source" href="../core/library.html">
                  ./source/core/library.js
                </a>
              
                
                <a class="source" href="../core/random-seed.html">
                  ./source/core/random-seed.js
                </a>
              
                
                <a class="source" href="../core/shared-vars.html">
                  ./source/core/shared-vars.js
                </a>
              
                
                <a class="source" href="../core/snippets.html">
                  ./source/core/snippets.js
                </a>
              
                
                <a class="source" href="../core/system-flags.html">
                  ./source/core/system-flags.js
                </a>
              
                
                <a class="source" href="../core/user-interaction.html">
                  ./source/core/user-interaction.js
                </a>
              
                
                <a class="source" href="../core/utilities.html">
                  ./source/core/utilities.js
                </a>
              
                
                <a class="source" href="../core/workstore.html">
                  ./source/core/workstore.js
                </a>
              
                
                <a class="source" href="../factory/action.html">
                  ./source/factory/action.js
                </a>
              
                
                <a class="source" href="../factory/anchor.html">
                  ./source/factory/anchor.js
                </a>
              
                
                <a class="source" href="../factory/animation.html">
                  ./source/factory/animation.js
                </a>
              
                
                <a class="source" href="../factory/array-pool.html">
                  ./source/factory/array-pool.js
                </a>
              
                
                <a class="source" href="../factory/bezier.html">
                  ./source/factory/bezier.js
                </a>
              
                
                <a class="source" href="../factory/block.html">
                  ./source/factory/block.js
                </a>
              
                
                <a class="source" href="../factory/button.html">
                  ./source/factory/button.js
                </a>
              
                
                <a class="source" href="../factory/canvas.html">
                  ./source/factory/canvas.js
                </a>
              
                
                <a class="source" href="../factory/cell-fragment.html">
                  ./source/factory/cell-fragment.js
                </a>
              
                
                <a class="source" href="../factory/cell.html">
                  ./source/factory/cell.js
                </a>
              
                
                <a class="source" href="../factory/cog.html">
                  ./source/factory/cog.js
                </a>
              
                
                <a class="source" href="../factory/color.html">
                  ./source/factory/color.js
                </a>
              
                
                <a class="source" href="../factory/conic-gradient.html">
                  ./source/factory/conic-gradient.js
                </a>
              
                
                <a class="source" href="../factory/coordinate.html">
                  ./source/factory/coordinate.js
                </a>
              
                
                <a class="source" href="../factory/crescent.html">
                  ./source/factory/crescent.js
                </a>
              
                
                <a class="source" href="../factory/drag-zone.html">
                  ./source/factory/drag-zone.js
                </a>
              
                
                <a class="source" href="../factory/element.html">
                  ./source/factory/element.js
                </a>
              
                
                <a class="source" href="../factory/emitter.html">
                  ./source/factory/emitter.js
                </a>
              
                
                <a class="source" href="../factory/filter-engine-bluenoise-data.html">
                  ./source/factory/filter-engine-bluenoise-data.js
                </a>
              
                
                <a class="source" href="../factory/filter-engine.html">
                  ./source/factory/filter-engine.js
                </a>
              
                
                <a class="source" href="../factory/filter.html">
                  ./source/factory/filter.js
                </a>
              
                
                <a class="source" href="../factory/font-attributes.html">
                  ./source/factory/font-attributes.js
                </a>
              
                
                <a class="source" href="../factory/gradient.html">
                  ./source/factory/gradient.js
                </a>
              
                
                <a class="source" href="../factory/grid.html">
                  ./source/factory/grid.js
                </a>
              
                
                <a class="source" href="../factory/group.html">
                  ./source/factory/group.js
                </a>
              
                
                <a class="source" href="../factory/image-asset.html">
                  ./source/factory/image-asset.js
                </a>
              
                
                <a class="source" href="../factory/keyboard-zone.html">
                  ./source/factory/keyboard-zone.js
                </a>
              
                
                <a class="source" href="../factory/line-spiral.html">
                  ./source/factory/line-spiral.js
                </a>
              
                
                <a class="source" href="../factory/line.html">
                  ./source/factory/line.js
                </a>
              
                
                <a class="source" href="../factory/loom.html">
                  ./source/factory/loom.js
                </a>
              
                
                <a class="source" href="../factory/mesh.html">
                  ./source/factory/mesh.js
                </a>
              
                
                <a class="source" href="../factory/net.html">
                  ./source/factory/net.js
                </a>
              
                
                <a class="source" href="../factory/noise-asset.html">
                  ./source/factory/noise-asset.js
                </a>
              
                
                <a class="source" href="../factory/observe-update.html">
                  ./source/factory/observe-update.js
                </a>
              
                
                <a class="source" href="../factory/oval.html">
                  ./source/factory/oval.js
                </a>
              
                
                <a class="source" href="../factory/palette.html">
                  ./source/factory/palette.js
                </a>
              
                
                <a class="source" href="../factory/particle-force.html">
                  ./source/factory/particle-force.js
                </a>
              
                
                <a class="source" href="../factory/particle-history.html">
                  ./source/factory/particle-history.js
                </a>
              
                
                <a class="source" href="../factory/particle-spring.html">
                  ./source/factory/particle-spring.js
                </a>
              
                
                <a class="source" href="../factory/particle-world.html">
                  ./source/factory/particle-world.js
                </a>
              
                
                <a class="source" href="../factory/particle.html">
                  ./source/factory/particle.js
                </a>
              
                
                <a class="source" href="../factory/pattern.html">
                  ./source/factory/pattern.js
                </a>
              
                
                <a class="source" href="../factory/phrase.html">
                  ./source/factory/phrase.js
                </a>
              
                
                <a class="source" href="../factory/picture.html">
                  ./source/factory/picture.js
                </a>
              
                
                <a class="source" href="../factory/polygon.html">
                  ./source/factory/polygon.js
                </a>
              
                
                <a class="source" href="../factory/polyline.html">
                  ./source/factory/polyline.js
                </a>
              
                
                <a class="source" href="../factory/quadratic.html">
                  ./source/factory/quadratic.js
                </a>
              
                
                <a class="source" href="../factory/quaternion.html">
                  ./source/factory/quaternion.js
                </a>
              
                
                <a class="source" href="../factory/radial-gradient.html">
                  ./source/factory/radial-gradient.js
                </a>
              
                
                <a class="source" href="../factory/raw-asset.html">
                  ./source/factory/raw-asset.js
                </a>
              
                
                <a class="source" href="../factory/reaction-diffusion-asset.html">
                  ./source/factory/reaction-diffusion-asset.js
                </a>
              
                
                <a class="source" href="../factory/rectangle.html">
                  ./source/factory/rectangle.js
                </a>
              
                
                <a class="source" href="../factory/render-animation.html">
                  ./source/factory/render-animation.js
                </a>
              
                
                <a class="source" href="../factory/shape.html">
                  ./source/factory/shape.js
                </a>
              
                
                <a class="source" href="../factory/spiral.html">
                  ./source/factory/spiral.js
                </a>
              
                
                <a class="source" href="../factory/sprite-asset.html">
                  ./source/factory/sprite-asset.js
                </a>
              
                
                <a class="source" href="../factory/stack.html">
                  ./source/factory/stack.js
                </a>
              
                
                <a class="source" href="../factory/star.html">
                  ./source/factory/star.js
                </a>
              
                
                <a class="source" href="../factory/state.html">
                  ./source/factory/state.js
                </a>
              
                
                <a class="source" href="../factory/tetragon.html">
                  ./source/factory/tetragon.js
                </a>
              
                
                <a class="source" href="../factory/ticker.html">
                  ./source/factory/ticker.js
                </a>
              
                
                <a class="source" href="../factory/tracer.html">
                  ./source/factory/tracer.js
                </a>
              
                
                <a class="source" href="../factory/tween.html">
                  ./source/factory/tween.js
                </a>
              
                
                <a class="source" href="../factory/unstacked-element.html">
                  ./source/factory/unstacked-element.js
                </a>
              
                
                <a class="source" href="../factory/vector.html">
                  ./source/factory/vector.js
                </a>
              
                
                <a class="source" href="../factory/video-asset.html">
                  ./source/factory/video-asset.js
                </a>
              
                
                <a class="source" href="../factory/wheel.html">
                  ./source/factory/wheel.js
                </a>
              
                
                <a class="source" href="anchor.html">
                  ./source/mixin/anchor.js
                </a>
              
                
                <a class="source" href="asset-advanced-functionality.html">
                  ./source/mixin/asset-advanced-functionality.js
                </a>
              
                
                <a class="source" href="asset-consumer.html">
                  ./source/mixin/asset-consumer.js
                </a>
              
                
                <a class="source" href="asset.html">
                  ./source/mixin/asset.js
                </a>
              
                
                <a class="source" href="base.html">
                  ./source/mixin/base.js
                </a>
              
                
                <a class="source" href="button.html">
                  ./source/mixin/button.js
                </a>
              
                
                <a class="source" href="cascade.html">
                  ./source/mixin/cascade.js
                </a>
              
                
                <a class="source" href="cell-key-functions.html">
                  ./source/mixin/cell-key-functions.js
                </a>
              
                
                <a class="source" href="delta.html">
                  ./source/mixin/delta.js
                </a>
              
                
                <a class="source" href="display-shape.html">
                  ./source/mixin/display-shape.js
                </a>
              
                
                <a class="source" href="dom.html">
                  ./source/mixin/dom.js
                </a>
              
                
                <a class="source" href="entity.html">
                  ./source/mixin/entity.js
                </a>
              
                
                <a class="source" href="filter.html">
                  ./source/mixin/filter.js
                </a>
              
                
                <a class="source" href="hiddenDomElements.html">
                  ./source/mixin/hiddenDomElements.js
                </a>
              
                
                <a class="source" href="mimic.html">
                  ./source/mixin/mimic.js
                </a>
              
                
                <a class="source" href="path.html">
                  ./source/mixin/path.js
                </a>
              
                
                <a class="source" href="pattern.html">
                  ./source/mixin/pattern.js
                </a>
              
                
                <a class="source" href="pivot.html">
                  ./source/mixin/pivot.js
                </a>
              
                
                <a class="source" href="position.html">
                  ./source/mixin/position.js
                </a>
              
                
                <a class="source" href="shape-basic.html">
                  ./source/mixin/shape-basic.js
                </a>
              
                
                <a class="source" href="shape-curve.html">
                  ./source/mixin/shape-curve.js
                </a>
              
                
                <a class="source" href="shape-path-calculation.html">
                  ./source/mixin/shape-path-calculation.js
                </a>
              
                
                <a class="source" href="styles.html">
                  ./source/mixin/styles.js
                </a>
              
                
                <a class="source" href="tween.html">
                  ./source/mixin/tween.js
                </a>
              
                
                <a class="source" href="../scrawl.html">
                  ./source/scrawl.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-1">&#x00a7;</a>
              </div>
              <h1 id="cascade-mixin">Cascade mixin</h1>
<p>This mixin sets up the Scrawl-canvas functionality required to perform its <strong>Display cycle</strong>.</p>
<ul>
<li>The Display cycle is initiated by <a href="../factory/stack.html">Stack</a> and DOM-related <a href="../factory/cell.html">Cell</a> wrappers (generally <a href="../factory/canvas.html">Canvas</a> wrappers) - <strong>controller objects</strong></li>
<li>The cycle cascades from the wrappers to all artefact objects associated with them, as mediated by <a href="../factory/group.html">Group</a> objects.</li>
</ul>
<p>The mixin also includes code to assist <strong>drag-and-drop</strong> functionality.</p>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-2">&#x00a7;</a>
              </div>
              <h4 id="imports">Imports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { group } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/library.js&#x27;</span>;

<span class="hljs-keyword">import</span> { mergeOver, pushUnique, removeItem, xtGet, Ωempty } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/utilities.js&#x27;</span>;

<span class="hljs-keyword">import</span> { releaseArray, requestArray } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../factory/array-pool.js&#x27;</span>;

<span class="hljs-keyword">import</span> { _floor, <span class="hljs-variable constant_">ADD_ARTEFACT_CLASSES</span>, <span class="hljs-variable constant_">REMOVE_ARTEFACT_CLASSES</span>, <span class="hljs-variable constant_">REVERSE_BY_DELTA</span>, <span class="hljs-variable constant_">SET_ARTEFACTS</span>, <span class="hljs-variable constant_">UPDATE_ARTEFACTS</span>, <span class="hljs-variable constant_">UPDATE_BY_DELTA</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/shared-vars.js&#x27;</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-3">&#x00a7;</a>
              </div>
              <h4 id="export-function">Export function</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">P = Ωempty</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-4">&#x00a7;</a>
              </div>
              <h4 id="shared-attributes">Shared attributes</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> defaultAttributes = {</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-5">&#x00a7;</a>
              </div>
              <p>The <strong>groups</strong> attribute holds the String names of all the Group objects associated with the controller object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-attr">groups</span>: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-6">&#x00a7;</a>
              </div>
              <p>The <strong>groupBuckets</strong> attribute holds a reference to each Group object, in a set of arrays grouping Groups according to their order values.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-attr">groupBuckets</span>: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-7">&#x00a7;</a>
              </div>
              <p>The <strong>batchResort</strong> Boolean flag determines whether the Groups will be sorted by their order value before instructions get passed to each in sequence. Best to leave this flag alone to do its job.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-attr">batchResort</span>: <span class="hljs-literal">true</span>,
    };
    P.<span class="hljs-property">defs</span> = <span class="hljs-title function_">mergeOver</span>(P.<span class="hljs-property">defs</span>, defaultAttributes);</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-8">&#x00a7;</a>
              </div>
              <h4 id="packet-management">Packet management</h4>
<p>No additional packet functionality required</p>

            </div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-9">&#x00a7;</a>
              </div>
              <h4 id="clone-management">Clone management</h4>
<p>No additional clone functionality required</p>

            </div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-10">&#x00a7;</a>
              </div>
              <h4 id="kill-management">Kill management</h4>
<p>No additional kill functionality required</p>

            </div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-11">&#x00a7;</a>
              </div>
              <h4 id="get-set-deltaset">Get, Set, deltaSet</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> G = P.<span class="hljs-property">getters</span>,
        S = P.<span class="hljs-property">setters</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-12">&#x00a7;</a>
              </div>
              <p><strong>groups</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    G.<span class="hljs-property">groups</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

        <span class="hljs-keyword">return</span> [].<span class="hljs-title function_">concat</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">groups</span>);
    };

    S.<span class="hljs-property">groups</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

        <span class="hljs-variable language_">this</span>.<span class="hljs-property">groups</span>.<span class="hljs-property">length</span> = <span class="hljs-number">0</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addGroups</span>(item);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-13">&#x00a7;</a>
              </div>
              <h4 id="prototype-functions">Prototype functions</h4>

            </div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-14">&#x00a7;</a>
              </div>
              <p><code>sortGroups</code> - internal function - Groups are sorted from the <strong>groups</strong> Array into the <strong>groupBuckets</strong> array using a bespoke bucket sort algorithm, based on each Group object’s <strong>order</strong> attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.<span class="hljs-property">sortGroups</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">batchResort</span>) {

            <span class="hljs-variable language_">this</span>.<span class="hljs-property">batchResort</span> = <span class="hljs-literal">false</span>;

            <span class="hljs-keyword">const</span> {groups, groupBuckets} = <span class="hljs-variable language_">this</span>;
            <span class="hljs-keyword">const</span> buckets = <span class="hljs-title function_">requestArray</span>();

            <span class="hljs-keyword">let</span> i, iz, obj, name, order, arr;

            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = groups.<span class="hljs-property">length</span>; i &lt; iz; i++) {

                name = groups[i];
                obj = group[name];

                <span class="hljs-keyword">if</span> (obj) {

                    order = <span class="hljs-title function_">_floor</span>(obj.<span class="hljs-property">order</span>) || <span class="hljs-number">0</span>;

                    <span class="hljs-keyword">if</span> (!buckets[order]) buckets[order] = <span class="hljs-title function_">requestArray</span>();

                    buckets[order].<span class="hljs-title function_">push</span>(obj);
                }
            }
            groupBuckets.<span class="hljs-property">length</span> = <span class="hljs-number">0</span>;

            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = buckets.<span class="hljs-property">length</span>; i &lt; iz; i++) {

                arr = buckets[i];

                <span class="hljs-keyword">if</span> (arr) {

                    groupBuckets.<span class="hljs-title function_">push</span>(...arr);
                    <span class="hljs-title function_">releaseArray</span>(arr);
                }
            }
            <span class="hljs-title function_">releaseArray</span>(buckets);
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-15">&#x00a7;</a>
              </div>
              <p><code>initializeCascade</code> - internal function used by factory constructors</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.<span class="hljs-property">initializeCascade</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

        <span class="hljs-variable language_">this</span>.<span class="hljs-property">groups</span> = [];
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">groupBuckets</span> = [];
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-16">&#x00a7;</a>
              </div>
              <h5 id="group-management">Group management</h5>
<p>Groups should be added to, and removed from, the controller object using the <strong>addGroups</strong> and <strong>removeGroups</strong> functions. The argument can be one or more Group object’s name attribute, or the Group object(s) itself.</p>

            </div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-17">&#x00a7;</a>
              </div>
              <p><code>addGroups</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.<span class="hljs-property">addGroups</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) {

        <span class="hljs-keyword">const</span> groups = <span class="hljs-variable language_">this</span>.<span class="hljs-property">groups</span>;

        args.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {

            <span class="hljs-keyword">if</span> (item.<span class="hljs-property">substring</span>) <span class="hljs-title function_">pushUnique</span>(groups, item);
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (group[item]) <span class="hljs-title function_">pushUnique</span>(groups, item.<span class="hljs-property">name</span>);

        }, <span class="hljs-variable language_">this</span>);

        <span class="hljs-variable language_">this</span>.<span class="hljs-property">batchResort</span> = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-18">&#x00a7;</a>
              </div>
              <p><code>removeGroups</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.<span class="hljs-property">removeGroups</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) {

        <span class="hljs-keyword">const</span> groups = <span class="hljs-variable language_">this</span>.<span class="hljs-property">groups</span>;

        args.<span class="hljs-title function_">forEach</span>( <span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {

            <span class="hljs-keyword">if</span> (item.<span class="hljs-property">substring</span>) <span class="hljs-title function_">removeItem</span>(groups, item);
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (group[item]) <span class="hljs-title function_">removeItem</span>(groups, item.<span class="hljs-property">name</span>);

        }, <span class="hljs-variable language_">this</span>);

        <span class="hljs-variable language_">this</span>.<span class="hljs-property">batchResort</span> = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-19">&#x00a7;</a>
              </div>
              <p><code>cascadeAction</code> - internal helper function used by the functions below</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.<span class="hljs-property">cascadeAction</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">items, action</span>) {

        <span class="hljs-keyword">let</span> g;

        <span class="hljs-variable language_">this</span>.<span class="hljs-property">groups</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> {

            g = group[name];

            <span class="hljs-keyword">if</span> (g) g[action](items);

        }, <span class="hljs-variable language_">this</span>);

        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-20">&#x00a7;</a>
              </div>
              <p><code>updateArtefacts</code> - Update all artefact objects in all the controller object’s Groups. The supplied argument will be passed on to each artefact’s <code>setDelta</code> function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.<span class="hljs-property">updateArtefacts</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) {

        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cascadeAction</span>(items, <span class="hljs-variable constant_">UPDATE_ARTEFACTS</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-21">&#x00a7;</a>
              </div>
              <p><code>updateArtefacts</code> - Set all artefact objects in all the controller object’s Groups. The supplied argument will be passed on to each artefact’s <code>set</code> functions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.<span class="hljs-property">setArtefacts</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) {

        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cascadeAction</span>(items, <span class="hljs-variable constant_">SET_ARTEFACTS</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-22">&#x00a7;</a>
              </div>
              <p><code>addArtefactClasses</code> - specific to DOM-related artefacts (Stack, Canvas, Element)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.<span class="hljs-property">addArtefactClasses</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) {

        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cascadeAction</span>(items, <span class="hljs-variable constant_">ADD_ARTEFACT_CLASSES</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-23">&#x00a7;</a>
              </div>
              <p><code>removeArtefactClasses</code> - specific to DOM-related artefacts (Stack, Canvas, Element)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.<span class="hljs-property">removeArtefactClasses</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) {

        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cascadeAction</span>(items, <span class="hljs-variable constant_">REMOVE_ARTEFACT_CLASSES</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-24">&#x00a7;</a>
              </div>
              <p><code>updateByDelta</code> - triggers the related artefact function, to update (add) its attributes by values held in its <code>delta</code> object attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.<span class="hljs-property">updateByDelta</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cascadeAction</span>(<span class="hljs-literal">false</span>, <span class="hljs-variable constant_">UPDATE_BY_DELTA</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-25">&#x00a7;</a>
              </div>
              <p><code>reverseByDelta</code> - triggers the related artefact function, to reverse (subtract) its attributes by values held in its <code>delta</code> object attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.<span class="hljs-property">reverseByDelta</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cascadeAction</span>(<span class="hljs-literal">false</span>, <span class="hljs-variable constant_">REVERSE_BY_DELTA</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-26">&#x00a7;</a>
              </div>
              <h5 id="collision-detection">Collision detection</h5>
<p>The <code>getArtefactAt</code> function checks to see if any of the controller object’s Groups’ artefacts are located at the supplied coordinates in the argument object.</p>
<ul>
<li>The first artefact to report back as being at that coordinate will be returned by the function</li>
<li>Where no artefacts are present at that coordinate the function returns false.</li>
<li>The artefact with the highest order attribute value will be returned first.</li>
<li>This function forms part of the Scrawl-canvas <strong>drag-and-drop</strong> functionality.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.<span class="hljs-property">getArtefactAt</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) {

        items = <span class="hljs-title function_">xtGet</span>(items, <span class="hljs-variable language_">this</span>.<span class="hljs-property">here</span>, <span class="hljs-literal">false</span>);

        <span class="hljs-keyword">if</span> (items) {

            <span class="hljs-keyword">let</span> g, res;

            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-variable language_">this</span>.<span class="hljs-property">groups</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {

                g = group[<span class="hljs-variable language_">this</span>.<span class="hljs-property">groups</span>[i]];

                <span class="hljs-keyword">if</span> (g) {

                    res = g.<span class="hljs-title function_">getArtefactAt</span>(items);

                    <span class="hljs-keyword">if</span> (res) <span class="hljs-keyword">return</span> res;
                }
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-27">&#x00a7;</a>
              </div>
              <p>The <code>getAllArtefactsAt</code> function returns all of the controller object’s Groups’ artefacts located at the supplied coordinates in the argument object.</p>
<ul>
<li>The artefact with the highest order attribute value will be returned first.</li>
<li>The function will always return an array of artefact objects, or an empty Array</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.<span class="hljs-property">getAllArtefactsAt</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) {

        items = <span class="hljs-title function_">xtGet</span>(items, <span class="hljs-variable language_">this</span>.<span class="hljs-property">here</span>, <span class="hljs-literal">false</span>);

        <span class="hljs-keyword">const</span> results = [];

        <span class="hljs-keyword">if</span> (items) {

            <span class="hljs-keyword">let</span> g, res;

            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-variable language_">this</span>.<span class="hljs-property">groups</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {

                g = group[<span class="hljs-variable language_">this</span>.<span class="hljs-property">groups</span>[i]];

                <span class="hljs-keyword">if</span> (g) {

                    res = g.<span class="hljs-title function_">getAllArtefactsAt</span>(items);

                    <span class="hljs-keyword">if</span> (res) results.<span class="hljs-title function_">push</span>(...res);
                }
            }
        }
        <span class="hljs-keyword">return</span> results;
    };
}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
