<!DOCTYPE html>

<html>
<head>
  <title>FontAttributes factory</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <link rel="stylesheet" media="all" href="../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="../core/animationloop.html">
                  ./source/core/animationloop.js
                </a>
              
                
                <a class="source" href="../core/component.html">
                  ./source/core/component.js
                </a>
              
                
                <a class="source" href="../core/document.html">
                  ./source/core/document.js
                </a>
              
                
                <a class="source" href="../core/events.html">
                  ./source/core/events.js
                </a>
              
                
                <a class="source" href="../core/init.html">
                  ./source/core/init.js
                </a>
              
                
                <a class="source" href="../core/library.html">
                  ./source/core/library.js
                </a>
              
                
                <a class="source" href="../core/userInteraction.html">
                  ./source/core/userInteraction.js
                </a>
              
                
                <a class="source" href="../core/utilities.html">
                  ./source/core/utilities.js
                </a>
              
                
                <a class="source" href="action.html">
                  ./source/factory/action.js
                </a>
              
                
                <a class="source" href="anchor.html">
                  ./source/factory/anchor.js
                </a>
              
                
                <a class="source" href="animation.html">
                  ./source/factory/animation.js
                </a>
              
                
                <a class="source" href="bezier.html">
                  ./source/factory/bezier.js
                </a>
              
                
                <a class="source" href="block.html">
                  ./source/factory/block.js
                </a>
              
                
                <a class="source" href="canvas.html">
                  ./source/factory/canvas.js
                </a>
              
                
                <a class="source" href="cell.html">
                  ./source/factory/cell.js
                </a>
              
                
                <a class="source" href="color.html">
                  ./source/factory/color.js
                </a>
              
                
                <a class="source" href="coordinate.html">
                  ./source/factory/coordinate.js
                </a>
              
                
                <a class="source" href="element.html">
                  ./source/factory/element.js
                </a>
              
                
                <a class="source" href="filter.html">
                  ./source/factory/filter.js
                </a>
              
                
                <a class="source" href="fontAttributes.html">
                  ./source/factory/fontAttributes.js
                </a>
              
                
                <a class="source" href="gradient.html">
                  ./source/factory/gradient.js
                </a>
              
                
                <a class="source" href="grid.html">
                  ./source/factory/grid.js
                </a>
              
                
                <a class="source" href="group.html">
                  ./source/factory/group.js
                </a>
              
                
                <a class="source" href="imageAsset.html">
                  ./source/factory/imageAsset.js
                </a>
              
                
                <a class="source" href="line.html">
                  ./source/factory/line.js
                </a>
              
                
                <a class="source" href="loom.html">
                  ./source/factory/loom.js
                </a>
              
                
                <a class="source" href="oval.html">
                  ./source/factory/oval.js
                </a>
              
                
                <a class="source" href="palette.html">
                  ./source/factory/palette.js
                </a>
              
                
                <a class="source" href="pattern.html">
                  ./source/factory/pattern.js
                </a>
              
                
                <a class="source" href="phrase.html">
                  ./source/factory/phrase.js
                </a>
              
                
                <a class="source" href="picture.html">
                  ./source/factory/picture.js
                </a>
              
                
                <a class="source" href="polygon.html">
                  ./source/factory/polygon.js
                </a>
              
                
                <a class="source" href="polyline.html">
                  ./source/factory/polyline.js
                </a>
              
                
                <a class="source" href="quadratic.html">
                  ./source/factory/quadratic.js
                </a>
              
                
                <a class="source" href="quaternion.html">
                  ./source/factory/quaternion.js
                </a>
              
                
                <a class="source" href="radialGradient.html">
                  ./source/factory/radialGradient.js
                </a>
              
                
                <a class="source" href="rectangle.html">
                  ./source/factory/rectangle.js
                </a>
              
                
                <a class="source" href="renderAnimation.html">
                  ./source/factory/renderAnimation.js
                </a>
              
                
                <a class="source" href="shape.html">
                  ./source/factory/shape.js
                </a>
              
                
                <a class="source" href="spiral.html">
                  ./source/factory/spiral.js
                </a>
              
                
                <a class="source" href="spriteAsset.html">
                  ./source/factory/spriteAsset.js
                </a>
              
                
                <a class="source" href="stack.html">
                  ./source/factory/stack.js
                </a>
              
                
                <a class="source" href="star.html">
                  ./source/factory/star.js
                </a>
              
                
                <a class="source" href="state.html">
                  ./source/factory/state.js
                </a>
              
                
                <a class="source" href="tetragon.html">
                  ./source/factory/tetragon.js
                </a>
              
                
                <a class="source" href="ticker.html">
                  ./source/factory/ticker.js
                </a>
              
                
                <a class="source" href="tween.html">
                  ./source/factory/tween.js
                </a>
              
                
                <a class="source" href="unstackedElement.html">
                  ./source/factory/unstackedElement.js
                </a>
              
                
                <a class="source" href="vector.html">
                  ./source/factory/vector.js
                </a>
              
                
                <a class="source" href="videoAsset.html">
                  ./source/factory/videoAsset.js
                </a>
              
                
                <a class="source" href="wheel.html">
                  ./source/factory/wheel.js
                </a>
              
                
                <a class="source" href="../mixin/anchor.html">
                  ./source/mixin/anchor.js
                </a>
              
                
                <a class="source" href="../mixin/asset.html">
                  ./source/mixin/asset.js
                </a>
              
                
                <a class="source" href="../mixin/assetConsumer.html">
                  ./source/mixin/assetConsumer.js
                </a>
              
                
                <a class="source" href="../mixin/base.html">
                  ./source/mixin/base.js
                </a>
              
                
                <a class="source" href="../mixin/cascade.html">
                  ./source/mixin/cascade.js
                </a>
              
                
                <a class="source" href="../mixin/delta.html">
                  ./source/mixin/delta.js
                </a>
              
                
                <a class="source" href="../mixin/displayShape.html">
                  ./source/mixin/displayShape.js
                </a>
              
                
                <a class="source" href="../mixin/dom.html">
                  ./source/mixin/dom.js
                </a>
              
                
                <a class="source" href="../mixin/entity.html">
                  ./source/mixin/entity.js
                </a>
              
                
                <a class="source" href="../mixin/filter.html">
                  ./source/mixin/filter.js
                </a>
              
                
                <a class="source" href="../mixin/mimic.html">
                  ./source/mixin/mimic.js
                </a>
              
                
                <a class="source" href="../mixin/path.html">
                  ./source/mixin/path.js
                </a>
              
                
                <a class="source" href="../mixin/pattern.html">
                  ./source/mixin/pattern.js
                </a>
              
                
                <a class="source" href="../mixin/pivot.html">
                  ./source/mixin/pivot.js
                </a>
              
                
                <a class="source" href="../mixin/position.html">
                  ./source/mixin/position.js
                </a>
              
                
                <a class="source" href="../mixin/shapeBasic.html">
                  ./source/mixin/shapeBasic.js
                </a>
              
                
                <a class="source" href="../mixin/shapeCurve.html">
                  ./source/mixin/shapeCurve.js
                </a>
              
                
                <a class="source" href="../mixin/shapePathCalculation.html">
                  ./source/mixin/shapePathCalculation.js
                </a>
              
                
                <a class="source" href="../mixin/styles.html">
                  ./source/mixin/styles.js
                </a>
              
                
                <a class="source" href="../mixin/tween.html">
                  ./source/mixin/tween.js
                </a>
              
                
                <a class="source" href="../worker/filter-stringed.html">
                  ./source/worker/filter-stringed.js
                </a>
              
                
                <a class="source" href="../worker/filter.html">
                  ./source/worker/filter.js
                </a>
              
                
                <a class="source" href="../worker/filter_canvas.html">
                  ./source/worker/filter_canvas.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="fontattributes-factory">FontAttributes factory</h1>
<p>FontAttribute objects are used exclusively by <a href="./phrase.html">Phrase</a> entitys. They hold data about the Phrase entity’s current font</p>
<ul>
<li>The constructor uses naming functionality (from the <a href="../mixin/base.html">base</a> mixin), but doesn’t actually store FontAttribute instances in the <a href="../core/library.html">library</a></li>
<li>Instead they are referenced directly from each Phrase instance.</li>
<li>FontAttribute instances get cloned as part of the Phrase stamp functionality (because of subsequent ‘update’ invocations on them). </li>
<li>If we stored FA instances in the library we’d risk running out of memory, or slowing up code speed, as the cloned instances are pretty temporary and get thrown away whenever a new Phrase.set invocation (involving font attributes) happens.</li>
</ul>
<p>The Phrase entity includes functionality to allow the getting and setting of FontAttribute attributes directly on the entity instance.</p>
<p>Note that &lt;canvas&gt; context engines will attempt to display <a href="https://web.dev/variable-fonts/">variable fonts</a>, but the added functionality of those fonts is, for the most part, ignored. Scrawl-canvas makes no overt attempts to overcome this limitation.</p>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h4 id="demos">Demos:</h4>
<ul>
<li>All Phrase-related demos use FontAttribute objects in the background. Developers should never need to deal with them directly</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h4 id="imports">Imports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { constructors } <span class="hljs-keyword">from</span> <span class="hljs-string">'../core/library.js'</span>;
<span class="hljs-keyword">import</span> { mergeOver, xt } <span class="hljs-keyword">from</span> <span class="hljs-string">'../core/utilities.js'</span>;

<span class="hljs-keyword">import</span> { requestCell, releaseCell } <span class="hljs-keyword">from</span> <span class="hljs-string">'./cell.js'</span>;

<span class="hljs-keyword">import</span> baseMix <span class="hljs-keyword">from</span> <span class="hljs-string">'../mixin/base.js'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h4 id="fontattributes-constructor">FontAttributes constructor</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> FontAttributes = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

    <span class="hljs-keyword">this</span>.makeName(items.name);
    <span class="hljs-keyword">this</span>.set(<span class="hljs-keyword">this</span>.defs);
    <span class="hljs-keyword">this</span>.set(items);

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h4 id="fontattributes-prototype">FontAttributes prototype</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> P = FontAttributes.prototype = <span class="hljs-built_in">Object</span>.create(<span class="hljs-built_in">Object</span>.prototype);
P.type = <span class="hljs-string">'FontAttributes'</span>;
P.lib = <span class="hljs-string">'fontattribute'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h4 id="mixins">Mixins</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>P = baseMix(P);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h4 id="fontattributes-attributes">FontAttributes attributes</h4>
<ul>
<li>Attributes defined in the <a href="../mixin/base.html">base mixin</a>: <strong>name</strong>.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> defaultAttributes = {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p><strong>font-style</strong></p>
<p><em>values:</em> </p>
<ul>
<li><code>normal</code>, <code>italic</code>, <code>oblique</code></li>
</ul>
<p>CANVAS CONTEXT ENGINE - does not handle <code>oblique</code> slope values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    style: <span class="hljs-string">'normal'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p><strong>font-variant</strong> - the standard indicates that canvas context engine should only recognise <code>normal</code> and <code>small-caps</code> values</p>
<p>CANVAS CONTEXT ENGINE - complies with the standard, thus Scrawl-canvas ignores all other possible values. Do not use them in font strings:</p>
<ul>
<li><code>font-variant-caps</code></li>
<li><code>font-variant-numeric</code></li>
<li><code>font-variant-ligatures</code></li>
<li><code>font-variant-east-asian</code></li>
<li><code>font-variant-alternates</code></li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    variant: <span class="hljs-string">'normal'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p><strong>font-weight</strong></p>
<p><em>Values:</em> </p>
<ul>
<li><code>normal</code>, <code>bold</code>, <code>lighter</code>, <code>bolder</code>; or</li>
<li>a number (between 1 and 1000, usually in 100 steps between 100 and 900)</li>
</ul>
<p>(<code>normal</code> translates to 400; <code>bold</code> translates to 700)</p>
<p>CANVAS CONTEXT ENGINE - does seem to recognise both keyword and (x00) number values, but the interpretation of these values can be somewhat erratic. <code>normal</code> and <code>bold</code> keywords are generally respected and actioned as expected.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    weight: <span class="hljs-string">'normal'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p><strong>font-stretch</strong></p>
<p><em>Values:</em> </p>
<ul>
<li><code>normal</code> (default)</li>
<li><code>semi-condensed</code>, <code>condensed</code>, <code>extra-condensed</code>, <code>ultra-condensed</code></li>
<li><code>semi-expanded</code>, <code>expanded</code>, <code>extra-expanded</code>, <code>ultra-expanded</code></li>
</ul>
<p>We ignore number% values (permitted values are 50% - 200%) because the context engine only accepts a single font string and the syntax requirements for that font string are that “font-stretch may only be a single keyword value”</p>
<p>CANVAS CONTEXT ENGINE - doesn’t seem to recognise font-stretch values (for Garamond), but doesn’t choke on their presence either</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    stretch: <span class="hljs-string">'normal'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p><strong>font-size</strong></p>
<p>Standard says: <em>“with the ‘font-size’ component converted to CSS pixels”</em> </p>
<ul>
<li>TODO: hoping this means that canvas font will do this for us, rather than having to convert in code - if not, extract it by sticking an interim css style against the internal &lt;div&gt; to get computed value?</li>
</ul>
<p>Values can be: </p>
<p><em>Absolute or relative string values:</em></p>
<ul>
<li><code>xx-small</code>, <code>x-small</code>, <code>small</code>, <code>medium</code>, <code>large</code>, <code>x-large</code>, <code>xx-large</code> </li>
<li><code>smaller</code>, <code>larger</code></li>
</ul>
<p><em>Length values:</em> </p>
<ul>
<li><code>1.2em</code>, <code>1.2ch</code>, <code>1.2ex</code>, <code>1.2rem</code></li>
<li>(experimental!) <code>1.2cap</code>, <code>1.2ic</code>, <code>1.2lh</code>, <code>1.2rlh</code></li>
<li><code>1.2vh</code>, <code>1.2vw</code>, <code>1.2vmin</code>, <code>1.2vmax</code></li>
<li>(experimental!) <code>1.2vi</code>, <code>1.2vb</code></li>
<li><code>1.2px</code>, <code>1.2cm</code>, <code>1.2mm</code>, <code>1.2in</code>, <code>1.2pc</code>, <code>1.2pt</code></li>
<li>(experimental!) <code>1.2Q</code></li>
</ul>
<p>Note that only the following have wide support; these are the only metrics this code tests for: <code>em</code>, <code>ch</code>, <code>ex</code>, <code>rem</code>, <code>vh</code>, <code>vw</code>, <code>vmin</code>, <code>vmax</code>, <code>px</code>, <code>cm</code>, <code>mm</code>, <code>in</code>, <code>pc</code>, <code>pt</code></p>
<p><em>Percent values:</em> </p>
<ul>
<li><code>1.2%</code></li>
</ul>
<p>(Percent values clash with font-stretch % values - assume any number followed by a % is a font-size value)</p>
<p>GOTCHA NOTE 1: font-size is never a number; it must always have a metric. Tweens should be able to handle this requirement with no issues.</p>
<p>GOTCHA NOTE 2: the canvas context engine refuses to handle line heights appended to the font size value (eg: <code>12px/1.2</code>) and expects all line height values to = <code>normal</code>. Scrawl-canvas handles line height for multiline phrases using an alternative mechanism. Thus including a <code>/lineheight</code> value in a font string may cause <code>Phrase.set</code> functionality to fail in unexpected ways.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    sizeValue: <span class="hljs-number">12</span>,
    <span class="hljs-attr">sizeMetric</span>: <span class="hljs-string">'px'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p><strong>font-family</strong> </p>
<ul>
<li>Always comes at the end of the string. </li>
<li>More than one can be included, with each separated by commas</li>
<li>Be aware that string may often include quotes around font families with spaces in their names.</li>
</ul>
<p>Generic font names have been extended - values include: </p>
<ul>
<li><code>serif</code>, <code>sans-serif</code>, <code>monospace</code>, <code>cursive</code>, <code>fantasy</code>, <code>system-ui</code>, <code>math</code>, <code>emoji</code>, <code>fangsong</code></li>
</ul>
<p>GOTCHA NOTE: current functionality tests the supplied string with the expectation that the font families will be preceded by a font size metric value. To set the fontFamily value direct, put a font size metric at the start of the string - % will do - followed by a space and then the font family string:</p>
<pre><code>phraseInstance.set({
    <span class="hljs-attr">font</span>: <span class="hljs-string">'% "Gill Sans", sans-serif'</span>
})</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>    family: <span class="hljs-string">'sans-serif'</span>,

};
P.defs = mergeOver(P.defs, defaultAttributes);</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <h4 id="packet-management">Packet management</h4>
<p>No additional packet functionality required</p>

            </div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h4 id="clone-management">Clone management</h4>
<p>No additional clone functionality required</p>

            </div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <h4 id="kill-management">Kill management</h4>
<p>No additional kill functionality required</p>

            </div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <h4 id="get-set-deltaset">Get, Set, deltaSet</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> G = P.getters,
    S = P.setters,
    D = P.deltaSetters;</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p><strong>size</strong> - pseudo-attribute </p>
<ul>
<li>getter returns a CSS fontSize String</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>G.size = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>.sizeValue) ? <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">this</span>.sizeValue}</span><span class="hljs-subst">${<span class="hljs-keyword">this</span>.sizeMetric}</span>`</span> : <span class="hljs-keyword">this</span>.sizeMetric;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <ul>
<li>setter breaks the fontSize String into <strong>sizeValue</strong> and <strong>sizeMetric</strong> values</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.size = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (xt(item)) {

        <span class="hljs-keyword">let</span> res, 
            size = <span class="hljs-number">0</span>, 
            metric = <span class="hljs-string">'medium'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Canvas context engine (Chrome on MacBook Pro) interprets this as 9px Garamond</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (item.indexOf(<span class="hljs-string">'xx-small'</span>) &gt;= <span class="hljs-number">0</span>) metric = <span class="hljs-string">'xx-small'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Canvas context engine (Chrome on MacBook Pro) interprets this as 10px Garamond</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.indexOf(<span class="hljs-string">'x-small'</span>) &gt;= <span class="hljs-number">0</span>) metric = <span class="hljs-string">'x-small'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Canvas context engine (Chrome on MacBook Pro) interprets this as 8.33px Garamond</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.indexOf(<span class="hljs-string">'smaller'</span>) &gt;= <span class="hljs-number">0</span>) metric = <span class="hljs-string">'smaller'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Canvas context engine (Chrome on MacBook Pro) interprets this as 13px Garamond</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.indexOf(<span class="hljs-string">'small'</span>) &gt;= <span class="hljs-number">0</span>) metric = <span class="hljs-string">'small'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Canvas context engine (Chrome on MacBook Pro) interprets this as 32px Garamond</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.indexOf(<span class="hljs-string">'xx-large'</span>) &gt;= <span class="hljs-number">0</span>) metric = <span class="hljs-string">'xx-large'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Canvas context engine (Chrome on MacBook Pro) interprets this as 24px Garamond</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.indexOf(<span class="hljs-string">'x-large'</span>) &gt;= <span class="hljs-number">0</span>) metric = <span class="hljs-string">'x-large'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Canvas context engine (Chrome on MacBook Pro) interprets this as 12px Garamond</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.indexOf(<span class="hljs-string">'larger'</span>) &gt;= <span class="hljs-number">0</span>) metric = <span class="hljs-string">'larger'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Canvas context engine (Chrome on MacBook Pro) interprets this as 18px Garamond</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.indexOf(<span class="hljs-string">'large'</span>) &gt;= <span class="hljs-number">0</span>) metric = <span class="hljs-string">'large'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Canvas context engine (Chrome on MacBook Pro) interprets this as 16px Garamond</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.indexOf(<span class="hljs-string">'medium'</span>) &gt;= <span class="hljs-number">0</span>) metric = <span class="hljs-string">'medium'</span>;
        <span class="hljs-keyword">else</span> {
            size = <span class="hljs-number">12</span>;
            metric = <span class="hljs-string">'px'</span>
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>For when the size has stuff before it in the string (which can, sadly, include numbers)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/.* (\d+\.\d+|\d+|\.\d+)(%|em|ch|ex|rem|vh|vw|vmin|vmax|px|cm|mm|in|pc|pt)?/i</span>.test(item)) {
            
            res = item.match(<span class="hljs-regexp">/.* (\d+\.\d+|\d+|\.\d+)(%|em|ch|ex|rem|vh|vw|vmin|vmax|px|cm|mm|in|pc|pt)?/i</span>);
            size = (res[<span class="hljs-number">1</span>] !== <span class="hljs-string">'.'</span>) ? <span class="hljs-built_in">parseFloat</span>(res[<span class="hljs-number">1</span>]) : <span class="hljs-number">12</span>;
            metric = res[<span class="hljs-number">2</span>];
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>For when the size starts the string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^(\d+\.\d+|\d+|\.\d+)(%|em|ch|ex|rem|vh|vw|vmin|vmax|px|cm|mm|in|pc|pt)?/i</span>.test(item)) {
            
            res = item.match(<span class="hljs-regexp">/^(\d+\.\d+|\d+|\.\d+)(%|em|ch|ex|rem|vh|vw|vmin|vmax|px|cm|mm|in|pc|pt)?/i</span>);
            size = (res[<span class="hljs-number">1</span>] !== <span class="hljs-string">'.'</span>) ? <span class="hljs-built_in">parseFloat</span>(res[<span class="hljs-number">1</span>]) : <span class="hljs-number">12</span>;
            metric = res[<span class="hljs-number">2</span>];
        }

        <span class="hljs-keyword">this</span>.sizeValue = size;
        <span class="hljs-keyword">this</span>.sizeMetric = metric;
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p><strong>font</strong> - pseudo-attribute which calls various functions to break down the font String into its constituent parts</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.font = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (xt(item)) {

        S.style.call(<span class="hljs-keyword">this</span>, item);
        S.variant.call(<span class="hljs-keyword">this</span>, item);
        S.weight.call(<span class="hljs-keyword">this</span>, item);
        S.stretch.call(<span class="hljs-keyword">this</span>, item);
        S.size.call(<span class="hljs-keyword">this</span>, item);
        S.family.call(<span class="hljs-keyword">this</span>, item);
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p><strong>style</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.style = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">let</span> v = <span class="hljs-string">'normal'</span>;

    <span class="hljs-keyword">if</span> (xt(item)) {

        v = (item.indexOf(<span class="hljs-string">'italic'</span>) &gt;= <span class="hljs-number">0</span>) ? <span class="hljs-string">'italic'</span> : v;
        v = (item.indexOf(<span class="hljs-string">'oblique'</span>) &gt;= <span class="hljs-number">0</span>) ? <span class="hljs-string">'oblique'</span> : v;
    }

    <span class="hljs-keyword">this</span>.style = v;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p><strong>variant</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.variant = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">let</span> v = <span class="hljs-string">'normal'</span>;

    v = (item.indexOf(<span class="hljs-string">'small-caps'</span>) &gt;= <span class="hljs-number">0</span>) ? <span class="hljs-string">'small-caps'</span> : v;

    <span class="hljs-keyword">this</span>.variant = v;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p><strong>weight</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.weight = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">let</span> v = <span class="hljs-string">'normal'</span>;

    <span class="hljs-keyword">if</span> (xt(item)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Handling direct entry of numbers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (item.toFixed) v = item;
        <span class="hljs-keyword">else</span> {

            v = (item.indexOf(<span class="hljs-string">'bold'</span>) &gt;= <span class="hljs-number">0</span>) ? <span class="hljs-string">'bold'</span> : v;
            v = (item.indexOf(<span class="hljs-string">'lighter'</span>) &gt;= <span class="hljs-number">0</span>) ? <span class="hljs-string">'lighter'</span> : v;
            v = (item.indexOf(<span class="hljs-string">'bolder'</span>) &gt;= <span class="hljs-number">0</span>) ? <span class="hljs-string">'bolder'</span> : v;</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Putting spaces around the number should help identify it as a Weight value within the font string the string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            v = (item.indexOf(<span class="hljs-string">' 100 '</span>) &gt;= <span class="hljs-number">0</span>) ? <span class="hljs-string">'100'</span> : v;
            v = (item.indexOf(<span class="hljs-string">' 200 '</span>) &gt;= <span class="hljs-number">0</span>) ? <span class="hljs-string">'200'</span> : v;
            v = (item.indexOf(<span class="hljs-string">' 300 '</span>) &gt;= <span class="hljs-number">0</span>) ? <span class="hljs-string">'300'</span> : v;
            v = (item.indexOf(<span class="hljs-string">' 400 '</span>) &gt;= <span class="hljs-number">0</span>) ? <span class="hljs-string">'400'</span> : v;
            v = (item.indexOf(<span class="hljs-string">' 500 '</span>) &gt;= <span class="hljs-number">0</span>) ? <span class="hljs-string">'500'</span> : v;
            v = (item.indexOf(<span class="hljs-string">' 600 '</span>) &gt;= <span class="hljs-number">0</span>) ? <span class="hljs-string">'600'</span> : v;
            v = (item.indexOf(<span class="hljs-string">' 700 '</span>) &gt;= <span class="hljs-number">0</span>) ? <span class="hljs-string">'700'</span> : v;
            v = (item.indexOf(<span class="hljs-string">' 800 '</span>) &gt;= <span class="hljs-number">0</span>) ? <span class="hljs-string">'800'</span> : v;
            v = (item.indexOf(<span class="hljs-string">' 900 '</span>) &gt;= <span class="hljs-number">0</span>) ? <span class="hljs-string">'900'</span> : v;</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Also need to capture instances where a number value has been directly set with no other font attributes around it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            v = (<span class="hljs-regexp">/^\d00$/</span>.test(item)) ? item : v;
        }
    }

    <span class="hljs-keyword">this</span>.weight = v;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p><strong>stretch</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.stretch = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">let</span> v = <span class="hljs-string">'normal'</span>;

    <span class="hljs-keyword">if</span> (xt(item)) {

        v = (item.indexOf(<span class="hljs-string">'semi-condensed'</span>) &gt;= <span class="hljs-number">0</span>) ? <span class="hljs-string">'semi-condensed'</span> : v;
        v = (item.indexOf(<span class="hljs-string">'condensed'</span>) &gt;= <span class="hljs-number">0</span>) ? <span class="hljs-string">'condensed'</span> : v;
        v = (item.indexOf(<span class="hljs-string">'extra-condensed'</span>) &gt;= <span class="hljs-number">0</span>) ? <span class="hljs-string">'extra-condensed'</span> : v;
        v = (item.indexOf(<span class="hljs-string">'ultra-condensed'</span>) &gt;= <span class="hljs-number">0</span>) ? <span class="hljs-string">'ultra-condensed'</span> : v;
        v = (item.indexOf(<span class="hljs-string">'semi-condensed'</span>) &gt;= <span class="hljs-number">0</span>) ? <span class="hljs-string">'semi-condensed'</span> : v;
        v = (item.indexOf(<span class="hljs-string">'condensed'</span>) &gt;= <span class="hljs-number">0</span>) ? <span class="hljs-string">'condensed'</span> : v;
        v = (item.indexOf(<span class="hljs-string">'extra-condensed'</span>) &gt;= <span class="hljs-number">0</span>) ? <span class="hljs-string">'extra-condensed'</span> : v;
        v = (item.indexOf(<span class="hljs-string">'ultra-condensed'</span>) &gt;= <span class="hljs-number">0</span>) ? <span class="hljs-string">'ultra-condensed'</span> : v;
    }

    <span class="hljs-keyword">this</span>.stretch = v;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p><strong>family</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.family = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (xt(item)) {

        <span class="hljs-keyword">let</span> guess = item.match(<span class="hljs-regexp">/( xx-small| x-small| small| medium| large| x-large| xx-large| smaller| larger|\d%|\dem|\dch|\dex|\drem|\dvh|\dvw|\dvmin|\dvmax|\dpx|\dcm|\dmm|\din|\dpc|\dpt) (.*)$/i</span>);

        <span class="hljs-keyword">this</span>.family = (guess &amp;&amp; guess[<span class="hljs-number">2</span>]) ? guess[<span class="hljs-number">2</span>] : item;
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <h4 id="prototype-functions">Prototype functions</h4>

            </div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p><code>buildFont</code> - internal function</p>
<ul>
<li>Takes into account a scaling factor</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.buildFont = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">scale = <span class="hljs-number">1</span></span>) </span>{

    <span class="hljs-keyword">let</span> font = <span class="hljs-string">''</span>

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.style !== <span class="hljs-string">'normal'</span>) font += <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">this</span>.style}</span> `</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.variant !== <span class="hljs-string">'normal'</span>) font += <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">this</span>.variant}</span> `</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.weight !== <span class="hljs-string">'normal'</span>) font += <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">this</span>.weight}</span> `</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.stretch !== <span class="hljs-string">'normal'</span>) font += <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">this</span>.stretch}</span> `</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.sizeValue) font += <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">this</span>.sizeValue * scale}</span><span class="hljs-subst">${<span class="hljs-keyword">this</span>.sizeMetric}</span> `</span>;
    <span class="hljs-keyword">else</span> font += <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">this</span>.sizeMetric}</span> `</span>;

    font += <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">this</span>.family}</span>`</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Temper the font string. Submit it to a canvas context engine to see what it makes of it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> myCell = requestCell();

    myCell.engine.font = font;
    font = myCell.engine.font;

    releaseCell(myCell);
    <span class="hljs-keyword">return</span> font;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p><code>update</code> - <code>sets</code> items, then calls <code>buildFont</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.update = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">scale = <span class="hljs-number">1</span>, items</span>) </span>{

    <span class="hljs-keyword">if</span> (items) <span class="hljs-keyword">this</span>.set(items);

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.buildFont(scale);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <h4 id="factory">Factory</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> makeFontAttributes = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FontAttributes(items);
};

constructors.FontAttributes = FontAttributes;</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <h4 id="exports">Exports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> {
    makeFontAttributes,
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
