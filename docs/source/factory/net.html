<!DOCTYPE html>

<html>
<head>
  <title>Net factory</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="../core/animation-loop.html">
                  ./source/core/animation-loop.js
                </a>
              
                
                <a class="source" href="../core/display-cycle.html">
                  ./source/core/display-cycle.js
                </a>
              
                
                <a class="source" href="../core/document-root-elements.html">
                  ./source/core/document-root-elements.js
                </a>
              
                
                <a class="source" href="../core/document.html">
                  ./source/core/document.js
                </a>
              
                
                <a class="source" href="../core/events.html">
                  ./source/core/events.js
                </a>
              
                
                <a class="source" href="../core/init.html">
                  ./source/core/init.js
                </a>
              
                
                <a class="source" href="../core/library.html">
                  ./source/core/library.js
                </a>
              
                
                <a class="source" href="../core/random-seed.html">
                  ./source/core/random-seed.js
                </a>
              
                
                <a class="source" href="../core/shared-vars.html">
                  ./source/core/shared-vars.js
                </a>
              
                
                <a class="source" href="../core/snippets.html">
                  ./source/core/snippets.js
                </a>
              
                
                <a class="source" href="../core/system-flags.html">
                  ./source/core/system-flags.js
                </a>
              
                
                <a class="source" href="../core/user-interaction.html">
                  ./source/core/user-interaction.js
                </a>
              
                
                <a class="source" href="../core/utilities.html">
                  ./source/core/utilities.js
                </a>
              
                
                <a class="source" href="action.html">
                  ./source/factory/action.js
                </a>
              
                
                <a class="source" href="anchor.html">
                  ./source/factory/anchor.js
                </a>
              
                
                <a class="source" href="animation.html">
                  ./source/factory/animation.js
                </a>
              
                
                <a class="source" href="array-pool.html">
                  ./source/factory/array-pool.js
                </a>
              
                
                <a class="source" href="bezier.html">
                  ./source/factory/bezier.js
                </a>
              
                
                <a class="source" href="block.html">
                  ./source/factory/block.js
                </a>
              
                
                <a class="source" href="canvas.html">
                  ./source/factory/canvas.js
                </a>
              
                
                <a class="source" href="cell-fragment.html">
                  ./source/factory/cell-fragment.js
                </a>
              
                
                <a class="source" href="cell.html">
                  ./source/factory/cell.js
                </a>
              
                
                <a class="source" href="cog.html">
                  ./source/factory/cog.js
                </a>
              
                
                <a class="source" href="color.html">
                  ./source/factory/color.js
                </a>
              
                
                <a class="source" href="conic-gradient.html">
                  ./source/factory/conic-gradient.js
                </a>
              
                
                <a class="source" href="coordinate.html">
                  ./source/factory/coordinate.js
                </a>
              
                
                <a class="source" href="crescent.html">
                  ./source/factory/crescent.js
                </a>
              
                
                <a class="source" href="drag-zone.html">
                  ./source/factory/drag-zone.js
                </a>
              
                
                <a class="source" href="element.html">
                  ./source/factory/element.js
                </a>
              
                
                <a class="source" href="emitter.html">
                  ./source/factory/emitter.js
                </a>
              
                
                <a class="source" href="filter-engine-bluenoise-data.html">
                  ./source/factory/filter-engine-bluenoise-data.js
                </a>
              
                
                <a class="source" href="filter-engine.html">
                  ./source/factory/filter-engine.js
                </a>
              
                
                <a class="source" href="filter.html">
                  ./source/factory/filter.js
                </a>
              
                
                <a class="source" href="font-attributes.html">
                  ./source/factory/font-attributes.js
                </a>
              
                
                <a class="source" href="gradient.html">
                  ./source/factory/gradient.js
                </a>
              
                
                <a class="source" href="grid.html">
                  ./source/factory/grid.js
                </a>
              
                
                <a class="source" href="group.html">
                  ./source/factory/group.js
                </a>
              
                
                <a class="source" href="image-asset.html">
                  ./source/factory/image-asset.js
                </a>
              
                
                <a class="source" href="keyboard-zone.html">
                  ./source/factory/keyboard-zone.js
                </a>
              
                
                <a class="source" href="line-spiral.html">
                  ./source/factory/line-spiral.js
                </a>
              
                
                <a class="source" href="line.html">
                  ./source/factory/line.js
                </a>
              
                
                <a class="source" href="loom.html">
                  ./source/factory/loom.js
                </a>
              
                
                <a class="source" href="mesh.html">
                  ./source/factory/mesh.js
                </a>
              
                
                <a class="source" href="net.html">
                  ./source/factory/net.js
                </a>
              
                
                <a class="source" href="noise-asset.html">
                  ./source/factory/noise-asset.js
                </a>
              
                
                <a class="source" href="observe-update.html">
                  ./source/factory/observe-update.js
                </a>
              
                
                <a class="source" href="oval.html">
                  ./source/factory/oval.js
                </a>
              
                
                <a class="source" href="palette.html">
                  ./source/factory/palette.js
                </a>
              
                
                <a class="source" href="particle-force.html">
                  ./source/factory/particle-force.js
                </a>
              
                
                <a class="source" href="particle-history.html">
                  ./source/factory/particle-history.js
                </a>
              
                
                <a class="source" href="particle-spring.html">
                  ./source/factory/particle-spring.js
                </a>
              
                
                <a class="source" href="particle-world.html">
                  ./source/factory/particle-world.js
                </a>
              
                
                <a class="source" href="particle.html">
                  ./source/factory/particle.js
                </a>
              
                
                <a class="source" href="pattern.html">
                  ./source/factory/pattern.js
                </a>
              
                
                <a class="source" href="phrase.html">
                  ./source/factory/phrase.js
                </a>
              
                
                <a class="source" href="picture.html">
                  ./source/factory/picture.js
                </a>
              
                
                <a class="source" href="polygon.html">
                  ./source/factory/polygon.js
                </a>
              
                
                <a class="source" href="polyline.html">
                  ./source/factory/polyline.js
                </a>
              
                
                <a class="source" href="quadratic.html">
                  ./source/factory/quadratic.js
                </a>
              
                
                <a class="source" href="quaternion.html">
                  ./source/factory/quaternion.js
                </a>
              
                
                <a class="source" href="radial-gradient.html">
                  ./source/factory/radial-gradient.js
                </a>
              
                
                <a class="source" href="raw-asset.html">
                  ./source/factory/raw-asset.js
                </a>
              
                
                <a class="source" href="reaction-diffusion-asset.html">
                  ./source/factory/reaction-diffusion-asset.js
                </a>
              
                
                <a class="source" href="rectangle.html">
                  ./source/factory/rectangle.js
                </a>
              
                
                <a class="source" href="render-animation.html">
                  ./source/factory/render-animation.js
                </a>
              
                
                <a class="source" href="shape.html">
                  ./source/factory/shape.js
                </a>
              
                
                <a class="source" href="spiral.html">
                  ./source/factory/spiral.js
                </a>
              
                
                <a class="source" href="sprite-asset.html">
                  ./source/factory/sprite-asset.js
                </a>
              
                
                <a class="source" href="stack.html">
                  ./source/factory/stack.js
                </a>
              
                
                <a class="source" href="star.html">
                  ./source/factory/star.js
                </a>
              
                
                <a class="source" href="state.html">
                  ./source/factory/state.js
                </a>
              
                
                <a class="source" href="tetragon.html">
                  ./source/factory/tetragon.js
                </a>
              
                
                <a class="source" href="ticker.html">
                  ./source/factory/ticker.js
                </a>
              
                
                <a class="source" href="tracer.html">
                  ./source/factory/tracer.js
                </a>
              
                
                <a class="source" href="tween.html">
                  ./source/factory/tween.js
                </a>
              
                
                <a class="source" href="unstacked-element.html">
                  ./source/factory/unstacked-element.js
                </a>
              
                
                <a class="source" href="vector.html">
                  ./source/factory/vector.js
                </a>
              
                
                <a class="source" href="video-asset.html">
                  ./source/factory/video-asset.js
                </a>
              
                
                <a class="source" href="wheel.html">
                  ./source/factory/wheel.js
                </a>
              
                
                <a class="source" href="../mixin/anchor.html">
                  ./source/mixin/anchor.js
                </a>
              
                
                <a class="source" href="../mixin/asset-advanced-functionality.html">
                  ./source/mixin/asset-advanced-functionality.js
                </a>
              
                
                <a class="source" href="../mixin/asset-consumer.html">
                  ./source/mixin/asset-consumer.js
                </a>
              
                
                <a class="source" href="../mixin/asset.html">
                  ./source/mixin/asset.js
                </a>
              
                
                <a class="source" href="../mixin/base.html">
                  ./source/mixin/base.js
                </a>
              
                
                <a class="source" href="../mixin/cascade.html">
                  ./source/mixin/cascade.js
                </a>
              
                
                <a class="source" href="../mixin/cell-key-functions.html">
                  ./source/mixin/cell-key-functions.js
                </a>
              
                
                <a class="source" href="../mixin/delta.html">
                  ./source/mixin/delta.js
                </a>
              
                
                <a class="source" href="../mixin/display-shape.html">
                  ./source/mixin/display-shape.js
                </a>
              
                
                <a class="source" href="../mixin/dom.html">
                  ./source/mixin/dom.js
                </a>
              
                
                <a class="source" href="../mixin/entity.html">
                  ./source/mixin/entity.js
                </a>
              
                
                <a class="source" href="../mixin/filter.html">
                  ./source/mixin/filter.js
                </a>
              
                
                <a class="source" href="../mixin/mimic.html">
                  ./source/mixin/mimic.js
                </a>
              
                
                <a class="source" href="../mixin/path.html">
                  ./source/mixin/path.js
                </a>
              
                
                <a class="source" href="../mixin/pattern.html">
                  ./source/mixin/pattern.js
                </a>
              
                
                <a class="source" href="../mixin/pivot.html">
                  ./source/mixin/pivot.js
                </a>
              
                
                <a class="source" href="../mixin/position.html">
                  ./source/mixin/position.js
                </a>
              
                
                <a class="source" href="../mixin/shape-basic.html">
                  ./source/mixin/shape-basic.js
                </a>
              
                
                <a class="source" href="../mixin/shape-curve.html">
                  ./source/mixin/shape-curve.js
                </a>
              
                
                <a class="source" href="../mixin/shape-path-calculation.html">
                  ./source/mixin/shape-path-calculation.js
                </a>
              
                
                <a class="source" href="../mixin/styles.html">
                  ./source/mixin/styles.js
                </a>
              
                
                <a class="source" href="../mixin/tween.html">
                  ./source/mixin/tween.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-1">&#x00a7;</a>
              </div>
              <h1 id="net-factory">Net factory</h1>
<p>The Scrawl-canvas particle physics engine is a simple system designed to allow developers a way to add particle-based effects to their canvas animation scenes. The physics engine is built on top of the following components:</p>
<ul>
<li><a href="./particle.html">Particle objects</a>, which represent a 3-dimensional coordinate - based on a Scrawl-canvas <a href="./vector.html">Vector object</a> - and include a history of recent positions which we can use to determine how to display that particle on screen.</li>
<li><a href="./particleHistory.html">History arrays</a> which can be pooled (reused) to cut down on Array creation and distruction during the animation.</li>
<li><a href="./particleForce.html">Force objects</a> which define the general and occasional forces to be applied to each particle in the system as the animation progresses - a <strong>gravity</strong> force object is pre-defined by Scrawl-canvas.</li>
<li><a href="./particleSpring.html">Spring objects</a> used to define a constraint (connection) between two particles in a system.</li>
<li><a href="./particleWorld.html">World objects</a> where we can store attributes and values used by various objects; these attributes can be set up so that they will be inherited by clones of the World object. We can also influence the speed of the physics animation here.</li>
</ul>
<p>We do not have to handle particle generation and manipulation ourselves. Instead, Scrawl-canvas gives us three dedicated <strong>entitys</strong> which we use to add particle animation effects to the canvas scene. These entitys are:</p>
<ul>
<li><a href="./tracer.html">Tracer</a> - this entity generates a single non-recycled (in other words: long lasting) particle with a history, which we can use to display trace effects in the animation.</li>
<li><a href="./emitter.html">Emitter</a> - an entity which generates a stream of short-lived, recycled particles, each with its own history. Emitters are highly versatile entitys which can generate a wide range of effects.</li>
<li><a href="./net.html">Net</a> - a (generally) larger entity which uses both forces and springs to manage the animation of its non-recycled particles. Note that other artefacts can use Net particles as a reference for their own positioning.</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-2">&#x00a7;</a>
              </div>
              <h4 id="demos">Demos:</h4>
<ul>
<li><a href="../../demo/particles-008.html">particles-008</a> - Net entity: generation and basic functionality, including Spring objects</li>
<li><a href="../../demo/particles-009.html">particles-009</a> - Net particles: drag-and-drop functionality</li>
<li><a href="../../demo/particles-010.html">particles-010</a> - Net entity: using a shape path as a net template</li>
<li><a href="../../demo/particles-012.html">particles-012</a> - Use Net entity particles as reference coordinates for other artefacts</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-3">&#x00a7;</a>
              </div>
              <h4 id="imports">Imports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { artefact, artefactnames, constructors, entity, particle, world } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/library.js&#x27;</span>;

<span class="hljs-keyword">import</span> { doCreate, isa_fn, isa_obj, mergeOver, pushUnique, xt, xta, λ<span class="hljs-literal">null</span>, Ωempty } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/utilities.js&#x27;</span>;

<span class="hljs-keyword">import</span> { currentGroup } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./canvas.js&#x27;</span>;
<span class="hljs-keyword">import</span> { makeParticle } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./particle.js&#x27;</span>;
<span class="hljs-keyword">import</span> { makeSpring } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./particle-spring.js&#x27;</span>;

<span class="hljs-keyword">import</span> { releaseVector, requestVector } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./vector.js&#x27;</span>;

<span class="hljs-keyword">import</span> baseMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/base.js&#x27;</span>;
<span class="hljs-keyword">import</span> entityMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/entity.js&#x27;</span>;

<span class="hljs-keyword">import</span> { _floor, _isArray, _now, _piDouble, _tick, <span class="hljs-variable constant_">BLACK</span>, <span class="hljs-variable constant_">BLANK</span>, <span class="hljs-variable constant_">ENTITY</span>, <span class="hljs-variable constant_">EULER</span>, <span class="hljs-variable constant_">FILL_STYLE</span>, <span class="hljs-variable constant_">HUB_ARTEFACTS_1</span>, <span class="hljs-variable constant_">HUB_SPOKE</span>, <span class="hljs-variable constant_">POSITION</span>, <span class="hljs-variable constant_">SOURCE_OVER</span>, <span class="hljs-variable constant_">STROKE_STYLE</span>, <span class="hljs-variable constant_">STRONG_NET</span>, <span class="hljs-variable constant_">STRONG_SHAPE</span>, <span class="hljs-variable constant_">T_NET</span>, <span class="hljs-variable constant_">T_PARTICLE</span>, <span class="hljs-variable constant_">T_POLYLINE</span>, <span class="hljs-variable constant_">T_WORLD</span>, <span class="hljs-variable constant_">WEAK_NET</span>, <span class="hljs-variable constant_">WEAK_SHAPE</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/shared-vars.js&#x27;</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-4">&#x00a7;</a>
              </div>
              <h4 id="net-constructor">Net constructor</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> <span class="hljs-title class_">Net</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">items = Ωempty</span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">makeName</span>(items.<span class="hljs-property">name</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">register</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initializePositions</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">set</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">defs</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-5">&#x00a7;</a>
              </div>
              <p>The entity places a <code>hitRadius</code> around each of its particles - effectively a distributed hit zone which can be used for drag-and-drop, and other user interactions..</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">onEnter</span> = λ<span class="hljs-literal">null</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">onLeave</span> = λ<span class="hljs-literal">null</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">onDown</span> = λ<span class="hljs-literal">null</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">onUp</span> = λ<span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-6">&#x00a7;</a>
              </div>
              <p>Net entitys generate their Particles once, on initialization, in line with the <code>generate</code> function’s instructions. Scrawl-canvas includes a number of pre-built generator functions, which we can reference by their String names: <code>weak-net</code>, <code>strong-net</code>, <code>weak-shape</code>, <code>strong-shape</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">generate</span> = λ<span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-7">&#x00a7;</a>
              </div>
              <p>The <code>postGenerate</code> function runs imediately after the <code>generate</code> function. We can use it to amend the attributes of selected Particles, for instance to make them static.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">postGenerate</span> = λ<span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-8">&#x00a7;</a>
              </div>
              <p>As part of its <code>stamp</code> functionality the Net entity will invoke the <code>stampAction</code> function. If not supplied, the entity will not display anything on the canvas.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">stampAction</span> = λ<span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-9">&#x00a7;</a>
              </div>
              <p>Setup the particle store, and the entity’s <code>springs</code> Array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">particleStore</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">springs</span> = [];

    <span class="hljs-keyword">if</span> (!items.<span class="hljs-property">group</span>) items.<span class="hljs-property">group</span> = currentGroup;

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">set</span>(items);

    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">purge</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">purgeArtefact</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">purge</span>);

    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-10">&#x00a7;</a>
              </div>
              <h4 id="net-prototype">Net prototype</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> P = <span class="hljs-title class_">Net</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title function_">doCreate</span>();
P.<span class="hljs-property">type</span> = <span class="hljs-variable constant_">T_NET</span>;
P.<span class="hljs-property">lib</span> = <span class="hljs-variable constant_">ENTITY</span>;
P.<span class="hljs-property">isArtefact</span> = <span class="hljs-literal">true</span>;
P.<span class="hljs-property">isAsset</span> = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-11">&#x00a7;</a>
              </div>
              <h4 id="mixins">Mixins</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-title function_">baseMix</span>(P);
<span class="hljs-title function_">entityMix</span>(P);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-12">&#x00a7;</a>
              </div>
              <h4 id="net-attributes">Net attributes</h4>
<ul>
<li>Attributes defined in the <a href="../mixin/base.html">base mixin</a>: <strong>name</strong>.</li>
<li>Attributes defined in the <a href="../mixin/position.html">position mixin</a>: <strong>group, visibility, order, calculateOrder, stampOrder, start, <em>startX</em>, <em>startY</em>, handle, <em>handleX</em>, <em>handleY</em>, offset, <em>offsetX</em>, <em>offsetY</em>, dimensions, <em>width</em>, <em>height</em>, pivoted, mimicked, lockTo, <em>lockXTo</em>, <em>lockYTo</em>, scale, roll, noUserInteraction, noPositionDependencies, noCanvasEngineUpdates, noFilters, noPathUpdates, purge, bringToFrontOnDrag</strong>.</li>
<li>Attributes defined in the <a href="../mixin/delta.html">delta mixin</a>: <strong>delta, noDeltaUpdates</strong>.</li>
<li>Attributes defined in the <a href="../mixin/pivot.html">pivot mixin</a>: <strong>pivot, pivotCorner, addPivotHandle, addPivotOffset, addPivotRotation</strong>.</li>
<li>Attributes defined in the <a href="../mixin/mimic.html">mimic mixin</a>: <strong>mimic, useMimicDimensions, useMimicScale, useMimicStart, useMimicHandle, useMimicOffset, useMimicRotation, useMimicFlip, addOwnDimensionsToMimic, addOwnScaleToMimic, addOwnStartToMimic, addOwnHandleToMimic, addOwnOffsetToMimic, addOwnRotationToMimic</strong>.</li>
<li>Attributes defined in the <a href="../mixin/path.html">path mixin</a>: <strong>path, pathPosition, addPathHandle, addPathOffset, addPathRotation, constantPathSpeed</strong>.</li>
<li>Attributes defined in the <a href="../mixin/entity.html">entity mixin</a>: <strong>method, pathObject, winding, flipReverse, flipUpend, scaleOutline, lockFillStyleToEntity, lockStrokeStyleToEntity, onEnter, onLeave, onDown, onUp, <em>fillStyle, strokeStyle, globalAlpha, globalCompositeOperation, lineWidth, lineCap, lineJoin, lineDash, lineDashOffset, miterLimit, shadowOffsetX, shadowOffsetY, shadowBlur, shadowColor, filter</em></strong>.</li>
<li>Attributes defined in the <a href="../mixin/anchor.html">anchor mixin</a>: <strong>anchor</strong>.</li>
<li>Attributes defined in the <a href="../mixin/filter.html">filter mixin</a>: <strong>filters, isStencil</strong>.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> defaultAttributes = {</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-13">&#x00a7;</a>
              </div>
              <p><strong>world</strong> - World object; can be set using the String name of a World object, or the World object itself.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">world</span>: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-14">&#x00a7;</a>
              </div>
              <p><strong>artefact</strong> - In theory, any Scrawl-canvas object whose <code>isArtefact</code> flag is set to <code>true</code> can be assigned to this attribute. However this has not been tested on non-entity artefacts. For now, stick to Scrawl-canvas entity objects.</p>
<ul>
<li>Can be set using the String name of an artefact object, or the artefact object itself.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">artefact</span>: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-15">&#x00a7;</a>
              </div>
              <p><strong>historyLength</strong> - positive integer Number - every Particle will keep a record of its recent state, in a set of ParticleHistory arrays stored in the Particle’s <code>history</code> Array. The Net entity will set the maximum permitted length of the history array whenever it generates a new Particle. </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">historyLength</span>: <span class="hljs-number">1</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-16">&#x00a7;</a>
              </div>
              <p>Net entitys will, as part of the Display cycle, apply any force objects assigned to a Particle. The initial forces assigned to every new Particle will be in line with the Force objects included in the Net’s <strong>forces</strong> Array.</p>
<ul>
<li>To set the Array, supply a new Array containing Force objects, and/or the name Strings of those Force objects, to the <code>forces</code> attribute.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">forces</span>: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-17">&#x00a7;</a>
              </div>
              <p><strong>mass</strong> - positive float Number - the initial mass assigned to each Particle when it is generated. Note that, unlike Net entitys, a Net entity will generate all its Particles with the same mass value</p>
<ul>
<li>The <code>mass</code> attribute is used by the pre-defined <em><strong>gravity Force</strong></em></li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">mass</span>: <span class="hljs-number">1</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-18">&#x00a7;</a>
              </div>
              <p>Physics calculations are handled by the Net entity’s physics <strong>engine</strong> which must be a String value of either <code>euler</code> (the default engine), <code>improved-euler</code> or <code>runge-kutta</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">engine</span>: <span class="hljs-variable constant_">EULER</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-19">&#x00a7;</a>
              </div>
              <p><strong>springConstant</strong>, <strong>damperConstant</strong> - positive float Numbers - used for the initial values for any Spring objects generated to connect two Particles</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">springConstant</span>: <span class="hljs-number">50</span>,
    <span class="hljs-attr">damperConstant</span>: <span class="hljs-number">10</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-20">&#x00a7;</a>
              </div>
              <p>This is a ratio figure, not the actual rest length. If <code>== 1</code>, spring restLength will equal the initial distance between the two particles. <code>&lt; 1</code> and the length will be proportionately smaller; <code>&gt; 1</code> gives results in a longer length</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">restLength</span>: <span class="hljs-number">1</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-21">&#x00a7;</a>
              </div>
              <p><strong>showSprings</strong> - Boolean flag - when set, Scrawl-canvas will display the Spring connections between Particle pairs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">showSprings</span>: <span class="hljs-literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-22">&#x00a7;</a>
              </div>
              <p><strong>showSpringColor</strong> - CSS color String - the strokeStyle color used to display the Spring objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">showSpringsColor</span>: <span class="hljs-variable constant_">BLACK</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-23">&#x00a7;</a>
              </div>
              <h5 id="weak-net-strong-net">weak-net, strong-net</h5>
<p><strong>rows</strong>, <strong>columns</strong> - positive integer Numbers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">rows</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">columns</span>: <span class="hljs-number">0</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-24">&#x00a7;</a>
              </div>
              <p><strong>rowDistance</strong>, <strong>columnDistance</strong> - positive float Numbers, representing the absolute pixel distance between rows and columns, or percentage String values representing the distance as measured relative to the host Cell’s dimensions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">rowDistance</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">columnDistance</span>: <span class="hljs-number">0</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-25">&#x00a7;</a>
              </div>
              <h5 id="weak-shape-strong-shape">weak-shape, strong-shape</h5>
<p><strong>shapeTemplate</strong> - String name of a shape-based entity, or the entity object itself - used as the template along which particles will be generated</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">shapeTemplate</span>: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-26">&#x00a7;</a>
              </div>
              <p><strong>precision</strong> - positive integer Number - the number of particles to generate along the template path</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">precision</span>: <span class="hljs-number">20</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-27">&#x00a7;</a>
              </div>
              <p><strong>joinTemplateEnds</strong> - Boolean flag - when set, springs will be generated to connect the start and the end particles on the template  path</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">joinTemplateEnds</span>: <span class="hljs-literal">false</span>,

    <span class="hljs-attr">particlesAreDraggable</span>: <span class="hljs-literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-28">&#x00a7;</a>
              </div>
              <p>Note that the <strong>hitRadius</strong> attribute - a positive float Number - is absolute, and has nothing to do with the entity’s dimensions. Net entity hit zones are tied to its Particles, not its start coordinate.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">hitRadius</span>: <span class="hljs-number">10</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-29">&#x00a7;</a>
              </div>
              <p><strong>showHitRadius</strong> - Boolean flag - when set, Scrawl-canvas will display appropriate circles around each of the Net entity’s Particles (in addition to any artefact stamped at the Particle’s position)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">showHitRadius</span>: <span class="hljs-literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-30">&#x00a7;</a>
              </div>
              <p><strong>hitRadiusColor</strong> - CSS color String - the strokeStyle color used to display the hit radius</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">hitRadiusColor</span>: <span class="hljs-variable constant_">BLACK</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-31">&#x00a7;</a>
              </div>
              <p><strong>resetAfterBlur</strong> - positive float Number (measuring seconds) - physics simulations can be brittle, particularly if they are forced to calculate Particle loads (accelerations), velocities and speeds over a large time step. Rather than manage that time step in cases where the user may neglect or navigate away from the browser tab containing the physics animation, Scrawl-canvas will stop, clear, and recreate the scene if the time it takes the user to return to (re-focus on) the web page is greater than the value set in this attribute.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">resetAfterBlur</span>: <span class="hljs-number">3</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-32">&#x00a7;</a>
              </div>
              <h5 id="not-defined-in-the-defs-object-but-set-up-in-the-constructor-and-setters">Not defined in the defs object, but set up in the constructor and setters</h5>

            </div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-33">&#x00a7;</a>
              </div>
              <p><strong>particleStore</strong> - an Array where all the Net’s current particles will be stored. To render the entity, we need to iterate through these particles and use them to repeatedly stamp the Net’s artefact - or perform equivalent &lt;canvas&gt; context engine instructions - onto the host Cell. These actions will be defined in the <code>stampAction</code> function.</p>

            </div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-34">&#x00a7;</a>
              </div>
              <p><strong>stampAction</strong> - define all major rendering actions in this function. The function receives the following arguments: <code>(artefact, particle, host)</code> - where <code>artefact</code> is the Net entity’s artefact object (if any has been defined/set); <code>particle</code> is the current Particle object whose history needs to be rendered onto the canvas; and <code>host</code> is the Cell wrapper on which we will draw our graphics</p>

            </div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-35">&#x00a7;</a>
              </div>
              <p><strong>springs</strong> - Array - holds all the entity’s Spring objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>};
P.<span class="hljs-property">defs</span> = <span class="hljs-title function_">mergeOver</span>(P.<span class="hljs-property">defs</span>, defaultAttributes);</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-36">&#x00a7;</a>
              </div>
              <h4 id="packet-management">Packet management</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">packetExclusions</span> = <span class="hljs-title function_">pushUnique</span>(P.<span class="hljs-property">packetExclusions</span>, [<span class="hljs-string">&#x27;forces&#x27;</span>, <span class="hljs-string">&#x27;springs&#x27;</span>, <span class="hljs-string">&#x27;particleStore&#x27;</span>]);
P.<span class="hljs-property">packetObjects</span> = <span class="hljs-title function_">pushUnique</span>(P.<span class="hljs-property">packetObjects</span>, [<span class="hljs-string">&#x27;world&#x27;</span>, <span class="hljs-string">&#x27;artefact&#x27;</span>, <span class="hljs-string">&#x27;shapeTemplate&#x27;</span>]);
P.<span class="hljs-property">packetFunctions</span> = <span class="hljs-title function_">pushUnique</span>(P.<span class="hljs-property">packetFunctions</span>, [<span class="hljs-string">&#x27;generate&#x27;</span>, <span class="hljs-string">&#x27;postGenerate&#x27;</span>, <span class="hljs-string">&#x27;stampAction&#x27;</span>]);

P.<span class="hljs-property">finalizePacketOut</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">copy, items</span>) {

    <span class="hljs-keyword">let</span> forces = items.<span class="hljs-property">forces</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">forces</span> || <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">if</span> (forces) {

        <span class="hljs-keyword">let</span> tempForces = [];
        forces.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> {

            <span class="hljs-keyword">if</span> (f.<span class="hljs-property">substring</span>) tempForces.<span class="hljs-title function_">push</span>(f);
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isa_obj</span>(f) &amp;&amp; f.<span class="hljs-property">name</span>) tempForces.<span class="hljs-title function_">push</span>(f.<span class="hljs-property">name</span>);
        });
        copy.<span class="hljs-property">forces</span> = tempForces;
    }

    <span class="hljs-keyword">let</span> tempParticles = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">particleStore</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> tempParticles.<span class="hljs-title function_">push</span>(p.<span class="hljs-title function_">saveAsPacket</span>()));
    copy.<span class="hljs-property">particleStore</span> = tempParticles;

    <span class="hljs-keyword">return</span> copy;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-37">&#x00a7;</a>
              </div>
              <h4 id="clone-management">Clone management</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">postCloneAction</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">clone</span>) {

    <span class="hljs-keyword">return</span> clone;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-38">&#x00a7;</a>
              </div>
              <h4 id="kill-management">Kill management</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">factoryKill</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">killArtefact, killWorld</span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isRunning</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">if</span> (killArtefact) {       

        <span class="hljs-variable language_">this</span>.<span class="hljs-property">artefact</span>.<span class="hljs-title function_">kill</span>();
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">shapeTemplate</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-property">shapeTemplate</span>.<span class="hljs-title function_">kill</span>();
    }

    <span class="hljs-keyword">if</span> (killWorld) <span class="hljs-variable language_">this</span>.<span class="hljs-property">world</span>.<span class="hljs-title function_">kill</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">purgeParticlesFromLibrary</span>();
};

P.<span class="hljs-property">purgeParticlesFromLibrary</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-keyword">const</span> {particleStore, springs} = <span class="hljs-variable language_">this</span>;

    <span class="hljs-keyword">let</span> tempArt;</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-39">&#x00a7;</a>
              </div>
              <p>Net entity particles can be referenced by other artefacts (when using them for positioning coordinates. New particles will be created with the same names as the old ones, so it is enough to replace these references with the String names of the particles)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    artefactnames.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">a</span> =&gt;</span> {

        tempArt = artefact[a];

        <span class="hljs-keyword">if</span> (tempArt) {

            <span class="hljs-keyword">if</span> (tempArt.<span class="hljs-property">particle</span> &amp;&amp; !tempArt.<span class="hljs-property">particle</span>.<span class="hljs-property">substring</span> &amp;&amp; tempArt.<span class="hljs-property">particle</span>.<span class="hljs-property">name</span>) tempArt.<span class="hljs-property">particle</span> = tempArt.<span class="hljs-property">particle</span>.<span class="hljs-property">name</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-40">&#x00a7;</a>
              </div>
              <p>Polyline entitys go one step further in that they can also use Particles in their pin array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (tempArt.<span class="hljs-property">type</span> == <span class="hljs-variable constant_">T_POLYLINE</span> &amp;&amp; tempArt.<span class="hljs-property">useParticlesAsPins</span>) {

                tempArt.<span class="hljs-property">pins</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">pin, index</span>) =&gt;</span> {

                    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isa_obj</span>(pin) &amp;&amp; pin.<span class="hljs-property">type</span> == <span class="hljs-variable constant_">T_PARTICLE</span>) {

                        tempArt.<span class="hljs-property">pins</span>[index] = pin.<span class="hljs-property">name</span>;
                        tempArt.<span class="hljs-property">dirtyPins</span> = <span class="hljs-literal">true</span>;
                    }
                });
            }
        }
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-41">&#x00a7;</a>
              </div>
              <p>Now we can tell all the Net entity’s particles to kill themselves</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    particleStore.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> p.<span class="hljs-title function_">kill</span>());
    particleStore.<span class="hljs-property">length</span> = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-42">&#x00a7;</a>
              </div>
              <p>We can also get rid of all the Spring objects as they will be recreated alongside the particle objects as part of the Net entity’s <code>generate</code> functionality.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    springs.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> s.<span class="hljs-title function_">kill</span>());
    springs.<span class="hljs-property">length</span> = <span class="hljs-number">0</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-43">&#x00a7;</a>
              </div>
              <h4 id="get-set-deltaset">Get, Set, deltaSet</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> S = P.<span class="hljs-property">setters</span>;

S.<span class="hljs-property">generate</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isa_fn</span>(item)) <span class="hljs-variable language_">this</span>.<span class="hljs-property">generate</span> = item;

    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.<span class="hljs-property">substring</span> &amp;&amp; generators[item]) <span class="hljs-variable language_">this</span>.<span class="hljs-property">generate</span> = generators[item];
};

S.<span class="hljs-property">postGenerate</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isa_fn</span>(item)) <span class="hljs-variable language_">this</span>.<span class="hljs-property">postGenerate</span> = item;
};

S.<span class="hljs-property">stampAction</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isa_fn</span>(item)) <span class="hljs-variable language_">this</span>.<span class="hljs-property">stampAction</span> = item;
};


S.<span class="hljs-property">world</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    <span class="hljs-keyword">let</span> w;

    <span class="hljs-keyword">if</span> (item.<span class="hljs-property">substring</span>) w = world[item];
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isa_obj</span>(item) &amp;&amp; item.<span class="hljs-property">type</span> == <span class="hljs-variable constant_">T_WORLD</span>) w = item;

    <span class="hljs-keyword">if</span> (w) <span class="hljs-variable language_">this</span>.<span class="hljs-property">world</span> = w;
};

S.<span class="hljs-property">artefact</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    <span class="hljs-keyword">let</span> art;

    <span class="hljs-keyword">if</span> (item.<span class="hljs-property">substring</span>) art = artefact[item];
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isa_obj</span>(item) &amp;&amp; item.<span class="hljs-property">isArtefact</span>) art = item;

    <span class="hljs-keyword">if</span> (art) <span class="hljs-variable language_">this</span>.<span class="hljs-property">artefact</span> = art;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyFilterIdentifier</span> = <span class="hljs-literal">true</span>;
};

S.<span class="hljs-property">shapeTemplate</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    <span class="hljs-keyword">let</span> art;

    <span class="hljs-keyword">if</span> (item.<span class="hljs-property">substring</span>) art = entity[item];
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isa_obj</span>(item) &amp;&amp; item.<span class="hljs-property">isArtefact</span> &amp;&amp; <span class="hljs-title function_">xt</span>(item.<span class="hljs-property">species</span>)) art = item;

    <span class="hljs-keyword">if</span> (art) <span class="hljs-variable language_">this</span>.<span class="hljs-property">shapeTemplate</span> = art;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyFilterIdentifier</span> = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-44">&#x00a7;</a>
              </div>
              <h4 id="prototype-functions">Prototype functions</h4>

            </div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-45">&#x00a7;</a>
              </div>
              <p><code>regularStamp</code> - overwriters the functionality defined in the entity.js mixin</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">regularStamp</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-keyword">const</span> {world, <span class="hljs-attr">artefact</span>:art, particleStore, springs, generate, postGenerate, stampAction, lastUpdated, resetAfterBlur, showSprings, showSpringsColor, showHitRadius, hitRadius, hitRadiusColor} = <span class="hljs-variable language_">this</span>;

    <span class="hljs-keyword">let</span> globalAlpha = <span class="hljs-number">1</span>,
        globalCompositeOperation = <span class="hljs-variable constant_">SOURCE_OVER</span>,
        particleFrom, particleTo;

    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>) {
        globalAlpha = <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">globalAlpha</span>;
        globalCompositeOperation = <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">globalCompositeOperation</span>;
    }

    <span class="hljs-keyword">const</span> host = <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentHost</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-46">&#x00a7;</a>
              </div>
              <p>The particle system is a physics system, which means we need to advance it by a small amount of time as part of each Display cycle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> deltaTime = _tick,
        now = <span class="hljs-title function_">_now</span>();

    <span class="hljs-keyword">if</span> (lastUpdated) deltaTime = (now - lastUpdated) / <span class="hljs-number">1000</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-47">&#x00a7;</a>
              </div>
              <p>If the user has focussed on another tab in the browser before returning to the tab running this Scrawl-canvas animation, then we risk breaking the page by continuing the animation with the existing particles - simplest solution is to remove all the particles and, in effect, restart the Net’s animation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (deltaTime &gt; resetAfterBlur) {

        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">purgeParticlesFromLibrary</span>();
        deltaTime = _tick;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-48">&#x00a7;</a>
              </div>
              <p>If we have no particles, we need to generate them</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!particleStore.<span class="hljs-property">length</span>) {

        generate.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, host);
        postGenerate.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-49">&#x00a7;</a>
              </div>
              <p>The physics core of the function: </p>
<ul>
<li>Calculate the forces acting on each of the Net entity’s particles</li>
<li>Add the Spring constraints to the particles</li>
<li>Get the particles to update themselves, using the appropriate physics engine</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    particleStore.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> p.<span class="hljs-title function_">applyForces</span>(world, host));
    springs.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> s.<span class="hljs-title function_">applySpring</span>());
    particleStore.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> p.<span class="hljs-title function_">update</span>(deltaTime, world));</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-50">&#x00a7;</a>
              </div>
              <p>Additional visuals are available - specifically we can draw in the springs acting on particle pairs before we stamp the artefact on them</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (showSprings) {

        <span class="hljs-keyword">const</span> engine = host.<span class="hljs-property">engine</span>;

        engine.<span class="hljs-title function_">save</span>();
        engine.<span class="hljs-property">globalAlpha</span> = globalAlpha;
        engine.<span class="hljs-property">globalCompositeOperation</span> = globalCompositeOperation;
        engine.<span class="hljs-property">strokeStyle</span> = showSpringsColor;
        engine.<span class="hljs-property">shadowOffsetX</span> = <span class="hljs-number">0</span>,
        engine.<span class="hljs-property">shadowOffsetY</span> = <span class="hljs-number">0</span>,
        engine.<span class="hljs-property">shadowBlur</span> = <span class="hljs-number">0</span>,
        engine.<span class="hljs-property">shadowColor</span> = <span class="hljs-variable constant_">BLANK</span>,
        engine.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">1</span>;
        engine.<span class="hljs-title function_">setTransform</span>(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        engine.<span class="hljs-title function_">beginPath</span>();

        springs.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> {

            ({particleFrom, particleTo} = s);

            engine.<span class="hljs-title function_">moveTo</span>(particleFrom.<span class="hljs-property">position</span>.<span class="hljs-property">x</span>, particleFrom.<span class="hljs-property">position</span>.<span class="hljs-property">y</span>);
            engine.<span class="hljs-title function_">lineTo</span>(particleTo.<span class="hljs-property">position</span>.<span class="hljs-property">x</span>, particleTo.<span class="hljs-property">position</span>.<span class="hljs-property">y</span>);
        });
        engine.<span class="hljs-title function_">stroke</span>();
        engine.<span class="hljs-title function_">restore</span>();
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-51">&#x00a7;</a>
              </div>
              <p>The display cycle core of the function</p>
<ul>
<li>Get each particle to update its history</li>
<li>Using that history, get each particle to stamp some ink onto the canvas.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    particleStore.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> {

        p.<span class="hljs-title function_">manageHistory</span>(deltaTime, host);
        stampAction.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, art, p, host);
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-52">&#x00a7;</a>
              </div>
              <p>A second set of additional visuals - display each particle’s hit region</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (showHitRadius) {

        <span class="hljs-keyword">const</span> engine = host.<span class="hljs-property">engine</span>;

        engine.<span class="hljs-title function_">save</span>();
        engine.<span class="hljs-property">globalAlpha</span> = globalAlpha;
        engine.<span class="hljs-property">globalCompositeOperation</span> = globalCompositeOperation;
        engine.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">1</span>;
        engine.<span class="hljs-property">strokeStyle</span> = hitRadiusColor;
        engine.<span class="hljs-property">shadowOffsetX</span> = <span class="hljs-number">0</span>,
        engine.<span class="hljs-property">shadowOffsetY</span> = <span class="hljs-number">0</span>,
        engine.<span class="hljs-property">shadowBlur</span> = <span class="hljs-number">0</span>,
        engine.<span class="hljs-property">shadowColor</span> = <span class="hljs-variable constant_">BLANK</span>,

        engine.<span class="hljs-title function_">setTransform</span>(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        engine.<span class="hljs-title function_">beginPath</span>();

        particleStore.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> {
            engine.<span class="hljs-title function_">moveTo</span>(p.<span class="hljs-property">position</span>.<span class="hljs-property">x</span>, p.<span class="hljs-property">position</span>.<span class="hljs-property">y</span>);
            engine.<span class="hljs-title function_">arc</span>(p.<span class="hljs-property">position</span>.<span class="hljs-property">x</span>, p.<span class="hljs-property">position</span>.<span class="hljs-property">y</span>, hitRadius, <span class="hljs-number">0</span>, _piDouble);
        });
        
        engine.<span class="hljs-title function_">stroke</span>();
        engine.<span class="hljs-title function_">restore</span>();
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-53">&#x00a7;</a>
              </div>
              <p>The final critical step - remember the absolute time value of when we started to perform this Display cycle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastUpdated</span> = now;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-54">&#x00a7;</a>
              </div>
              <p><code>restart</code> - force the Net to purge its particles/springs, rebuild itself, and restart its animation from the beginning</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">restart</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">purgeParticlesFromLibrary</span>();
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastUpdated</span> = <span class="hljs-title function_">_now</span>();

    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-55">&#x00a7;</a>
              </div>
              <p><code>checkHit</code> - overwrites the function defined in mixin/position.js</p>
<ul>
<li>The Net entity’s hit areas are circles centred on the entity’s Particle’s positions. </li>
<li>Nets cannot be dragged; the Particles that make up the Net can be dragged.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">checkHit</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">items = [], mycell</span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastHitParticle</span> = <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">particlesAreDraggable</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">noUserInteraction</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">const</span> tests = (!<span class="hljs-title function_">_isArray</span>(items)) ?  [items] : items;

    <span class="hljs-keyword">let</span> particleStore = <span class="hljs-variable language_">this</span>.<span class="hljs-property">particleStore</span>,
        res = <span class="hljs-literal">false</span>,
        tx, ty, i, iz, p;

    <span class="hljs-keyword">if</span> (tests.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">test</span> =&gt;</span> {

        <span class="hljs-keyword">if</span> (<span class="hljs-title function_">_isArray</span>(test)) {

            tx = test[<span class="hljs-number">0</span>];
            ty = test[<span class="hljs-number">1</span>];
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">xta</span>(test, test.<span class="hljs-property">x</span>, test.<span class="hljs-property">y</span>)) {

            tx = test.<span class="hljs-property">x</span>;
            ty = test.<span class="hljs-property">y</span>;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">if</span> (!tx.<span class="hljs-property">toFixed</span> || !ty.<span class="hljs-property">toFixed</span> || <span class="hljs-built_in">isNaN</span>(tx) || <span class="hljs-built_in">isNaN</span>(ty)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">const</span> v = <span class="hljs-title function_">requestVector</span>();

        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = particleStore.<span class="hljs-property">length</span>; i &lt; iz; i++) {

            p = particleStore[i];

            v.<span class="hljs-title function_">set</span>(p.<span class="hljs-property">position</span>).<span class="hljs-title function_">vectorSubtract</span>(test);

            <span class="hljs-keyword">if</span> (v.<span class="hljs-title function_">getMagnitude</span>() &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">hitRadius</span>) {

                res = p;
                <span class="hljs-keyword">break</span>;
            }
        }
        <span class="hljs-title function_">releaseVector</span>(v);

        <span class="hljs-keyword">return</span> res;

    }, <span class="hljs-variable language_">this</span>)) {

        <span class="hljs-keyword">const</span> r = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">checkHitReturn</span>(tx, ty, mycell, res);

        <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastHitParticle</span> = res;

        <span class="hljs-keyword">return</span> r;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-56">&#x00a7;</a>
              </div>
              <p><code>checkHitReturn</code> - overwrites the function defined in mixin/position.js</p>
<ul>
<li>The return object includes the Particle object that recorded the hit, saved in the object’s <code>particle</code> attribute</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">checkHitReturn</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">x, y, cell, particle</span>) {

    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">x</span>: x,
        <span class="hljs-attr">y</span>: y,
        <span class="hljs-attr">artefact</span>: <span class="hljs-variable language_">this</span>,
        <span class="hljs-attr">particle</span>: particle,
    };
};</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-57">&#x00a7;</a>
              </div>
              <p><code>pickupArtefact</code> - overwrites the function defined in mixin/position.js</p>
<ul>
<li>One of the entity’s Particle objects is being dragged, not the entity itself</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">pickupArtefact</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) {

    <span class="hljs-keyword">const</span> particle = <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastHitParticle</span>;

    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">xta</span>(items, particle)) {

        particle.<span class="hljs-property">isBeingDragged</span> = items;
        particle.<span class="hljs-property">dragOffset</span> = <span class="hljs-title function_">requestVector</span>(particle.<span class="hljs-property">position</span>).<span class="hljs-title function_">vectorSubtract</span>(items);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastHitParticle</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-58">&#x00a7;</a>
              </div>
              <p><code>dropArtefact</code> - overwrites the function defined in mixin/position.js</p>
<ul>
<li>One of the entity’s Particle objects is being dragged, not the entity itself</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">dropArtefact</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastHitParticle</span>.<span class="hljs-property">isBeingDragged</span> = <span class="hljs-literal">null</span>;
    <span class="hljs-title function_">releaseVector</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">lastHitParticle</span>.<span class="hljs-property">dragOffset</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastHitParticle</span>.<span class="hljs-property">dragOffset</span> = <span class="hljs-literal">null</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastHitParticle</span> = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-59">&#x00a7;</a>
              </div>
              <h4 id="pre-defined-net-generators">Pre-defined Net generators</h4>

            </div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-60">&#x00a7;</a>
              </div>
              <p><code>springMaker</code> - internal helper function to generate the entity’s Spring objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> springMaker = <span class="hljs-keyword">function</span> (<span class="hljs-params">particleFrom, particleTo, springName</span>) {

    <span class="hljs-keyword">const</span> { springs, springConstant, damperConstant, restLength } = <span class="hljs-variable language_">this</span>;

    <span class="hljs-keyword">let</span> v, l, s;

    v = <span class="hljs-title function_">requestVector</span>(particleFrom.<span class="hljs-property">position</span>).<span class="hljs-title function_">vectorSubtract</span>(particleTo.<span class="hljs-property">position</span>);
    l = v.<span class="hljs-title function_">getMagnitude</span>();

    s = <span class="hljs-title function_">makeSpring</span>({

        <span class="hljs-attr">name</span>: springName,

        particleFrom,
        particleTo,

        springConstant, 
        damperConstant,

        <span class="hljs-attr">restLength</span>: l * restLength,
    });

    springs.<span class="hljs-title function_">push</span>(s);
    <span class="hljs-title function_">releaseVector</span>(v);
};

<span class="hljs-keyword">const</span> generators = {</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-61">&#x00a7;</a>
              </div>
              <p><code>weak-net</code> - a net made up of rows and columns, with particles at each row/column intersection. The generator will connect each Particle with springs to up to four of its closest horizontal and vertical neighbors</p>
<ul>
<li>Can be used to model cloth</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    [<span class="hljs-variable constant_">WEAK_NET</span>]: <span class="hljs-keyword">function</span> (<span class="hljs-params">host</span>) {

        <span class="hljs-keyword">const</span> { particleStore, <span class="hljs-attr">artefact</span>:art, historyLength, engine, forces, mass, rows, columns, rowDistance, columnDistance, name } = <span class="hljs-variable language_">this</span>;

        <span class="hljs-keyword">if</span> (host &amp;&amp; rows &gt; <span class="hljs-number">0</span> &amp;&amp; columns &gt; <span class="hljs-number">0</span>) {

            <span class="hljs-keyword">let</span> [x, y] = <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentStampPosition</span>;
            <span class="hljs-keyword">let</span> [, height] = host.<span class="hljs-property">currentDimensions</span>;

            <span class="hljs-keyword">let</span> deltaR = (rowDistance.<span class="hljs-property">substring</span>) ? (<span class="hljs-built_in">parseFloat</span>(rowDistance) / <span class="hljs-number">100</span>) * height : rowDistance;
            <span class="hljs-keyword">let</span> deltaC = (columnDistance.<span class="hljs-property">substring</span>) ? (<span class="hljs-built_in">parseFloat</span>(columnDistance) / <span class="hljs-number">100</span>) * height : columnDistance;

            <span class="hljs-keyword">let</span> dx, dy, p, i, j;</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-62">&#x00a7;</a>
              </div>
              <p>generate particles</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; rows; i++) {

                dy = (deltaR * i) + y;

                <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; columns; j++) {

                    dx = (deltaC * j) + x;

                    p = <span class="hljs-title function_">makeParticle</span>({

                        <span class="hljs-attr">name</span>: <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>-<span class="hljs-subst">${j}</span>`</span>,

                        <span class="hljs-attr">positionX</span>: dx,
                        <span class="hljs-attr">positionY</span>: dy,
                        <span class="hljs-attr">positionZ</span>: <span class="hljs-number">0</span>,

                        <span class="hljs-attr">velocityX</span>: <span class="hljs-number">0</span>,
                        <span class="hljs-attr">velocityY</span>: <span class="hljs-number">0</span>,
                        <span class="hljs-attr">velocityZ</span>: <span class="hljs-number">0</span>,

                        historyLength, 
                        engine, 
                        forces, 

                        mass,

                        <span class="hljs-attr">fill</span>: art.<span class="hljs-title function_">get</span>(<span class="hljs-variable constant_">FILL_STYLE</span>),
                        <span class="hljs-attr">stroke</span>: art.<span class="hljs-title function_">get</span>(<span class="hljs-variable constant_">STROKE_STYLE</span>),
                    });

                    p.<span class="hljs-title function_">run</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);

                    particleStore.<span class="hljs-title function_">push</span>(p);
                }
            }

            <span class="hljs-keyword">let</span> f, t;</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-63">&#x00a7;</a>
              </div>
              <p>generate springs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; rows; i++) {

                <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; columns - <span class="hljs-number">1</span>; j++) {

                    f = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>-<span class="hljs-subst">${j}</span>`</span>];
                    t = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>-<span class="hljs-subst">${j + <span class="hljs-number">1</span>}</span>`</span>];
                    springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, f, t, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>-<span class="hljs-subst">${j}</span>~<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>-<span class="hljs-subst">${j + <span class="hljs-number">1</span>}</span>`</span>);
                }
            }

            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; columns; i++) {

                <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; rows - <span class="hljs-number">1</span>; j++) {

                    f = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${j}</span>-<span class="hljs-subst">${i}</span>`</span>];
                    t = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${j + <span class="hljs-number">1</span>}</span>-<span class="hljs-subst">${i}</span>`</span>];
                    springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, f, t, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${j}</span>-<span class="hljs-subst">${i}</span>~<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${j + <span class="hljs-number">1</span>}</span>-<span class="hljs-subst">${i}</span>`</span>);
                }
            }
        }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-64">&#x00a7;</a>
              </div>
              <p><code>strong-net</code> - a net made up of rows and columns, with particles at each row/column intersection. The generator will connect each Particle with springs to up to eight of its closest horizontal, vertical and diagonal neighbors</p>
<ul>
<li>Can be used to model a soft-bodied object</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    [<span class="hljs-variable constant_">STRONG_NET</span>]: <span class="hljs-keyword">function</span> (<span class="hljs-params">host</span>) {

        <span class="hljs-keyword">const</span> { particleStore, <span class="hljs-attr">artefact</span>:art, historyLength, engine, forces, mass, rows, columns, rowDistance, columnDistance, name } = <span class="hljs-variable language_">this</span>;

        <span class="hljs-keyword">if</span> (host &amp;&amp; rows &gt; <span class="hljs-number">0</span> &amp;&amp; columns &gt; <span class="hljs-number">0</span>) {

            <span class="hljs-keyword">let</span> [x, y] = <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentStampPosition</span>;
            <span class="hljs-keyword">let</span> [, height] = host.<span class="hljs-property">currentDimensions</span>;

            <span class="hljs-keyword">let</span> deltaR = (rowDistance.<span class="hljs-property">substring</span>) ? (<span class="hljs-built_in">parseFloat</span>(rowDistance) / <span class="hljs-number">100</span>) * height : rowDistance;
            <span class="hljs-keyword">let</span> deltaC = (columnDistance.<span class="hljs-property">substring</span>) ? (<span class="hljs-built_in">parseFloat</span>(columnDistance) / <span class="hljs-number">100</span>) * height : columnDistance;

            <span class="hljs-keyword">let</span> dx, dy, p, i, j;</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-65">&#x00a7;</a>
              </div>
              <p>generate particles</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; rows; i++) {

                dy = (deltaR * i) + y;

                <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; columns; j++) {

                    dx = (deltaC * j) + x;

                    p = <span class="hljs-title function_">makeParticle</span>({

                        <span class="hljs-attr">name</span>: <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>-<span class="hljs-subst">${j}</span>`</span>,

                        <span class="hljs-attr">positionX</span>: dx,
                        <span class="hljs-attr">positionY</span>: dy,
                        <span class="hljs-attr">positionZ</span>: <span class="hljs-number">0</span>,

                        <span class="hljs-attr">velocityX</span>: <span class="hljs-number">0</span>,
                        <span class="hljs-attr">velocityY</span>: <span class="hljs-number">0</span>,
                        <span class="hljs-attr">velocityZ</span>: <span class="hljs-number">0</span>,

                        historyLength, 
                        engine, 
                        forces, 

                        mass,

                        <span class="hljs-attr">fill</span>: art.<span class="hljs-title function_">get</span>(<span class="hljs-variable constant_">FILL_STYLE</span>),
                        <span class="hljs-attr">stroke</span>: art.<span class="hljs-title function_">get</span>(<span class="hljs-variable constant_">STROKE_STYLE</span>),
                    });

                    p.<span class="hljs-title function_">run</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);

                    particleStore.<span class="hljs-title function_">push</span>(p);
                }
            }

            <span class="hljs-keyword">let</span> f, t;</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-66">&#x00a7;</a>
              </div>
              <p>generate springs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; rows; i++) {

                <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; columns - <span class="hljs-number">1</span>; j++) {

                    f = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>-<span class="hljs-subst">${j}</span>`</span>];
                    t = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>-<span class="hljs-subst">${j + <span class="hljs-number">1</span>}</span>`</span>];
                    springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, f, t, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>-<span class="hljs-subst">${j}</span>~<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>-<span class="hljs-subst">${j + <span class="hljs-number">1</span>}</span>`</span>);
                }
            }

            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; columns; i++) {

                <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; rows - <span class="hljs-number">1</span>; j++) {

                    f = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${j}</span>-<span class="hljs-subst">${i}</span>`</span>];
                    t = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${j + <span class="hljs-number">1</span>}</span>-<span class="hljs-subst">${i}</span>`</span>];
                    springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, f, t, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${j}</span>-<span class="hljs-subst">${i}</span>~<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${j + <span class="hljs-number">1</span>}</span>-<span class="hljs-subst">${i}</span>`</span>);
                }
            }

            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; columns - <span class="hljs-number">1</span>; i++) {

                <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; rows - <span class="hljs-number">1</span>; j++) {

                    f = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${j}</span>-<span class="hljs-subst">${i}</span>`</span>];
                    t = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${j + <span class="hljs-number">1</span>}</span>-<span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span>`</span>];
                    springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, f, t, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${j}</span>-<span class="hljs-subst">${i}</span>~<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${j + <span class="hljs-number">1</span>}</span>-<span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span>`</span>);
                }
            }

            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; columns - <span class="hljs-number">1</span>; i++) {

                <span class="hljs-keyword">for</span> (j = rows - <span class="hljs-number">1</span>; j &gt; <span class="hljs-number">0</span>; j--) {

                    f = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${j}</span>-<span class="hljs-subst">${i}</span>`</span>];
                    t = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${j - <span class="hljs-number">1</span>}</span>-<span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span>`</span>];
                    springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, f, t, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${j}</span>-<span class="hljs-subst">${i}</span>~<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${j - <span class="hljs-number">1</span>}</span>-<span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span>`</span>);
                }
            }
        }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-67">&#x00a7;</a>
              </div>
              <p><code>weak-shape</code> - <strong>Warning: not very stable!</strong> - a rope of Particles set along a path. The generator will connect each Particle with springs to up to six of its closest neighbors</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    [<span class="hljs-variable constant_">WEAK_SHAPE</span>]: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

        <span class="hljs-keyword">const</span> { particleStore, <span class="hljs-attr">artefact</span>:art, historyLength, engine, forces, mass, name, shapeTemplate, precision, joinTemplateEnds } = <span class="hljs-variable language_">this</span>;

        <span class="hljs-keyword">let</span> i, p, f, t;

        <span class="hljs-keyword">if</span> (shapeTemplate &amp;&amp; precision) {

            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; precision; i++) {

                <span class="hljs-keyword">let</span> coords = shapeTemplate.<span class="hljs-title function_">getPathPositionData</span>(i / precision);

                p = <span class="hljs-title function_">makeParticle</span>({

                    <span class="hljs-attr">name</span>: <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>`</span>,

                    <span class="hljs-attr">positionX</span>: coords.<span class="hljs-property">x</span>,
                    <span class="hljs-attr">positionY</span>: coords.<span class="hljs-property">y</span>,
                    <span class="hljs-attr">positionZ</span>: <span class="hljs-number">0</span>,

                    <span class="hljs-attr">velocityX</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-attr">velocityY</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-attr">velocityZ</span>: <span class="hljs-number">0</span>,

                    historyLength,
                    engine,
                    forces,

                    mass,

                    <span class="hljs-attr">fill</span>: art.<span class="hljs-title function_">get</span>(<span class="hljs-variable constant_">FILL_STYLE</span>),
                    <span class="hljs-attr">stroke</span>: art.<span class="hljs-title function_">get</span>(<span class="hljs-variable constant_">STROKE_STYLE</span>),
                });

                p.<span class="hljs-title function_">run</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);

                particleStore.<span class="hljs-title function_">push</span>(p);
            }

            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; precision - <span class="hljs-number">1</span>; i++) {

                f = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>`</span>];
                t = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span>`</span>];
                springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, f, t, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>~<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span>`</span>);
            }

            <span class="hljs-keyword">if</span> (joinTemplateEnds) {

                f = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${precision - <span class="hljs-number">1</span>}</span>`</span>];
                t = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-number">0</span>}</span>`</span>];
                springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, f, t, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${precision - <span class="hljs-number">1</span>}</span>~<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-number">0</span>}</span>`</span>);
            }

            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; precision - <span class="hljs-number">2</span>; i++) {

                f = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>`</span>];
                t = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i + <span class="hljs-number">2</span>}</span>`</span>];
                springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, f, t, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>~<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i + <span class="hljs-number">2</span>}</span>`</span>);
            }

            <span class="hljs-keyword">if</span> (joinTemplateEnds) {

                f = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${precision - <span class="hljs-number">2</span>}</span>`</span>];
                t = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-number">0</span>}</span>`</span>];
                springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, f, t, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${precision - <span class="hljs-number">2</span>}</span>~<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-number">0</span>}</span>`</span>);

                f = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${precision - <span class="hljs-number">1</span>}</span>`</span>];
                t = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-number">1</span>}</span>`</span>];
                springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, f, t, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${precision - <span class="hljs-number">1</span>}</span>~<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-number">1</span>}</span>`</span>);
            }

            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; precision - <span class="hljs-number">3</span>; i++) {

                f = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>`</span>];
                t = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i + <span class="hljs-number">3</span>}</span>`</span>];
                springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, f, t, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>~<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i + <span class="hljs-number">3</span>}</span>`</span>);
            }

            <span class="hljs-keyword">if</span> (joinTemplateEnds) {

                f = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${precision - <span class="hljs-number">3</span>}</span>`</span>];
                t = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-number">0</span>}</span>`</span>];
                springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, f, t, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${precision - <span class="hljs-number">3</span>}</span>~<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-number">0</span>}</span>`</span>);

                f = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${precision - <span class="hljs-number">2</span>}</span>`</span>];
                t = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-number">1</span>}</span>`</span>];
                springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, f, t, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${precision - <span class="hljs-number">2</span>}</span>~<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-number">1</span>}</span>`</span>);

                f = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${precision - <span class="hljs-number">1</span>}</span>`</span>];
                t = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-number">2</span>}</span>`</span>];
                springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, f, t, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${precision - <span class="hljs-number">1</span>}</span>~<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-number">2</span>}</span>`</span>);
            }
        }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-68">&#x00a7;</a>
              </div>
              <p><code>strong-shape</code> - <strong>Warning: generally unstable!</strong> - a rope of Particles set along a path. The generator will connect each Particle with springs to up to six of its closest neighbors, and make an additional connection with a Particle at some distance from it (to act as a strut)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    [<span class="hljs-variable constant_">STRONG_SHAPE</span>]: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

        <span class="hljs-keyword">const</span> { particleStore, <span class="hljs-attr">artefact</span>:art, historyLength, engine, forces, mass, name, shapeTemplate, precision, joinTemplateEnds } = <span class="hljs-variable language_">this</span>;

        <span class="hljs-keyword">let</span> i, p, f, t;

        <span class="hljs-keyword">if</span> (shapeTemplate &amp;&amp; precision) {

            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; precision; i++) {

                <span class="hljs-keyword">let</span> coords = shapeTemplate.<span class="hljs-title function_">getPathPositionData</span>(i / precision);

                p = <span class="hljs-title function_">makeParticle</span>({

                    <span class="hljs-attr">name</span>: <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>`</span>,

                    <span class="hljs-attr">positionX</span>: coords.<span class="hljs-property">x</span>,
                    <span class="hljs-attr">positionY</span>: coords.<span class="hljs-property">y</span>,
                    <span class="hljs-attr">positionZ</span>: <span class="hljs-number">0</span>,

                    <span class="hljs-attr">velocityX</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-attr">velocityY</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-attr">velocityZ</span>: <span class="hljs-number">0</span>,

                    historyLength,
                    engine,
                    forces,

                    mass,

                    <span class="hljs-attr">fill</span>: art.<span class="hljs-title function_">get</span>(<span class="hljs-variable constant_">FILL_STYLE</span>),
                    <span class="hljs-attr">stroke</span>: art.<span class="hljs-title function_">get</span>(<span class="hljs-variable constant_">STROKE_STYLE</span>),
                });

                p.<span class="hljs-title function_">run</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);

                particleStore.<span class="hljs-title function_">push</span>(p);
            }

            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; precision - <span class="hljs-number">1</span>; i++) {

                f = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>`</span>];
                t = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span>`</span>];
                springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, f, t, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>~<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span>`</span>);
            }

            <span class="hljs-keyword">if</span> (joinTemplateEnds) {

                f = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${precision - <span class="hljs-number">1</span>}</span>`</span>];
                t = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-number">0</span>}</span>`</span>];
                springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, f, t, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${precision - <span class="hljs-number">1</span>}</span>~<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-number">0</span>}</span>`</span>);
            }

            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; precision - <span class="hljs-number">2</span>; i++) {

                f = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>`</span>];
                t = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i + <span class="hljs-number">2</span>}</span>`</span>];
                springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, f, t, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>~<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i + <span class="hljs-number">2</span>}</span>`</span>);
            }

            <span class="hljs-keyword">if</span> (joinTemplateEnds) {

                f = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${precision - <span class="hljs-number">2</span>}</span>`</span>];
                t = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-number">0</span>}</span>`</span>];
                springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, f, t, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${precision - <span class="hljs-number">2</span>}</span>~<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-number">0</span>}</span>`</span>);

                f = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${precision - <span class="hljs-number">1</span>}</span>`</span>];
                t = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-number">1</span>}</span>`</span>];
                springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, f, t, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${precision - <span class="hljs-number">1</span>}</span>~<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-number">1</span>}</span>`</span>);
            }

            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; precision - <span class="hljs-number">3</span>; i++) {

                f = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>`</span>];
                t = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i + <span class="hljs-number">3</span>}</span>`</span>];
                springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, f, t, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>~<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i + <span class="hljs-number">3</span>}</span>`</span>);
            }

            <span class="hljs-keyword">if</span> (joinTemplateEnds) {

                f = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${precision - <span class="hljs-number">3</span>}</span>`</span>];
                t = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-number">0</span>}</span>`</span>];
                springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, f, t, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${precision - <span class="hljs-number">3</span>}</span>~<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-number">0</span>}</span>`</span>);

                f = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${precision - <span class="hljs-number">2</span>}</span>`</span>];
                t = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-number">1</span>}</span>`</span>];
                springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, f, t, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${precision - <span class="hljs-number">2</span>}</span>~<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-number">1</span>}</span>`</span>);

                f = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${precision - <span class="hljs-number">1</span>}</span>`</span>];
                t = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-number">2</span>}</span>`</span>];
                springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, f, t, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${precision - <span class="hljs-number">1</span>}</span>~<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-number">2</span>}</span>`</span>);
            }

            <span class="hljs-keyword">let</span> halfPrecision = <span class="hljs-title function_">_floor</span>(precision / <span class="hljs-number">2</span>);

            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; precision - halfPrecision; i++) {

                f = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>`</span>];

                <span class="hljs-keyword">if</span> (i + halfPrecision &lt; precision - <span class="hljs-number">1</span>) {

                    t = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i + halfPrecision}</span>`</span>];
                    springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, f, t, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>~<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i + halfPrecision}</span>`</span>);
                }
            }
        }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-69">&#x00a7;</a>
              </div>
              <p><code>hub-spoke</code> - <strong>Warning: highly unstable!</strong> - a rope of Particles set along a path. The generator will connect each Particle with springs to its closest neighbors, and make an additional connection with a ‘hub’ particle at the template’s rotation-reflection point.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    [<span class="hljs-variable constant_">HUB_SPOKE</span>]: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

        <span class="hljs-keyword">let</span> { shapeTemplate, precision } = <span class="hljs-variable language_">this</span>;

        <span class="hljs-keyword">if</span> (shapeTemplate &amp;&amp; shapeTemplate.<span class="hljs-property">type</span> &amp;&amp; precision) {

            <span class="hljs-keyword">const</span> { particleStore, <span class="hljs-attr">artefact</span>:art, historyLength, engine, forces, mass, name, joinTemplateEnds } = <span class="hljs-variable language_">this</span>;

            <span class="hljs-keyword">let</span> i, p, f, t, hub;

            <span class="hljs-keyword">if</span> (<span class="hljs-variable constant_">HUB_ARTEFACTS_1</span>.<span class="hljs-title function_">includes</span>(shapeTemplate.<span class="hljs-property">type</span>)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-70">&#x00a7;</a>
              </div>
              <p>build the rim</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; precision; i++) {

                    <span class="hljs-keyword">let</span> coords = shapeTemplate.<span class="hljs-title function_">getPathPositionData</span>(i / precision);

                    p = <span class="hljs-title function_">makeParticle</span>({

                        <span class="hljs-attr">name</span>: <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>`</span>,

                        <span class="hljs-attr">positionX</span>: coords.<span class="hljs-property">x</span>,
                        <span class="hljs-attr">positionY</span>: coords.<span class="hljs-property">y</span>,
                        <span class="hljs-attr">positionZ</span>: <span class="hljs-number">0</span>,

                        <span class="hljs-attr">velocityX</span>: <span class="hljs-number">0</span>,
                        <span class="hljs-attr">velocityY</span>: <span class="hljs-number">0</span>,
                        <span class="hljs-attr">velocityZ</span>: <span class="hljs-number">0</span>,

                        historyLength,
                        engine,
                        forces,

                        mass,

                        <span class="hljs-attr">fill</span>: art.<span class="hljs-title function_">get</span>(<span class="hljs-variable constant_">FILL_STYLE</span>),
                        <span class="hljs-attr">stroke</span>: art.<span class="hljs-title function_">get</span>(<span class="hljs-variable constant_">STROKE_STYLE</span>),
                    });

                    p.<span class="hljs-title function_">run</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);

                    particleStore.<span class="hljs-title function_">push</span>(p);
                }

                <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; precision - <span class="hljs-number">1</span>; i++) {

                    f = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>`</span>];
                    t = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span>`</span>];
                    springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, f, t, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>-<span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span>`</span>);
                }

                <span class="hljs-keyword">if</span> (joinTemplateEnds) {

                    f = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${precision - <span class="hljs-number">1</span>}</span>`</span>];
                    t = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-number">0</span>}</span>`</span>];
                    springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, f, t, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${precision - <span class="hljs-number">1</span>}</span>-0`</span>);
                }

                <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; precision - <span class="hljs-number">2</span>; i++) {

                    f = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>`</span>];
                    t = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i + <span class="hljs-number">2</span>}</span>`</span>];
                    springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, f, t, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i}</span>~<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${i + <span class="hljs-number">2</span>}</span>`</span>);
                }

                <span class="hljs-keyword">if</span> (joinTemplateEnds) {

                    f = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${precision - <span class="hljs-number">2</span>}</span>`</span>];
                    t = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-number">0</span>}</span>`</span>];
                    springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, f, t, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${precision - <span class="hljs-number">2</span>}</span>~<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-number">0</span>}</span>`</span>);

                    f = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${precision - <span class="hljs-number">1</span>}</span>`</span>];
                    t = particle[<span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-number">1</span>}</span>`</span>];
                    springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, f, t, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${precision - <span class="hljs-number">1</span>}</span>~<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-number">1</span>}</span>`</span>);
                }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-71">&#x00a7;</a>
              </div>
              <p>TODO: consider whether we need these
else if (HUB_ARTEFACTS_2.includes(host.type)) {}
else if (HUB_ARTEFACTS_3.includes(host.type)) {}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">const</span> [x, y] = shapeTemplate.<span class="hljs-title function_">get</span>(<span class="hljs-variable constant_">POSITION</span>);

            hub = <span class="hljs-title function_">makeParticle</span>({

                <span class="hljs-attr">name</span>: <span class="hljs-string">`<span class="hljs-subst">${name}</span>-hub`</span>,

                <span class="hljs-attr">positionX</span>: x,
                <span class="hljs-attr">positionY</span>: y,
                <span class="hljs-attr">positionZ</span>: <span class="hljs-number">0</span>,

                <span class="hljs-attr">velocityX</span>: <span class="hljs-number">0</span>,
                <span class="hljs-attr">velocityY</span>: <span class="hljs-number">0</span>,
                <span class="hljs-attr">velocityZ</span>: <span class="hljs-number">0</span>,

                historyLength,
                engine,
                forces,

                mass,

                <span class="hljs-attr">fill</span>: art.<span class="hljs-title function_">get</span>(<span class="hljs-variable constant_">FILL_STYLE</span>),
                <span class="hljs-attr">stroke</span>: art.<span class="hljs-title function_">get</span>(<span class="hljs-variable constant_">STROKE_STYLE</span>),
            });

            hub.<span class="hljs-title function_">run</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);

            particleStore.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">p, index</span>) =&gt;</span> springMaker.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, p, hub, <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${index}</span>-hub`</span>));

            particleStore.<span class="hljs-title function_">push</span>(hub);
        }
    },
};</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-72">&#x00a7;</a>
              </div>
              <h4 id="factory">Factory</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> makeNet = <span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) {

    <span class="hljs-keyword">if</span> (!items) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Net</span>(items);
};

constructors.<span class="hljs-property">Net</span> = <span class="hljs-title class_">Net</span>;</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
