<!DOCTYPE html>

<html>
<head>
  <title>Drag-and-drop zones.</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="../core/animationloop.html">
                  ./source/core/animationloop.js
                </a>
              
                
                <a class="source" href="../core/display-cycle.html">
                  ./source/core/display-cycle.js
                </a>
              
                
                <a class="source" href="../core/document-rootElements.html">
                  ./source/core/document-rootElements.js
                </a>
              
                
                <a class="source" href="../core/document.html">
                  ./source/core/document.js
                </a>
              
                
                <a class="source" href="../core/events.html">
                  ./source/core/events.js
                </a>
              
                
                <a class="source" href="../core/init.html">
                  ./source/core/init.js
                </a>
              
                
                <a class="source" href="../core/library.html">
                  ./source/core/library.js
                </a>
              
                
                <a class="source" href="../core/random-seed.html">
                  ./source/core/random-seed.js
                </a>
              
                
                <a class="source" href="../core/snippets.html">
                  ./source/core/snippets.js
                </a>
              
                
                <a class="source" href="../core/system-flags.html">
                  ./source/core/system-flags.js
                </a>
              
                
                <a class="source" href="../core/userInteraction.html">
                  ./source/core/userInteraction.js
                </a>
              
                
                <a class="source" href="../core/utilities.html">
                  ./source/core/utilities.js
                </a>
              
                
                <a class="source" href="action.html">
                  ./source/factory/action.js
                </a>
              
                
                <a class="source" href="anchor.html">
                  ./source/factory/anchor.js
                </a>
              
                
                <a class="source" href="animation.html">
                  ./source/factory/animation.js
                </a>
              
                
                <a class="source" href="bezier.html">
                  ./source/factory/bezier.js
                </a>
              
                
                <a class="source" href="block.html">
                  ./source/factory/block.js
                </a>
              
                
                <a class="source" href="canvas.html">
                  ./source/factory/canvas.js
                </a>
              
                
                <a class="source" href="cell-fragment.html">
                  ./source/factory/cell-fragment.js
                </a>
              
                
                <a class="source" href="cell.html">
                  ./source/factory/cell.js
                </a>
              
                
                <a class="source" href="cog.html">
                  ./source/factory/cog.js
                </a>
              
                
                <a class="source" href="color.html">
                  ./source/factory/color.js
                </a>
              
                
                <a class="source" href="conicGradient.html">
                  ./source/factory/conicGradient.js
                </a>
              
                
                <a class="source" href="coordinate.html">
                  ./source/factory/coordinate.js
                </a>
              
                
                <a class="source" href="crescent.html">
                  ./source/factory/crescent.js
                </a>
              
                
                <a class="source" href="dragZone.html">
                  ./source/factory/dragZone.js
                </a>
              
                
                <a class="source" href="element.html">
                  ./source/factory/element.js
                </a>
              
                
                <a class="source" href="emitter.html">
                  ./source/factory/emitter.js
                </a>
              
                
                <a class="source" href="filter.html">
                  ./source/factory/filter.js
                </a>
              
                
                <a class="source" href="filterEngine-bluenoiseData.html">
                  ./source/factory/filterEngine-bluenoiseData.js
                </a>
              
                
                <a class="source" href="filterEngine.html">
                  ./source/factory/filterEngine.js
                </a>
              
                
                <a class="source" href="fontAttributes.html">
                  ./source/factory/fontAttributes.js
                </a>
              
                
                <a class="source" href="gradient.html">
                  ./source/factory/gradient.js
                </a>
              
                
                <a class="source" href="grid.html">
                  ./source/factory/grid.js
                </a>
              
                
                <a class="source" href="group.html">
                  ./source/factory/group.js
                </a>
              
                
                <a class="source" href="imageAsset.html">
                  ./source/factory/imageAsset.js
                </a>
              
                
                <a class="source" href="keyboardZone.html">
                  ./source/factory/keyboardZone.js
                </a>
              
                
                <a class="source" href="line.html">
                  ./source/factory/line.js
                </a>
              
                
                <a class="source" href="lineSpiral.html">
                  ./source/factory/lineSpiral.js
                </a>
              
                
                <a class="source" href="loom.html">
                  ./source/factory/loom.js
                </a>
              
                
                <a class="source" href="mesh.html">
                  ./source/factory/mesh.js
                </a>
              
                
                <a class="source" href="net.html">
                  ./source/factory/net.js
                </a>
              
                
                <a class="source" href="noiseAsset.html">
                  ./source/factory/noiseAsset.js
                </a>
              
                
                <a class="source" href="observeUpdate.html">
                  ./source/factory/observeUpdate.js
                </a>
              
                
                <a class="source" href="oval.html">
                  ./source/factory/oval.js
                </a>
              
                
                <a class="source" href="palette.html">
                  ./source/factory/palette.js
                </a>
              
                
                <a class="source" href="particle.html">
                  ./source/factory/particle.js
                </a>
              
                
                <a class="source" href="particleForce.html">
                  ./source/factory/particleForce.js
                </a>
              
                
                <a class="source" href="particleHistory.html">
                  ./source/factory/particleHistory.js
                </a>
              
                
                <a class="source" href="particleSpring.html">
                  ./source/factory/particleSpring.js
                </a>
              
                
                <a class="source" href="particleWorld.html">
                  ./source/factory/particleWorld.js
                </a>
              
                
                <a class="source" href="pattern.html">
                  ./source/factory/pattern.js
                </a>
              
                
                <a class="source" href="phrase.html">
                  ./source/factory/phrase.js
                </a>
              
                
                <a class="source" href="picture.html">
                  ./source/factory/picture.js
                </a>
              
                
                <a class="source" href="polygon.html">
                  ./source/factory/polygon.js
                </a>
              
                
                <a class="source" href="polyline.html">
                  ./source/factory/polyline.js
                </a>
              
                
                <a class="source" href="quadratic.html">
                  ./source/factory/quadratic.js
                </a>
              
                
                <a class="source" href="quaternion.html">
                  ./source/factory/quaternion.js
                </a>
              
                
                <a class="source" href="radialGradient.html">
                  ./source/factory/radialGradient.js
                </a>
              
                
                <a class="source" href="rawAsset.html">
                  ./source/factory/rawAsset.js
                </a>
              
                
                <a class="source" href="rdAsset.html">
                  ./source/factory/rdAsset.js
                </a>
              
                
                <a class="source" href="rectangle.html">
                  ./source/factory/rectangle.js
                </a>
              
                
                <a class="source" href="renderAnimation.html">
                  ./source/factory/renderAnimation.js
                </a>
              
                
                <a class="source" href="shape.html">
                  ./source/factory/shape.js
                </a>
              
                
                <a class="source" href="spiral.html">
                  ./source/factory/spiral.js
                </a>
              
                
                <a class="source" href="spriteAsset.html">
                  ./source/factory/spriteAsset.js
                </a>
              
                
                <a class="source" href="stack.html">
                  ./source/factory/stack.js
                </a>
              
                
                <a class="source" href="star.html">
                  ./source/factory/star.js
                </a>
              
                
                <a class="source" href="state.html">
                  ./source/factory/state.js
                </a>
              
                
                <a class="source" href="tetragon.html">
                  ./source/factory/tetragon.js
                </a>
              
                
                <a class="source" href="ticker.html">
                  ./source/factory/ticker.js
                </a>
              
                
                <a class="source" href="tracer.html">
                  ./source/factory/tracer.js
                </a>
              
                
                <a class="source" href="tween.html">
                  ./source/factory/tween.js
                </a>
              
                
                <a class="source" href="unstackedElement.html">
                  ./source/factory/unstackedElement.js
                </a>
              
                
                <a class="source" href="vector.html">
                  ./source/factory/vector.js
                </a>
              
                
                <a class="source" href="videoAsset.html">
                  ./source/factory/videoAsset.js
                </a>
              
                
                <a class="source" href="wheel.html">
                  ./source/factory/wheel.js
                </a>
              
                
                <a class="source" href="../mixin/anchor.html">
                  ./source/mixin/anchor.js
                </a>
              
                
                <a class="source" href="../mixin/asset.html">
                  ./source/mixin/asset.js
                </a>
              
                
                <a class="source" href="../mixin/assetAdvancedFunctionality.html">
                  ./source/mixin/assetAdvancedFunctionality.js
                </a>
              
                
                <a class="source" href="../mixin/assetConsumer.html">
                  ./source/mixin/assetConsumer.js
                </a>
              
                
                <a class="source" href="../mixin/base.html">
                  ./source/mixin/base.js
                </a>
              
                
                <a class="source" href="../mixin/cascade.html">
                  ./source/mixin/cascade.js
                </a>
              
                
                <a class="source" href="../mixin/delta.html">
                  ./source/mixin/delta.js
                </a>
              
                
                <a class="source" href="../mixin/displayShape.html">
                  ./source/mixin/displayShape.js
                </a>
              
                
                <a class="source" href="../mixin/dom.html">
                  ./source/mixin/dom.js
                </a>
              
                
                <a class="source" href="../mixin/entity.html">
                  ./source/mixin/entity.js
                </a>
              
                
                <a class="source" href="../mixin/filter.html">
                  ./source/mixin/filter.js
                </a>
              
                
                <a class="source" href="../mixin/mimic.html">
                  ./source/mixin/mimic.js
                </a>
              
                
                <a class="source" href="../mixin/path.html">
                  ./source/mixin/path.js
                </a>
              
                
                <a class="source" href="../mixin/pattern.html">
                  ./source/mixin/pattern.js
                </a>
              
                
                <a class="source" href="../mixin/pivot.html">
                  ./source/mixin/pivot.js
                </a>
              
                
                <a class="source" href="../mixin/position.html">
                  ./source/mixin/position.js
                </a>
              
                
                <a class="source" href="../mixin/shapeBasic.html">
                  ./source/mixin/shapeBasic.js
                </a>
              
                
                <a class="source" href="../mixin/shapeCurve.html">
                  ./source/mixin/shapeCurve.js
                </a>
              
                
                <a class="source" href="../mixin/shapePathCalculation.html">
                  ./source/mixin/shapePathCalculation.js
                </a>
              
                
                <a class="source" href="../mixin/styles.html">
                  ./source/mixin/styles.js
                </a>
              
                
                <a class="source" href="../mixin/tween.html">
                  ./source/mixin/tween.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-1">&#x00a7;</a>
              </div>
              <h1 id="drag-and-drop-zones">Drag-and-drop zones.</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> library <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../core/library.js&quot;</span>;
<span class="hljs-keyword">import</span> { xta, isa_fn, isa_boolean, isa_obj, λ<span class="hljs-literal">null</span>, Ωempty } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../core/utilities.js&quot;</span>;
<span class="hljs-keyword">import</span> { addListener, removeListener } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../core/events.js&quot;</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-2">&#x00a7;</a>
              </div>
              <p><strong>makeDragZone</strong> is an attempt to make setting up drag-and-drop functionality within a Scrawl-canvas stack or canvas as simple as possible. The functionality has been designed to allow multiple drag zones to be set on a canvas or stack element, while limiting the number of event listeners that need to be applied to the element to make the magic happen.</p>
<p>Required attribute of the argument object:</p>
<ul>
<li><strong>.zone</strong> - either the String name of the Stack or Canvas artefact which will host the zone, or the Stack or Canvas artefact itself</li>
</ul>
<p>Additional, optional, attributes in the argument object</p>
<ul>
<li><strong>.coordinateSource</strong> - an object containing a <code>here</code> object</li>
<li><strong>.coordinateSource</strong> - an object containing a <code>here</code> object</li>
<li><strong>.collisionGroup</strong> - String name of Group object, or Group object itself</li>
<li><strong>.startOn</strong> - Array of Strings</li>
<li><strong>.endOn</strong> - Array of Strings</li>
<li><strong>.exposeCurrentArtefact</strong> - Boolean (default: false)</li>
<li><strong>.preventTouchDefaultWhenDragging</strong> - Boolean (default: false)</li>
<li><strong>.resetCoordsToZeroOnTouchEnd</strong> - Boolean (default: true)</li>
</ul>
<p>At the heart of the drag zone are a set of functions (or alternatively, objects that can be applied to the selected artefact) which define the actions that happen when a user starts, continues and stops dragging an artefact in the zone. It is possible to set different actions depending on whether the user is pressing the shift button while they perform the drag action:</p>
<ul>
<li><strong>.updateOnStart</strong>, <strong>.updateOnShiftStart</strong> - Function, or a <code>set</code> object to be applied to the current artefact</li>
<li><strong>.updateOnEnd</strong>, <strong>.updateOnShiftEnd</strong> - Function, or a <code>set</code> object to be applied to the current artefact</li>
<li><strong>.updateWhileMoving</strong>, <strong>.updateWhileShiftMoving</strong> - Function to be run while drag is in progress</li>
<li><strong>.updateOnPrematureExit</strong> - Function that will run when checks (defined in code elsewhere) trigger a premature exit from the drag zone. The triggering code can be used, for instance, to make sure an artefact does not leave a given area of the cell, within the canvas element boundaries</li>
</ul>
<p>Multiple drag zones can be defined on a canvas or stack element. When a user presses the mouse button to start a drag the code will interrogate each drag zone in turn to discover if one of them has an artefact which collides with the mouse cursor; if yes, that drag zone takes precedence for the subsequent move and drop actions</p>
<ul>
<li><strong>.processingOrder</strong> - positive integer Number - drag zones with a lower value will be interrogated ahead of those with a higher value</li>
</ul>
<p>If the <code>exposeCurrentArtefact</code> attribute is true, the <code>makeDragZone</code> factory returns a function that can be invoked at any time to get the collision data object (containing x, y, artefact attributes) for the artefact being dragged (false if nothing is being dragged). The function can also be triggered with the following string arguments:</p>
<ul>
<li><code>&#39;exit&#39;</code> or <code>&#39;drop</code> - force the drag action to end</li>
<li>any other truthy argument - kill the drag zone object. If it was the only drag zone object associated with a given canvas or stack element then the event listeners will also be removed from the element</li>
<li>null, undefined, any other falsy argument - return the collision data object</li>
</ul>
<p>If the <code>exposeCurrentArtefact</code> attribute is false, or omitted, the function returns a kill function that can be invoked (with no arguments) to remove the event listeners from the Stack or Canvas zone’s DOM element.</p>
<p>NOTE: drag-and-drop functionality using this factory function <strong>is not guaranteed</strong> for artefacts referencing a path, or for artefacts whose reference artefact in turn references another artefact in any way.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> dragZones = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-3">&#x00a7;</a>
              </div>
              <p>Generate the drag zone and associate it with the zone element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> processDragZoneData = <span class="hljs-keyword">function</span> (<span class="hljs-params">items = Ωempty, doAddListeners, doRemoveListeners</span>) {

    <span class="hljs-keyword">let</span> {
        zone, 
        coordinateSource, 
        collisionGroup, 
        startOn, 
        endOn, 
        updateOnStart, 
        updateOnEnd, 
        updateWhileMoving, 
        updateOnShiftStart, 
        updateOnShiftEnd, 
        updateWhileShiftMoving, 
        updateOnPrematureExit,
        exposeCurrentArtefact, 
        preventTouchDefaultWhenDragging, 
        resetCoordsToZeroOnTouchEnd, 
        processingOrder,
    } = items;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-4">&#x00a7;</a>
              </div>
              <p><code>zone</code> is required</p>
<ul>
<li>must be either a Canvas or Stack wrapper, or a wrapper’s String name</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!zone) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;dragZone constructor - no zone supplied&#x27;</span>);

    <span class="hljs-keyword">if</span> (zone.<span class="hljs-property">substring</span>) zone = artefact[zone];

    <span class="hljs-keyword">if</span> (!zone || [<span class="hljs-string">&#x27;Canvas&#x27;</span>, <span class="hljs-string">&#x27;Stack&#x27;</span>].<span class="hljs-title function_">indexOf</span>(zone.<span class="hljs-property">type</span>) &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;dragZone constructor - zone object is not a Stack or Canvas wrapper&#x27;</span>);

    <span class="hljs-keyword">let</span> target = zone.<span class="hljs-property">domElement</span>;

    <span class="hljs-keyword">if</span> (!target) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;dragZone constructor - zone does not contain a target DOM element&#x27;</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-5">&#x00a7;</a>
              </div>
              <p><code>collisionGroup</code> is optional; defaults to zone’s namesake group</p>
<ul>
<li>must be a Group object</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!collisionGroup) {

        <span class="hljs-keyword">if</span> (zone.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;Canvas&#x27;</span>) collisionGroup = library.<span class="hljs-property">group</span>[zone.<span class="hljs-property">base</span>.<span class="hljs-property">name</span>];
        <span class="hljs-keyword">else</span> collisionGroup = library.<span class="hljs-property">group</span>[zone.<span class="hljs-property">name</span>];
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (collisionGroup.<span class="hljs-property">substring</span>) collisionGroup = library.<span class="hljs-property">group</span>[collisionGroup];

    <span class="hljs-keyword">if</span> (!collisionGroup || collisionGroup.<span class="hljs-property">type</span> !== <span class="hljs-string">&#x27;Group&#x27;</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;dragZone constructor - unable to recover collisionGroup group&#x27;</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-6">&#x00a7;</a>
              </div>
              <p><code>coordinateSource</code> will be an object containing <code>x</code> and <code>y</code> attributes</p>
<ul>
<li>default’s to the zone’s <code>here</code> object</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (coordinateSource) {

        <span class="hljs-keyword">if</span> (coordinateSource.<span class="hljs-property">here</span>) coordinateSource = coordinateSource.<span class="hljs-property">here</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">xta</span>(coordinateSource.<span class="hljs-property">x</span>, coordinateSource.<span class="hljs-property">y</span>)) coordinateSource = <span class="hljs-literal">false</span>;
    }
    <span class="hljs-keyword">else</span> {

        <span class="hljs-keyword">if</span> (zone.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;Canvas&#x27;</span>) coordinateSource = zone.<span class="hljs-property">base</span>.<span class="hljs-property">here</span>;
        <span class="hljs-keyword">else</span> coordinateSource = zone.<span class="hljs-property">here</span>;
    }

    <span class="hljs-keyword">if</span> (!coordinateSource) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;dragZone constructor - unable to discover a usable coordinateSource object&#x27;</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-7">&#x00a7;</a>
              </div>
              <p><code>startOn</code>, <code>endOn</code> - if supplied, then need to be arrays</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(startOn)) startOn = [<span class="hljs-string">&#x27;down&#x27;</span>];
    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(endOn)) endOn = [<span class="hljs-string">&#x27;up&#x27;</span>];

    <span class="hljs-keyword">if</span> (exposeCurrentArtefact == <span class="hljs-literal">null</span>) exposeCurrentArtefact = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">if</span> (preventTouchDefaultWhenDragging == <span class="hljs-literal">null</span>) preventTouchDefaultWhenDragging = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">if</span> (resetCoordsToZeroOnTouchEnd == <span class="hljs-literal">null</span>) resetCoordsToZeroOnTouchEnd = <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-8">&#x00a7;</a>
              </div>
              <p><code>updateOnStart</code>, <code>updateOnEnd</code>, <code>updateOnShiftStart</code>, <code>updateOnShiftEnd</code> - if supplied, then needs to be key:value objects which will be applied to the entity (using set) or, alternatively, a callback function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isa_obj</span>(updateOnStart)) updateOnStart = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) { current.<span class="hljs-property">artefact</span>.<span class="hljs-title function_">set</span>(items.<span class="hljs-property">updateOnStart</span>) };
    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isa_fn</span>(updateOnStart)) updateOnStart = λ<span class="hljs-literal">null</span>;

    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isa_obj</span>(updateOnShiftStart)) updateOnShiftStart = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) { current.<span class="hljs-property">artefact</span>.<span class="hljs-title function_">set</span>(items.<span class="hljs-property">updateOnShiftStart</span>) };
    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isa_fn</span>(updateOnShiftStart)) updateOnShiftStart = updateOnStart;

    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isa_obj</span>(updateOnEnd)) updateOnEnd = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) { current.<span class="hljs-property">artefact</span>.<span class="hljs-title function_">set</span>(items.<span class="hljs-property">updateOnEnd</span>) };
    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isa_fn</span>(updateOnEnd)) updateOnEnd = λ<span class="hljs-literal">null</span>;

    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isa_obj</span>(updateOnShiftEnd)) updateOnShiftEnd = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) { current.<span class="hljs-property">artefact</span>.<span class="hljs-title function_">set</span>(items.<span class="hljs-property">updateOnShiftEnd</span>) };
    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isa_fn</span>(updateOnShiftEnd)) updateOnShiftEnd = updateOnEnd;</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-9">&#x00a7;</a>
              </div>
              <p><code>updateWhileMoving</code>, <code>updateWhileShiftMoving</code> - if supplied, needs to be a callback function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isa_fn</span>(updateWhileMoving)) updateWhileMoving = λ<span class="hljs-literal">null</span>;
    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isa_fn</span>(updateWhileShiftMoving)) updateWhileShiftMoving = updateWhileMoving;</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-10">&#x00a7;</a>
              </div>
              <p><code>updateOnPrematureExit</code> - if supplied, needs to be a callback function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isa_fn</span>(updateOnPrematureExit)) updateOnPrematureExit = λ<span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-11">&#x00a7;</a>
              </div>
              <p><code>exposeCurrentArtefact</code> - if supplied, then needs to be a boolean</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isa_boolean</span>(exposeCurrentArtefact)) exposeCurrentArtefact = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">if</span> (processingOrder == <span class="hljs-literal">null</span>) processingOrder = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-12">&#x00a7;</a>
              </div>
              <p>We can only drag one artefact at a time; that artefact - alongside the hit coordinate’s x and y values -  is stored in the <code>current</code> variable</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> current = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">const</span> checkE = <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {

        <span class="hljs-keyword">if</span> (e &amp;&amp; e.<span class="hljs-property">cancelable</span>) {
            
            <span class="hljs-keyword">if</span> (preventTouchDefaultWhenDragging &amp;&amp; current) {

                e.<span class="hljs-title function_">preventDefault</span>();
                e.<span class="hljs-property">returnValue</span> = <span class="hljs-literal">false</span>;
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!preventTouchDefaultWhenDragging) {

                e.<span class="hljs-title function_">preventDefault</span>();
                e.<span class="hljs-property">returnValue</span> = <span class="hljs-literal">false</span>;
            }
        }
    };

    <span class="hljs-keyword">const</span> pickup = <span class="hljs-keyword">function</span> (<span class="hljs-params">e = Ωempty</span>) {

        <span class="hljs-title function_">checkE</span>(e);

        <span class="hljs-keyword">let</span> type = e.<span class="hljs-property">type</span>;
        <span class="hljs-keyword">if</span> (type === <span class="hljs-string">&#x27;touchstart&#x27;</span> || type === <span class="hljs-string">&#x27;touchcancel&#x27;</span>) <span class="hljs-title function_">touchAction</span>(e, resetCoordsToZeroOnTouchEnd);

        current = collisionGroup.<span class="hljs-title function_">getArtefactAt</span>(coordinateSource);

        <span class="hljs-keyword">if</span> (current) {

            current.<span class="hljs-property">artefact</span>.<span class="hljs-title function_">pickupArtefact</span>(coordinateSource);
            <span class="hljs-keyword">if</span> (e.<span class="hljs-property">shiftKey</span>) <span class="hljs-title function_">updateOnShiftStart</span>(e);
            <span class="hljs-keyword">else</span> <span class="hljs-title function_">updateOnStart</span>(e);
        }
        <span class="hljs-keyword">return</span> {
            current,
            move,
            drop,
        };
    };

    <span class="hljs-keyword">const</span> move = <span class="hljs-keyword">function</span> (<span class="hljs-params">e = Ωempty</span>) {

        <span class="hljs-keyword">if</span> (current) {

            <span class="hljs-title function_">checkE</span>(e);

            <span class="hljs-keyword">let</span> type = e.<span class="hljs-property">type</span>;
            <span class="hljs-keyword">if</span> (type === <span class="hljs-string">&#x27;touchmove&#x27;</span>) <span class="hljs-title function_">touchAction</span>(e);

            <span class="hljs-keyword">if</span> (e.<span class="hljs-property">shiftKey</span>) <span class="hljs-title function_">updateWhileShiftMoving</span>(e);
            <span class="hljs-keyword">else</span> <span class="hljs-title function_">updateWhileMoving</span>(e);
        }
    };

    <span class="hljs-keyword">const</span> drop = <span class="hljs-keyword">function</span> (<span class="hljs-params">e = Ωempty</span>) {

        <span class="hljs-keyword">if</span> (current) {

            <span class="hljs-title function_">checkE</span>(e);

            <span class="hljs-keyword">let</span> type = e.<span class="hljs-property">type</span>;
            <span class="hljs-keyword">if</span> (type === <span class="hljs-string">&#x27;touchend&#x27;</span>) {

                <span class="hljs-title function_">touchAction</span>(e, resetCoordsToZeroOnTouchEnd);
            }

            current.<span class="hljs-property">artefact</span>.<span class="hljs-title function_">dropArtefact</span>();
            <span class="hljs-keyword">if</span> (e.<span class="hljs-property">shiftKey</span>) <span class="hljs-title function_">updateOnShiftEnd</span>(e);
            <span class="hljs-keyword">else</span> <span class="hljs-title function_">updateOnEnd</span>(e);
            current = <span class="hljs-literal">false</span>;
        }
    };

    <span class="hljs-keyword">if</span> (!dragZones[zone.<span class="hljs-property">name</span>]) {

        dragZones[zone.<span class="hljs-property">name</span>] = [];
        <span class="hljs-title function_">doAddListeners</span>(startOn, endOn, target);
    }

    <span class="hljs-keyword">const</span> kill = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

        <span class="hljs-keyword">const</span> name = <span class="hljs-string">`<span class="hljs-subst">${zone.name}</span>_<span class="hljs-subst">${collisionGroup.name}</span>_<span class="hljs-subst">${processingOrder}</span>`</span>;

        dragZones[zone.<span class="hljs-property">name</span>] = dragZones[zone.<span class="hljs-property">name</span>].<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">z</span> =&gt;</span> z.<span class="hljs-property">name</span> !== name);

        <span class="hljs-keyword">if</span> (!dragZones[zone.<span class="hljs-property">name</span>].<span class="hljs-property">length</span>) {
            <span class="hljs-title function_">doRemoveListeners</span>(startOn, endOn, target);
            <span class="hljs-keyword">delete</span> dragZones[zone.<span class="hljs-property">name</span>];
        }
    };

    <span class="hljs-keyword">const</span> getCurrent = <span class="hljs-keyword">function</span> (<span class="hljs-params">actionKill</span>) {

        <span class="hljs-keyword">if</span> (actionKill) {

            <span class="hljs-keyword">if</span> (actionKill === <span class="hljs-string">&#x27;exit&#x27;</span> || actionKill === <span class="hljs-string">&#x27;drop&#x27;</span>) {

                <span class="hljs-title function_">drop</span>();
                <span class="hljs-title function_">updateOnPrematureExit</span>();
            }
            <span class="hljs-keyword">else</span> <span class="hljs-title function_">kill</span>();
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> current;
    };

    <span class="hljs-keyword">const</span> data = {
        <span class="hljs-attr">name</span>: <span class="hljs-string">`<span class="hljs-subst">${zone.name}</span>_<span class="hljs-subst">${collisionGroup.name}</span>_<span class="hljs-subst">${processingOrder}</span>`</span>,
        exposeCurrentArtefact, 
        target,
        processingOrder,
        pickup,
        move,
        drop,
        kill,
        getCurrent,
    };

    dragZones[zone.<span class="hljs-property">name</span>].<span class="hljs-title function_">push</span>(data);

    dragZones[zone.<span class="hljs-property">name</span>].<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a.<span class="hljs-property">processingOrder</span> - b.<span class="hljs-property">processingOrder</span>);

    <span class="hljs-keyword">return</span> {
        exposeCurrentArtefact, 
        getCurrent,
        kill,
        zone,
    };
};</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-13">&#x00a7;</a>
              </div>
              <p><code>Exported function</code> (to modules and the SC object). Add drag-and-drop functionality to a canvas or stack wrapper.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> makeDragZone = <span class="hljs-keyword">function</span> (<span class="hljs-params">items = Ωempty</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-14">&#x00a7;</a>
              </div>
              <p>The exposed <code>pickup</code> function will search for the target element (if user has started the drag while the mouse cursor was over a child of the Stack wrapper) and then interrogate each drag zone associated with that target until it finds a zone reporting a hit</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">pickup</span> = (<span class="hljs-params">e = Ωempty</span>) =&gt; {

        <span class="hljs-keyword">if</span> (e &amp;&amp; e.<span class="hljs-property">target</span>) {

            <span class="hljs-keyword">let</span> myTarget = e.<span class="hljs-property">target</span>,
                name = <span class="hljs-string">&#x27;&#x27;</span>;

            <span class="hljs-keyword">while</span> (!name) {

                <span class="hljs-keyword">if</span> (dragZones[myTarget.<span class="hljs-property">id</span>]) name = myTarget.<span class="hljs-property">id</span>;
                <span class="hljs-keyword">if</span> (myTarget.<span class="hljs-property">tagName</span> === <span class="hljs-string">&#x27;BODY&#x27;</span>) <span class="hljs-keyword">break</span>;
                myTarget = myTarget.<span class="hljs-property">parentElement</span>;
            }

            <span class="hljs-keyword">const</span> variants = dragZones[name];

            <span class="hljs-keyword">if</span> (variants) {

                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>, iz = variants.<span class="hljs-property">length</span>; i &lt; iz; i++) {

                    <span class="hljs-keyword">const</span> v = variants[i];

                    <span class="hljs-keyword">const</span> res = v.<span class="hljs-title function_">pickup</span>(e);

                    <span class="hljs-keyword">if</span> (res.<span class="hljs-property">current</span>) {

                        currentMove = res.<span class="hljs-property">move</span>;
                        currentDrop = res.<span class="hljs-property">drop</span>;
                        <span class="hljs-keyword">break</span>;
                    }
                }
            }
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-15">&#x00a7;</a>
              </div>
              <p>The exposed <code>move</code> and <code>drop</code> functions will change to match the equivalent funtions supplied by the zone selected during the <code>pickup</code> stage of the operation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> currentMove = λ<span class="hljs-literal">null</span>;
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">move</span> = (<span class="hljs-params">e = Ωempty</span>) =&gt; {

        <span class="hljs-title function_">currentMove</span>(e);
    };

    <span class="hljs-keyword">let</span> currentDrop = λ<span class="hljs-literal">null</span>;
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">drop</span> = (<span class="hljs-params">e = Ωempty</span>) =&gt; {

        <span class="hljs-title function_">currentDrop</span>(e);
        currentMove = λ<span class="hljs-literal">null</span>;
        currentDrop = λ<span class="hljs-literal">null</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-16">&#x00a7;</a>
              </div>
              <p>Listeners are added to the DOM element when the first drag zone is created for that target</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">doAddListeners</span> = (<span class="hljs-params">startOn, endOn, target</span>) =&gt; {

        <span class="hljs-title function_">addListener</span>(startOn, pickup, target);
        <span class="hljs-title function_">addListener</span>(<span class="hljs-string">&#x27;move&#x27;</span>, move, target);
        <span class="hljs-title function_">addListener</span>(endOn, drop, target);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-17">&#x00a7;</a>
              </div>
              <p>Listeners are only removed from the DOM element when all the drag zones associated with that target have been killed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">doRemoveListeners</span> = (<span class="hljs-params">startOn, endOn, target</span>) =&gt; {

        <span class="hljs-title function_">removeListener</span>(startOn, pickup, target);
        <span class="hljs-title function_">removeListener</span>(<span class="hljs-string">&#x27;move&#x27;</span>, move, target);
        <span class="hljs-title function_">removeListener</span>(endOn, drop, target);
    };

    <span class="hljs-keyword">const</span> processedData = <span class="hljs-title function_">processDragZoneData</span>(items, doAddListeners, doRemoveListeners);</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-18">&#x00a7;</a>
              </div>
              <p>Return the appropriate function based on the value of the <code>exposeCurrentArtefact</code> attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (processedData.<span class="hljs-property">exposeCurrentArtefact</span>) <span class="hljs-keyword">return</span> processedData.<span class="hljs-property">getCurrent</span>;
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> processedData.<span class="hljs-property">kill</span>;
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
