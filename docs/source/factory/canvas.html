<!DOCTYPE html>

<html>
<head>
  <title>Canvas factory</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="../core/animationloop.html">
                  ./source/core/animationloop.js
                </a>
              
                
                <a class="source" href="../core/display-cycle.html">
                  ./source/core/display-cycle.js
                </a>
              
                
                <a class="source" href="../core/document-rootElements.html">
                  ./source/core/document-rootElements.js
                </a>
              
                
                <a class="source" href="../core/document.html">
                  ./source/core/document.js
                </a>
              
                
                <a class="source" href="../core/events.html">
                  ./source/core/events.js
                </a>
              
                
                <a class="source" href="../core/init.html">
                  ./source/core/init.js
                </a>
              
                
                <a class="source" href="../core/library.html">
                  ./source/core/library.js
                </a>
              
                
                <a class="source" href="../core/random-seed.html">
                  ./source/core/random-seed.js
                </a>
              
                
                <a class="source" href="../core/snippets.html">
                  ./source/core/snippets.js
                </a>
              
                
                <a class="source" href="../core/userInteraction.html">
                  ./source/core/userInteraction.js
                </a>
              
                
                <a class="source" href="../core/utilities.html">
                  ./source/core/utilities.js
                </a>
              
                
                <a class="source" href="action.html">
                  ./source/factory/action.js
                </a>
              
                
                <a class="source" href="anchor.html">
                  ./source/factory/anchor.js
                </a>
              
                
                <a class="source" href="animation.html">
                  ./source/factory/animation.js
                </a>
              
                
                <a class="source" href="bezier.html">
                  ./source/factory/bezier.js
                </a>
              
                
                <a class="source" href="block.html">
                  ./source/factory/block.js
                </a>
              
                
                <a class="source" href="canvas.html">
                  ./source/factory/canvas.js
                </a>
              
                
                <a class="source" href="cell-fragment.html">
                  ./source/factory/cell-fragment.js
                </a>
              
                
                <a class="source" href="cell.html">
                  ./source/factory/cell.js
                </a>
              
                
                <a class="source" href="cog.html">
                  ./source/factory/cog.js
                </a>
              
                
                <a class="source" href="color.html">
                  ./source/factory/color.js
                </a>
              
                
                <a class="source" href="conicGradient.html">
                  ./source/factory/conicGradient.js
                </a>
              
                
                <a class="source" href="coordinate.html">
                  ./source/factory/coordinate.js
                </a>
              
                
                <a class="source" href="crescent.html">
                  ./source/factory/crescent.js
                </a>
              
                
                <a class="source" href="dragZone.html">
                  ./source/factory/dragZone.js
                </a>
              
                
                <a class="source" href="element.html">
                  ./source/factory/element.js
                </a>
              
                
                <a class="source" href="emitter.html">
                  ./source/factory/emitter.js
                </a>
              
                
                <a class="source" href="filter.html">
                  ./source/factory/filter.js
                </a>
              
                
                <a class="source" href="filterEngine-bluenoiseData.html">
                  ./source/factory/filterEngine-bluenoiseData.js
                </a>
              
                
                <a class="source" href="filterEngine.html">
                  ./source/factory/filterEngine.js
                </a>
              
                
                <a class="source" href="fontAttributes.html">
                  ./source/factory/fontAttributes.js
                </a>
              
                
                <a class="source" href="gradient.html">
                  ./source/factory/gradient.js
                </a>
              
                
                <a class="source" href="grid.html">
                  ./source/factory/grid.js
                </a>
              
                
                <a class="source" href="group.html">
                  ./source/factory/group.js
                </a>
              
                
                <a class="source" href="imageAsset.html">
                  ./source/factory/imageAsset.js
                </a>
              
                
                <a class="source" href="keyboardZone.html">
                  ./source/factory/keyboardZone.js
                </a>
              
                
                <a class="source" href="line.html">
                  ./source/factory/line.js
                </a>
              
                
                <a class="source" href="lineSpiral.html">
                  ./source/factory/lineSpiral.js
                </a>
              
                
                <a class="source" href="loom.html">
                  ./source/factory/loom.js
                </a>
              
                
                <a class="source" href="mesh.html">
                  ./source/factory/mesh.js
                </a>
              
                
                <a class="source" href="net.html">
                  ./source/factory/net.js
                </a>
              
                
                <a class="source" href="noiseAsset.html">
                  ./source/factory/noiseAsset.js
                </a>
              
                
                <a class="source" href="observeUpdate.html">
                  ./source/factory/observeUpdate.js
                </a>
              
                
                <a class="source" href="oval.html">
                  ./source/factory/oval.js
                </a>
              
                
                <a class="source" href="palette.html">
                  ./source/factory/palette.js
                </a>
              
                
                <a class="source" href="particle.html">
                  ./source/factory/particle.js
                </a>
              
                
                <a class="source" href="particleForce.html">
                  ./source/factory/particleForce.js
                </a>
              
                
                <a class="source" href="particleHistory.html">
                  ./source/factory/particleHistory.js
                </a>
              
                
                <a class="source" href="particleSpring.html">
                  ./source/factory/particleSpring.js
                </a>
              
                
                <a class="source" href="particleWorld.html">
                  ./source/factory/particleWorld.js
                </a>
              
                
                <a class="source" href="pattern.html">
                  ./source/factory/pattern.js
                </a>
              
                
                <a class="source" href="phrase.html">
                  ./source/factory/phrase.js
                </a>
              
                
                <a class="source" href="picture.html">
                  ./source/factory/picture.js
                </a>
              
                
                <a class="source" href="polygon.html">
                  ./source/factory/polygon.js
                </a>
              
                
                <a class="source" href="polyline.html">
                  ./source/factory/polyline.js
                </a>
              
                
                <a class="source" href="quadratic.html">
                  ./source/factory/quadratic.js
                </a>
              
                
                <a class="source" href="quaternion.html">
                  ./source/factory/quaternion.js
                </a>
              
                
                <a class="source" href="radialGradient.html">
                  ./source/factory/radialGradient.js
                </a>
              
                
                <a class="source" href="rawAsset.html">
                  ./source/factory/rawAsset.js
                </a>
              
                
                <a class="source" href="rdAsset.html">
                  ./source/factory/rdAsset.js
                </a>
              
                
                <a class="source" href="rectangle.html">
                  ./source/factory/rectangle.js
                </a>
              
                
                <a class="source" href="renderAnimation.html">
                  ./source/factory/renderAnimation.js
                </a>
              
                
                <a class="source" href="shape.html">
                  ./source/factory/shape.js
                </a>
              
                
                <a class="source" href="spiral.html">
                  ./source/factory/spiral.js
                </a>
              
                
                <a class="source" href="spriteAsset.html">
                  ./source/factory/spriteAsset.js
                </a>
              
                
                <a class="source" href="stack.html">
                  ./source/factory/stack.js
                </a>
              
                
                <a class="source" href="star.html">
                  ./source/factory/star.js
                </a>
              
                
                <a class="source" href="state.html">
                  ./source/factory/state.js
                </a>
              
                
                <a class="source" href="tetragon.html">
                  ./source/factory/tetragon.js
                </a>
              
                
                <a class="source" href="ticker.html">
                  ./source/factory/ticker.js
                </a>
              
                
                <a class="source" href="tracer.html">
                  ./source/factory/tracer.js
                </a>
              
                
                <a class="source" href="tween.html">
                  ./source/factory/tween.js
                </a>
              
                
                <a class="source" href="unstackedElement.html">
                  ./source/factory/unstackedElement.js
                </a>
              
                
                <a class="source" href="vector.html">
                  ./source/factory/vector.js
                </a>
              
                
                <a class="source" href="videoAsset.html">
                  ./source/factory/videoAsset.js
                </a>
              
                
                <a class="source" href="wheel.html">
                  ./source/factory/wheel.js
                </a>
              
                
                <a class="source" href="../mixin/anchor.html">
                  ./source/mixin/anchor.js
                </a>
              
                
                <a class="source" href="../mixin/asset.html">
                  ./source/mixin/asset.js
                </a>
              
                
                <a class="source" href="../mixin/assetAdvancedFunctionality.html">
                  ./source/mixin/assetAdvancedFunctionality.js
                </a>
              
                
                <a class="source" href="../mixin/assetConsumer.html">
                  ./source/mixin/assetConsumer.js
                </a>
              
                
                <a class="source" href="../mixin/base.html">
                  ./source/mixin/base.js
                </a>
              
                
                <a class="source" href="../mixin/cascade.html">
                  ./source/mixin/cascade.js
                </a>
              
                
                <a class="source" href="../mixin/delta.html">
                  ./source/mixin/delta.js
                </a>
              
                
                <a class="source" href="../mixin/displayShape.html">
                  ./source/mixin/displayShape.js
                </a>
              
                
                <a class="source" href="../mixin/dom.html">
                  ./source/mixin/dom.js
                </a>
              
                
                <a class="source" href="../mixin/entity.html">
                  ./source/mixin/entity.js
                </a>
              
                
                <a class="source" href="../mixin/filter.html">
                  ./source/mixin/filter.js
                </a>
              
                
                <a class="source" href="../mixin/mimic.html">
                  ./source/mixin/mimic.js
                </a>
              
                
                <a class="source" href="../mixin/path.html">
                  ./source/mixin/path.js
                </a>
              
                
                <a class="source" href="../mixin/pattern.html">
                  ./source/mixin/pattern.js
                </a>
              
                
                <a class="source" href="../mixin/pivot.html">
                  ./source/mixin/pivot.js
                </a>
              
                
                <a class="source" href="../mixin/position.html">
                  ./source/mixin/position.js
                </a>
              
                
                <a class="source" href="../mixin/shapeBasic.html">
                  ./source/mixin/shapeBasic.js
                </a>
              
                
                <a class="source" href="../mixin/shapeCurve.html">
                  ./source/mixin/shapeCurve.js
                </a>
              
                
                <a class="source" href="../mixin/shapePathCalculation.html">
                  ./source/mixin/shapePathCalculation.js
                </a>
              
                
                <a class="source" href="../mixin/styles.html">
                  ./source/mixin/styles.js
                </a>
              
                
                <a class="source" href="../mixin/tween.html">
                  ./source/mixin/tween.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-1">&#x00a7;</a>
              </div>
              <h1 id="canvas-factory">Canvas factory</h1>
<p>Scrawl-canvas mediates between its system and &lt;canvas&gt; elements in the DOM using Canvas wrapper objects. The wrapper includes a handle to the visible element, but most work is done on a second &lt;canvas&gt; element - the <strong>base Cell</strong> - which is not part of the DOM, thus excluded from a browser’s Document interface (including events).</p>
<p>The Canvas factory is not used directly; the factory is not exported as part of the <a href="../scrawl.html">scrawl object</a> during Scrawl-canvas initialization. Instead, wrappers can be created for DOM-based &lt;canvas&gt; elements using the following scrawl functions:</p>
<ul>
<li><code>scrawl.getCanvas</code> - locates a &lt;canvas&gt; element in the DOM and creates a wrapper for it.</li>
<li><code>scrawl.addCanvas</code> - generates a new &lt;canvas&gt; element, creates a wrapper for it, then adds it to the DOM.</li>
</ul>
<p>During initialization Scrawl-canvas will search the DOM tree and automatically create Canvas wrappers for all the &lt;canvas&gt; elements it discovers. The first &lt;canvas&gt; element discovered becomes the <strong>current canvas</strong>; all entitys created without a specified <code>group</code> attribute will be assigned to that element’s wrapper’s base Cell’s Group object. We can change the current canvas by invoking the <code>scrawl.setCurrentCanvas</code> function.</p>
<p>A canvas wrapper can include more than one Cell object. It will always include a base Cell object; additional Cells can be treated as <em><strong>cell layers</strong></em> and/or normal artefacts contributing to the final display.</p>
<p>During their creation, Canvas wrappers will directly modify the DOM, adding &lt;div&gt; and &lt;nav&gt; elements to it. These new elements are used as <em>holds</em> where the Canvas will store data and text, mainly to expose &lt;a&gt; links and &lt;p&gt; blocks which expose scene details to assistive technologies (accessibility). These additional elements have zero dimensions and should not affect the layout or painting of the rest of the web page.</p>
<p>Canvas wrapper objects use the <strong>base</strong>, <strong>position</strong>, <strong>dom</strong> and <strong>anchor</strong> mixins. Thus Canvas wrappers are also <strong>artefact</strong> objects: if a &lt;canvas&gt; element is a direct child of a Stack wrapper’s element then it can be positioned, dimensioned and rotated like any other artefact.</p>
<p>By default, all Canvas wrappers will track mouse/touch movements across their &lt;canvas&gt; elements, supplying this data to constituent Cell objects and artefacts as-and-when-required.</p>
<p>Canvas wrappers are used by Scrawl-canvas to invoke the <strong>Display cycle cascade</strong>. As such, they include <code>clear</code>, <code>compile</code>, <code>show</code> and <code>render</code> functions to manage the Display cycle. These functions are asynchronous, returning Promises.</p>
<p>Canvas wrappers are excluded from the Scrawl-canvas packet system; they cannot be saved or cloned. Killing a Canvas wrapper will remove its &lt;canvas&gt; element from the DOM, alongside the additional elements added to the DOM during Canvas creation.</p>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-2">&#x00a7;</a>
              </div>
              <h4 id="demos">Demos:</h4>
<ul>
<li>All canvas and packets demos, and a few of the stack demos, include Canvas wrapper functionality - most of which happens behind the scenes and does not need to be directly coded. </li>
<li><a href="../../demo/canvas-009.html">Canvas-009</a> - Pattern styles; Entity web link anchors; Dynamic accessibility</li>
<li><a href="../../demo/dom-011.html">DOM-011</a> - Canvas controller <code>fit</code> attribute; Cell positioning (mouse)</li>
<li><a href="../../demo/dom-012.html">DOM-012</a> - Add and remove (kill) Scrawl-canvas canvas elements programmatically</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-3">&#x00a7;</a>
              </div>
              <h4 id="imports">Imports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { canvas <span class="hljs-keyword">as</span> libCanvas, cell, constructors, artefact, group, purge } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/library.js&#x27;</span>;
<span class="hljs-keyword">import</span> { domShow, scrawlCanvasHold } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/document.js&#x27;</span>;
<span class="hljs-keyword">import</span> { rootElements, setRootElementsSort } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../core/document-rootElements.js&quot;</span>;
<span class="hljs-keyword">import</span> { mergeOver, pushUnique, removeItem, xt, isa_dom, λ<span class="hljs-variable language_">this</span>, λ<span class="hljs-literal">null</span>, Ωempty } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/utilities.js&#x27;</span>;
<span class="hljs-keyword">import</span> { uiSubscribedElements } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/userInteraction.js&#x27;</span>;

<span class="hljs-keyword">import</span> { makeState } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./state.js&#x27;</span>;
<span class="hljs-keyword">import</span> { makeCell } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./cell.js&#x27;</span>;
<span class="hljs-keyword">import</span> { makeCoordinate } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./coordinate.js&#x27;</span>;

<span class="hljs-keyword">import</span> baseMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/base.js&#x27;</span>;
<span class="hljs-keyword">import</span> domMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/dom.js&#x27;</span>;
<span class="hljs-keyword">import</span> displayMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/displayShape.js&#x27;</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-4">&#x00a7;</a>
              </div>
              <h4 id="canvas-constructor">Canvas constructor</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> <span class="hljs-title class_">Canvas</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">items = Ωempty</span>) {

    <span class="hljs-keyword">let</span> g, el;

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">makeName</span>(items.<span class="hljs-property">name</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">register</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initializePositions</span>();

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dimensions</span>[<span class="hljs-number">0</span>] = <span class="hljs-number">300</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dimensions</span>[<span class="hljs-number">1</span>] = <span class="hljs-number">150</span>;

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pathCorners</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">css</span> = {};
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">here</span> = {};
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">perspective</span> = {

        <span class="hljs-attr">x</span>: <span class="hljs-string">&#x27;50%&#x27;</span>,
        <span class="hljs-attr">y</span>: <span class="hljs-string">&#x27;50%&#x27;</span>,
        <span class="hljs-attr">z</span>: <span class="hljs-number">0</span>
    };
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyPerspective</span> = <span class="hljs-literal">true</span>;

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initializeDomLayout</span>(items);

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">set</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">defs</span>);

    <span class="hljs-keyword">if</span> (!items.<span class="hljs-property">label</span>) items.<span class="hljs-property">label</span> = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> canvas element`</span>;

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initializeDisplayShapeActions</span>();

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initializeAccessibility</span>();

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">set</span>(items);

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cleanDimensions</span>();

    el = <span class="hljs-variable language_">this</span>.<span class="hljs-property">domElement</span>;

    <span class="hljs-keyword">if</span> (!el) <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cleanDimensions</span>();
    <span class="hljs-keyword">else</span> {

        <span class="hljs-variable language_">this</span>.<span class="hljs-property">engine</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">domElement</span>.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">&#x27;2d&#x27;</span>);

        <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = <span class="hljs-title function_">makeState</span>({
            <span class="hljs-attr">engine</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">engine</span>
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-5">&#x00a7;</a>
              </div>
              <p>set up additional cells array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">cells</span> = [];
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">cellBatchesClear</span> = [];
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">cellBatchesCompile</span> = [];
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">cellBatchesShow</span> = [];

        <span class="hljs-keyword">let</span> baseWidth = <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentDimensions</span>[<span class="hljs-number">0</span>],
            baseHeight = <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentDimensions</span>[<span class="hljs-number">1</span>];

        <span class="hljs-keyword">const</span> ds = el.<span class="hljs-property">dataset</span>;

        <span class="hljs-keyword">if</span> (ds.<span class="hljs-property">isResponsive</span>) {

            el.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">&#x27;100%&#x27;</span>;
            el.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-string">&#x27;100%&#x27;</span>;

            <span class="hljs-keyword">let</span> baseMatches = <span class="hljs-literal">true</span>;

            <span class="hljs-keyword">if</span> (ds.<span class="hljs-property">baseWidth</span> &amp;&amp; ds.<span class="hljs-property">baseHeight</span>) {

                baseMatches = <span class="hljs-literal">false</span>;
                baseWidth = <span class="hljs-built_in">parseFloat</span>(ds.<span class="hljs-property">baseWidth</span>);
                baseHeight = <span class="hljs-built_in">parseFloat</span>(ds.<span class="hljs-property">baseHeight</span>);
            }

            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">set</span>({
                <span class="hljs-attr">checkForResize</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">baseMatchesCanvasDimensions</span>: baseMatches,
                <span class="hljs-attr">ignoreCanvasCssDimensions</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">fit</span>: ds.<span class="hljs-property">fit</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">fit</span>,
            });

            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cleanDimensions</span>();
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-6">&#x00a7;</a>
              </div>
              <p>setup base cell</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">const</span> cellArgs = {
            <span class="hljs-attr">name</span>: <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>_base`</span>,
            <span class="hljs-attr">element</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">width</span>: baseWidth,
            <span class="hljs-attr">height</span>: baseHeight,
            <span class="hljs-attr">cleared</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">compiled</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">shown</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">isBase</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">host</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>,
            <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>,
            <span class="hljs-attr">order</span>: <span class="hljs-number">10</span>,
        };

        <span class="hljs-keyword">if</span> (ds.<span class="hljs-property">baseClearAlpha</span>) cellArgs.<span class="hljs-property">clearAlpha</span> = <span class="hljs-built_in">parseFloat</span>(ds.<span class="hljs-property">baseClearAlpha</span>);
        <span class="hljs-keyword">if</span> (ds.<span class="hljs-property">baseBackgroundColor</span>) cellArgs.<span class="hljs-property">backgroundColor</span> = ds.<span class="hljs-property">baseBackgroundColor</span>;

        <span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">buildCell</span>(cellArgs);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-7">&#x00a7;</a>
              </div>
              <p>even if it is a child of a stack element, it needs to be recorded as a ‘rootElement’</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-title function_">pushUnique</span>(rootElements, <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
        <span class="hljs-title function_">setRootElementsSort</span>();</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-8">&#x00a7;</a>
              </div>
              <h5 id="accessibility">Accessibility</h5>
<p>if (!el.getAttribute(‘role’)) el.setAttribute(‘role’, ‘img’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        <span class="hljs-keyword">const</span> navigation = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;nav&#x27;</span>);
        navigation.<span class="hljs-property">id</span> = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>-navigation`</span>;
        navigation.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">&#x27;0px&#x27;</span>;
        navigation.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-string">&#x27;0px&#x27;</span>;
        navigation.<span class="hljs-property">style</span>.<span class="hljs-property">maxWidth</span> = <span class="hljs-string">&#x27;0px&#x27;</span>;
        navigation.<span class="hljs-property">style</span>.<span class="hljs-property">maxHeight</span> = <span class="hljs-string">&#x27;0px&#x27;</span>;
        navigation.<span class="hljs-property">style</span>.<span class="hljs-property">border</span> = <span class="hljs-string">&#x27;0px&#x27;</span>;
        navigation.<span class="hljs-property">style</span>.<span class="hljs-property">padding</span> = <span class="hljs-string">&#x27;0px&#x27;</span>;
        navigation.<span class="hljs-property">style</span>.<span class="hljs-property">margin</span> = <span class="hljs-string">&#x27;0px&#x27;</span>;
        navigation.<span class="hljs-property">style</span>.<span class="hljs-property">overflow</span> = <span class="hljs-string">&#x27;hidden&#x27;</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">navigation</span> = navigation;
        el.<span class="hljs-title function_">appendChild</span>(navigation);

        <span class="hljs-keyword">const</span> textHold = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;div&#x27;</span>);
        textHold.<span class="hljs-property">id</span> = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>-text-hold`</span>;
        textHold.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">&#x27;0px&#x27;</span>;
        textHold.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-string">&#x27;0px&#x27;</span>;
        textHold.<span class="hljs-property">style</span>.<span class="hljs-property">maxWidth</span> = <span class="hljs-string">&#x27;0px&#x27;</span>;
        textHold.<span class="hljs-property">style</span>.<span class="hljs-property">maxHeight</span> = <span class="hljs-string">&#x27;0px&#x27;</span>;
        textHold.<span class="hljs-property">style</span>.<span class="hljs-property">border</span> = <span class="hljs-string">&#x27;0px&#x27;</span>;
        textHold.<span class="hljs-property">style</span>.<span class="hljs-property">padding</span> = <span class="hljs-string">&#x27;0px&#x27;</span>;
        textHold.<span class="hljs-property">style</span>.<span class="hljs-property">margin</span> = <span class="hljs-string">&#x27;0px&#x27;</span>;
        textHold.<span class="hljs-property">style</span>.<span class="hljs-property">overflow</span> = <span class="hljs-string">&#x27;hidden&#x27;</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">textHold</span> = textHold;
        el.<span class="hljs-title function_">appendChild</span>(textHold);

        <span class="hljs-keyword">const</span> ariaLabel = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;div&#x27;</span>);
        ariaLabel.<span class="hljs-property">id</span> = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>-ARIA-label`</span>;
        ariaLabel.<span class="hljs-property">textContent</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">label</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">ariaLabelElement</span> = ariaLabel;
        scrawlCanvasHold.<span class="hljs-title function_">appendChild</span>(ariaLabel);
        el.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&#x27;aria-labelledby&#x27;</span>, ariaLabel.<span class="hljs-property">id</span>);
        el.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&#x27;aria-live&#x27;</span>, <span class="hljs-string">&#x27;polite&#x27;</span>);

        <span class="hljs-keyword">const</span> ariaDescription = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;div&#x27;</span>);
        ariaDescription.<span class="hljs-property">id</span> = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>-ARIA-description`</span>;
        ariaDescription.<span class="hljs-property">textContent</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">description</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">ariaDescriptionElement</span> = ariaDescription;
        scrawlCanvasHold.<span class="hljs-title function_">appendChild</span>(ariaDescription);
        el.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&#x27;aria-describedby&#x27;</span>, ariaDescription.<span class="hljs-property">id</span>);
        el.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&#x27;aria-live&#x27;</span>, <span class="hljs-string">&#x27;polite&#x27;</span>);

        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cleanAria</span>();
    }

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyCells</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">apply</span>();

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyDomDimensions</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (items.<span class="hljs-property">setAsCurrentCanvas</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setAsCurrentCanvas</span>();

    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-9">&#x00a7;</a>
              </div>
              <h4 id="canvas-prototype">Canvas prototype</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> P = <span class="hljs-title class_">Canvas</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
P.<span class="hljs-property">type</span> = <span class="hljs-string">&#x27;Canvas&#x27;</span>;
P.<span class="hljs-property">lib</span> = <span class="hljs-string">&#x27;canvas&#x27;</span>;
P.<span class="hljs-property">isArtefact</span> = <span class="hljs-literal">true</span>;
P.<span class="hljs-property">isAsset</span> = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-10">&#x00a7;</a>
              </div>
              <h4 id="mixins">Mixins</h4>
<ul>
<li><a href="../mixin/base.html">base</a></li>
<li><a href="../mixin/dom.html">dom</a></li>
<li><a href="../mixin/displayShape.html">display</a></li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P = <span class="hljs-title function_">baseMix</span>(P);
P = <span class="hljs-title function_">domMix</span>(P);
P = <span class="hljs-title function_">displayMix</span>(P);</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-11">&#x00a7;</a>
              </div>
              <h4 id="canvas-attributes">Canvas attributes</h4>
<ul>
<li>Attributes defined in the <a href="../mixin/base.html">base mixin</a>: <strong>name</strong>.</li>
<li>Attributes defined in the <a href="../mixin/position.html">position mixin</a>: <strong>group, visibility, order, start, <em>startX</em>, <em>startY</em>, handle, <em>handleX</em>, <em>handleY</em>, offset, <em>offsetX</em>, <em>offsetY</em>, dimensions, <em>width</em>, <em>height</em>, pivoted, mimicked, lockTo, <em>lockXTo</em>, <em>lockYTo</em>, scale, roll, noUserInteraction, noPositionDependencies, noCanvasEngineUpdates, noFilters, noPathUpdates, purge, bringToFrontOnDrag</strong>.</li>
<li>Attributes defined in the <a href="../mixin/delta.html">delta mixin</a>: <strong>delta, noDeltaUpdates</strong>.</li>
<li>Attributes defined in the <a href="../mixin/pivot.html">pivot mixin</a>: <strong>pivot, pivotCorner, addPivotHandle, addPivotOffset, addPivotRotation</strong>.</li>
<li>Attributes defined in the <a href="../mixin/mimic.html">mimic mixin</a>: <strong>mimic, useMimicDimensions, useMimicScale, useMimicStart, useMimicHandle, useMimicOffset, useMimicRotation, useMimicFlip, addOwnDimensionsToMimic, addOwnScaleToMimic, addOwnStartToMimic, addOwnHandleToMimic, addOwnOffsetToMimic, addOwnRotationToMimic</strong>.</li>
<li>Attributes defined in the <a href="../mixin/path.html">path mixin</a>: <strong>path, pathPosition, addPathHandle, addPathOffset, addPathRotation, constantPathSpeed</strong>.</li>
<li>Attributes defined in the <a href="../mixin/anchor.html">anchor mixin</a>: <strong>anchor</strong>.</li>
<li>Attributes defined in the <a href="../mixin/dom.html">dom mixin</a>: <strong>domElement, pitch, yaw, offsetZ, css, classes, position, actionResize, trackHere, domAttributes</strong>.</li>
<li>Attributes defined in the <a href="../mixin/displayShape.html">display mixin</a>: <strong>breakToBanner, breakToLandscape, breakToPortrait, breakToSkyscraper, actionBannerShape, actionLandscapeShape, actionRectangleShape, actionPortraitShape, actionSkyscraperShape</strong>.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> defaultAttributes = {</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-12">&#x00a7;</a>
              </div>
              <p><strong>position</strong> - the CSS position value for the &lt;canvas&gt; element. This value will be set to <code>absolute</code> when the element is an artefact associated with a Stack; <code>relative</code> in other cases.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">position</span>: <span class="hljs-string">&#x27;relative&#x27;</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-13">&#x00a7;</a>
              </div>
              <p><strong>trackHere</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">trackHere</span>: <span class="hljs-string">&#x27;subscribe&#x27;</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-14">&#x00a7;</a>
              </div>
              <p><strong>fit</strong> - String indicating how the base Cell should copy its contents over to the &lt;canvas&gt; element as the final step in the Display cycle. Accepted values are: <code>fill</code>, <code>contain</code>, <code>cover</code>, <code>none</code> (but not <code>scale-down</code>).</p>
<p>The aim of this functionality is to replicate the CSS <code>object-fit</code> property - <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/object-fit">detailed here</a> - for &lt;canvas&gt; elements. We apply the fit attribute to the Canvas wrapper, not the element itself or its parent element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">fit</span>: <span class="hljs-string">&#x27;none&#x27;</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-15">&#x00a7;</a>
              </div>
              <p>DEPRECATED (because it is a really bad name) <strong>isComponent</strong> replaced by <strong>baseMatchesCanvasDimensions</strong> - set to true if, for example, canvas is being used as part of a Scrawl-canvas snippet.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">isComponent</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">baseMatchesCanvasDimensions</span>: <span class="hljs-literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-16">&#x00a7;</a>
              </div>
              <p><strong>renderOnResize</strong> - perform an additional render of the scene following a change in the canvas’s dimensions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">renderOnResize</span>: <span class="hljs-literal">true</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-17">&#x00a7;</a>
              </div>
              <p>For <em><strong>Device Pixel Ratio</strong></em>, we need to tell the canvas whether it should ignore resetting the canvas dimensions - if, for instance, we set them to ‘100%’ in CSS - and whether we have set the base to static dimensions (via <code>setBase</code>)</p>
<ul>
<li>We only need to worry about this after we invoke <code>scrawl.setIgnorePixelRatio(false)</code> in the demo code</li>
</ul>
<p><strong>ignoreCanvasCssDimensions</strong> - skip setting the &lt;canvas&gt; element’s CSS width and height when dimensions change. When the flag is set to <code>false</code> (default), we need to set the CSS values to a valuepx String which will then allow us to set the canvas drawing dimensions to take into account the display’s device pixel ratio value. Set the flag to <code>true</code> if the canvas has been initialized as responsive by setting its CSS dimensions values to a value% String. </p>
<ul>
<li>Note that Scrawl-canvas ignores any attempt to set CSS dimension (width, height) values in the <code>css</code> attribute of the <code>set({})</code> function.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">ignoreCanvasCssDimensions</span>: <span class="hljs-literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-18">&#x00a7;</a>
              </div>
              <h5 id="accessibility-attributes">Accessibility attributes</h5>
<p>&lt;canvas&gt; elements are <strong>raster images</strong> - they contain no information within their content (beyond pixel data) which can be analyzed or passed on to the browser or other device. The element <em>can</em> include <code>title</code> and various <code>item</code> attributes (alongside custom <code>data-</code> attributes) but inclusion of these depends entirely on the developer remembering to include them when coding up a web page.</p>
<p>Scrawl-canvas attempts to automate <em>some</em> (but not <em>all</em>) accessibility work through inclusion of the following Canvas attributes (specifically, Scrawl-canvas implements <a href="https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA">ARIA attributes</a>):</p>
<ul>
<li><strong>title</strong> - this attribute is applied to the &lt;canvas&gt; element’s ‘title’ attribute, and will appear as a tooltip when the user hovers over the canvas</li>
<li><strong>label</strong> and <strong>description</strong> - these attributes are applied to (offscreen) div elements which are referenced by the &lt;canvas&gt; element using <code>aria-labelledby</code> and <code>aria-describedby</code> attributes</li>
<li><strong>role</strong> - in most situations the &lt;canvas&gt; element’s ARIA role attribute should be left as <code>img</code> (the default value). However if the canvas contains a complex interactive GUI - for instance, a spreadsheet - then the role should be updated accordingly, for instance to <code>application</code></li>
</ul>
<p>If no label value is supplied to the Canvas factory (as part of the function’s argument object), then Scrawl-canvas will auto-generate a label based on the canvas’s name. All three attributes can be updated dynamically using the usual <code>set()</code> functionality.</p>
<p>Beyond the Canvas object, Scrawl-canvas also encourages Phrase entitys (which handle graphical text in the canvas display) to expose their content to the DOM, to make it accessible. Also, any artefact given an Anchor link will expose the Anchor’s &lt;a&gt; element in the DOM, which allows the canvas display to become part of the document’s navigation (for example, by keyboard tabbing).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;&#x27;</span>,
    <span class="hljs-attr">label</span>: <span class="hljs-string">&#x27;&#x27;</span>,
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;&#x27;</span>,

    <span class="hljs-attr">role</span>: <span class="hljs-string">&#x27;img&#x27;</span>,
};
P.<span class="hljs-property">defs</span> = <span class="hljs-title function_">mergeOver</span>(P.<span class="hljs-property">defs</span>, defaultAttributes);</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-19">&#x00a7;</a>
              </div>
              <h4 id="packetclone-management">Packet/Clone management</h4>
<p>This functionality is disabled for Canvas objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">stringifyFunction</span> = λ<span class="hljs-literal">null</span>;
P.<span class="hljs-property">processPacketOut</span> = λ<span class="hljs-literal">null</span>;
P.<span class="hljs-property">finalizePacketOut</span> = λ<span class="hljs-literal">null</span>;
P.<span class="hljs-property">saveAsPacket</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-keyword">return</span> <span class="hljs-string">`[<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.type}</span>, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.lib}</span>, {}]`</span>
};
P.<span class="hljs-property">clone</span> = λ<span class="hljs-variable language_">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-20">&#x00a7;</a>
              </div>
              <h4 id="kill-functionality">Kill functionality</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">factoryKill</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-keyword">let</span> name = <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>,
        host = <span class="hljs-variable language_">this</span>.<span class="hljs-property">host</span>,
        h, g;</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-21">&#x00a7;</a>
              </div>
              <p>rootElements and uiSubscribedElements arrays</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-title function_">removeItem</span>(rootElements, name);
    <span class="hljs-title function_">setRootElementsSort</span>();

    <span class="hljs-title function_">removeItem</span>(uiSubscribedElements, name);</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-22">&#x00a7;</a>
              </div>
              <p>Host and host Group</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (host &amp;&amp; host !== <span class="hljs-string">&#x27;root&#x27;</span>) {

        h = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentHost</span>) ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentHost</span> : artefact[host];

        <span class="hljs-keyword">if</span> (h) {

            h.<span class="hljs-title function_">removeGroups</span>(name);

            g = group[h.<span class="hljs-property">name</span>];
            <span class="hljs-keyword">if</span> (g) g.<span class="hljs-title function_">removeArtefacts</span>(name);
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-23">&#x00a7;</a>
              </div>
              <p>Canvas Group</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (group[name]) group[name].<span class="hljs-title function_">kill</span>();</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-24">&#x00a7;</a>
              </div>
              <p>Base Cell</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-title function_">kill</span>();</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-25">&#x00a7;</a>
              </div>
              <p>DOM removals</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">navigation</span>.<span class="hljs-title function_">remove</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">textHold</span>.<span class="hljs-title function_">remove</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ariaLabelElement</span>.<span class="hljs-title function_">remove</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ariaDescriptionElement</span>.<span class="hljs-title function_">remove</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">domElement</span>.<span class="hljs-title function_">remove</span>();
};</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-26">&#x00a7;</a>
              </div>
              <h4 id="get-set-deltaset">Get, Set, deltaSet</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> G = P.<span class="hljs-property">getters</span>,
    S = P.<span class="hljs-property">setters</span>,
    D = P.<span class="hljs-property">deltaSetters</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-27">&#x00a7;</a>
              </div>
              <p><code>fit</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">fitDefaults</span> = [<span class="hljs-string">&#x27;fill&#x27;</span>, <span class="hljs-string">&#x27;contain&#x27;</span>, <span class="hljs-string">&#x27;cover&#x27;</span>];
S.<span class="hljs-property">fit</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">fit</span> = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">fitDefaults</span>.<span class="hljs-title function_">indexOf</span>(item) &gt;= <span class="hljs-number">0</span>) ? item : <span class="hljs-string">&#x27;none&#x27;</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-28">&#x00a7;</a>
              </div>
              <p><code>title</code> - String</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.<span class="hljs-property">title</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span> = item;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyAria</span> = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-29">&#x00a7;</a>
              </div>
              <p><code>label</code> - String</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.<span class="hljs-property">label</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">label</span> = item;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyAria</span> = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-30">&#x00a7;</a>
              </div>
              <p><code>description</code> - String</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.<span class="hljs-property">description</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">description</span> = item;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyAria</span> = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-31">&#x00a7;</a>
              </div>
              <p><code>role</code> - String</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.<span class="hljs-property">role</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">role</span> = item;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyAria</span> = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-32">&#x00a7;</a>
              </div>
              <h5 id="get-and-set-base-cell-attributes">Get and set base cell attributes</h5>
<p>For convenience, Scrawl-canvas allows us to get/set a limited number of base Cell attributes via their Canvas wrapper’s <code>get</code>, <code>set</code> and <code>deltaSet</code> functions. We can set and deltaSet other base Cell attributes by invoking the <code>mycanvas.setBase</code> and <code>mycanvas.deltaSetBase</code> functions.</p>

            </div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-33">&#x00a7;</a>
              </div>
              <p><code>backgroundColor</code> - String. We can set the base Cell’s background color to any CSS color String value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>G.<span class="hljs-property">backgroundColor</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-property">backgroundColor</span>;
};
S.<span class="hljs-property">backgroundColor</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>) {

        <span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-title function_">set</span>({
            <span class="hljs-attr">backgroundColor</span>: item
        });
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-34">&#x00a7;</a>
              </div>
              <p><code>alpha</code> - float Number between 0.0 and 1.0. When the base Cell stamps itself onto the Canvas wrapper’s &lt;canvas&gt; element, it can set the element’s engine to a <code>globalAlpha</code> value stored in the Cell’s alpha attribute.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>G.<span class="hljs-property">alpha</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-property">alpha</span>;
};
S.<span class="hljs-property">alpha</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>) {

        <span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-title function_">set</span>({
            <span class="hljs-attr">alpha</span>: item
        });
    }
};
D.<span class="hljs-property">alpha</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>) {

    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>) {

        <span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-title function_">deltaSet</span>({
            <span class="hljs-attr">alpha</span>: item
        });
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-35">&#x00a7;</a>
              </div>
              <p><code>composite</code> - String. When the base Cell stamps itself onto the Canvas wrapper’s &lt;canvas&gt; element, it can set the element’s engine to a <code>globalCompositeOperation</code> value stored in the Cell’s composite attribute.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>G.<span class="hljs-property">composite</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-property">composite</span>;
};
S.<span class="hljs-property">composite</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-title function_">set</span>({
            <span class="hljs-attr">composite</span>: item
        });
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-36">&#x00a7;</a>
              </div>
              <p><code>checkForEntityHover</code>, <code>onEntityHover</code>, <code>onEntityNoHover</code> - these are group-specific attributes which we can set on the base Cell’s named group via the Canvas wrapper</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.<span class="hljs-property">checkForEntityHover</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-title function_">set</span>({
        <span class="hljs-attr">checkForEntityHover</span>: item,
    });
};
S.<span class="hljs-property">onEntityHover</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-title function_">set</span>({
        <span class="hljs-attr">onEntityHover</span>: item,
    });
};
S.<span class="hljs-property">onEntityNoHover</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-title function_">set</span>({
        <span class="hljs-attr">onEntityNoHover</span>: item,
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-37">&#x00a7;</a>
              </div>
              <p><code>baseGroup</code> - get the Canvas wrapper’s base Cell’s named group </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>G.<span class="hljs-property">baseGroup</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-keyword">return</span> group[<span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-property">name</span>];
};</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-38">&#x00a7;</a>
              </div>
              <p><code>baseName</code> - get the Canvas wrapper’s base Cell’s name </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>G.<span class="hljs-property">baseName</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-property">name</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-39">&#x00a7;</a>
              </div>
              <h4 id="prototype-functions">Prototype functions</h4>

            </div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-40">&#x00a7;</a>
              </div>
              <p><code>setAsCurrentCanvas</code> - invoke function (without arguments) to make this Canvas wrapper the <strong>current canvas</strong> for future entity generation operations. This is additional to the <code>scrawl.setCurrentCanvas</code> function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">setAsCurrentCanvas</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>) <span class="hljs-title function_">setCurrentCanvas</span>(<span class="hljs-variable language_">this</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-41">&#x00a7;</a>
              </div>
              <p><code>setBase</code> - pass the argument object through to the base Cell’s <code>set</code> function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">setBase</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) {

    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>) {

        <span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-title function_">set</span>(items);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setBaseHelper</span>();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-42">&#x00a7;</a>
              </div>
              <p><code>deltaSetBase</code> - pass the argument object through to the base Cell’s <code>deltaSet</code> function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">deltaSetBase</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) {

    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>) {

        <span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-title function_">deltaSet</span>(items);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setBaseHelper</span>();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-43">&#x00a7;</a>
              </div>
              <p>Internal function - passes the Canvas wrapper’s current <strong>here</strong> object and <strong>fit</strong> attribute to the base Cell for further processing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">updateBaseHere</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-title function_">updateBaseHere</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">here</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">fit</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-44">&#x00a7;</a>
              </div>
              <p>Internal helper function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">setBaseHelper</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-keyword">let</span> items = {};

    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-property">dirtyScale</span>) items.<span class="hljs-property">dirtyScale</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-property">dirtyDimensions</span>) items.<span class="hljs-property">dirtyDimensions</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-property">dirtyLock</span>) items.<span class="hljs-property">dirtyLock</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-property">dirtyStart</span>) items.<span class="hljs-property">dirtyStart</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-property">dirtyOffset</span>) items.<span class="hljs-property">dirtyOffset</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-property">dirtyHandle</span>) items.<span class="hljs-property">dirtyHandle</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-property">dirtyRotation</span>) items.<span class="hljs-property">dirtyRotation</span> = <span class="hljs-literal">true</span>;

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cleanCells</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-title function_">prepareStamp</span>();

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateCells</span>(items);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-45">&#x00a7;</a>
              </div>
              <p><code>updateCells</code> - internal function. Iterate through all Cells registered in the wrapper’s <strong>cells</strong> Array and set a range of dirty flags on them, for future processing by each Cell.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">updateCells</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">items = Ωempty</span>) {

    <span class="hljs-keyword">const</span> c = <span class="hljs-variable language_">this</span>.<span class="hljs-property">cells</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>, iz = c.<span class="hljs-property">length</span>, mycell; i &lt; iz; i++) {

        mycell = cell[c[i]];

        <span class="hljs-keyword">if</span> (mycell) {

            <span class="hljs-keyword">if</span> (items.<span class="hljs-property">dirtyScale</span>) mycell.<span class="hljs-property">dirtyScale</span> = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.<span class="hljs-property">dirtyDimensions</span>) mycell.<span class="hljs-property">dirtyDimensions</span> = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.<span class="hljs-property">dirtyLock</span>) mycell.<span class="hljs-property">dirtyLock</span> = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.<span class="hljs-property">dirtyStart</span>) mycell.<span class="hljs-property">dirtyStart</span> = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.<span class="hljs-property">dirtyOffset</span>) mycell.<span class="hljs-property">dirtyOffset</span> = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.<span class="hljs-property">dirtyHandle</span>) mycell.<span class="hljs-property">dirtyHandle</span> = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.<span class="hljs-property">dirtyRotation</span>) mycell.<span class="hljs-property">dirtyRotation</span> = <span class="hljs-literal">true</span>;
        }
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-46">&#x00a7;</a>
              </div>
              <p><code>buildCell</code> - create a Cell wrapper (wrapping a &lt;canvas&gt; element not attached to the DOM) and add it to this Canvas wrapper’s complement of Cells</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">buildCell</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">items = Ωempty</span>) {

    <span class="hljs-keyword">let</span> host = items.<span class="hljs-property">host</span> || <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">if</span> (!host) items.<span class="hljs-property">host</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-property">name</span>;

    <span class="hljs-keyword">let</span> mycell = <span class="hljs-title function_">makeCell</span>(items);
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addCell</span>(mycell);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cleanCells</span>();
    <span class="hljs-keyword">return</span> mycell;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-47">&#x00a7;</a>
              </div>
              <p><code>cleanDimensionsAdditionalActions</code> - overwrites mixin/position function. Promulgates canvas dimension changes through to all Cells in the wrapper’s cells Array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">cleanDimensionsAdditionalActions</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">cells</span>) {

        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateCells</span>({
            <span class="hljs-attr">dirtyDimensions</span>: <span class="hljs-literal">true</span>,
        });
    }

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyDomDimensions</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyDisplayShape</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyDisplayArea</span> = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-48">&#x00a7;</a>
              </div>
              <p><code>addCell</code> - add a Cell object to the wrapper’s cells Array; argument can be the Cell’s name-String, or the Cell object itself</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">addCell</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    item = (item.<span class="hljs-property">substring</span>) ? item : item.<span class="hljs-property">name</span> || <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">if</span> (item) {

        <span class="hljs-keyword">const</span> c = cell[item];

        <span class="hljs-keyword">if</span> (c) {

            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>) {

                c.<span class="hljs-property">host</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-property">name</span>;
                c.<span class="hljs-property">currentHost</span> = <span class="hljs-literal">null</span>;
            }
            c.<span class="hljs-title function_">prepareStamp</span>();

            <span class="hljs-title function_">pushUnique</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">cells</span>, item);
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyCells</span> = <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-49">&#x00a7;</a>
              </div>
              <p>this.domShowRequired = true;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-50">&#x00a7;</a>
              </div>
              <p><code>removeCell</code> - remove a Cell object from the wrapper’s cells Array; argument can be the Cell’s name-String, or the Cell object itself</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">removeCell</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    item = (item.<span class="hljs-property">substring</span>) ? item : item.<span class="hljs-property">name</span> || <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">if</span> (item) {

        <span class="hljs-title function_">removeItem</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">cells</span>, item);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyCells</span> = <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-51">&#x00a7;</a>
              </div>
              <p>this.domShowRequired = true;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-52">&#x00a7;</a>
              </div>
              <p><code>killCell</code> - invoke a Cell object’s <strong>kill</strong> function; argument can be the Cell’s name-String, or the Cell object itself</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">killCell</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    <span class="hljs-keyword">let</span> mycell = (item.<span class="hljs-property">substring</span>) ? cell[item] : item;

    <span class="hljs-keyword">if</span> (mycell) mycell.<span class="hljs-title function_">kill</span>();

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyCells</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-53">&#x00a7;</a>
              </div>
              <h5 id="display-cycle-functions">Display cycle functions</h5>

            </div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-54">&#x00a7;</a>
              </div>
              <p><code>clear</code> - For Cell objects in the wrapper’s <strong>cells</strong> (and associated) Arrays:</p>
<ul>
<li>If the Cell object’s <code>cleared</code> flag is true, invoke the Cell’s <code>clear</code> function </li>
<li>Note that the Display canvas itself does not clearuntil the show stage, to minimize flickering</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">clear</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyCells</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cleanCells</span>();</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-55">&#x00a7;</a>
              </div>
              <p>Handle base dimensions - other cells may use it for their relative dimensions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-property">dirtyDimensions</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-title function_">cleanDimensions</span>();

    <span class="hljs-keyword">const</span> c = <span class="hljs-variable language_">this</span>.<span class="hljs-property">cellBatchesClear</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>, iz = c.<span class="hljs-property">length</span>; i &lt; iz; i++) {

        c[i].<span class="hljs-title function_">clear</span>();
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-56">&#x00a7;</a>
              </div>
              <p><code>compile</code> - For Cell objects in the wrapper’s <strong>cells</strong> (and associated) Arrays:</p>
<ul>
<li>sort Cell objects depending on their <code>compileOrder</code> attribute - Cells with lower order values will be processed first</li>
<li>if the Cell object’s <code>compiled</code> flag is true, invoke the Cell’s <code>compile</code> function</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">compile</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-57">&#x00a7;</a>
              </div>
              <p>Handle constituent cells</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyCells</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cleanCells</span>();</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-58">&#x00a7;</a>
              </div>
              <p>Handle base dimensions - other cells may use it for their relative dimensions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-property">dirtyDimensions</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-title function_">cleanDimensions</span>();

    <span class="hljs-keyword">const</span> c = <span class="hljs-variable language_">this</span>.<span class="hljs-property">cellBatchesCompile</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>, iz = c.<span class="hljs-property">length</span>; i &lt; iz; i++) {

        c[i].<span class="hljs-title function_">compile</span>();
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-59">&#x00a7;</a>
              </div>
              <p>Handle display canvas</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">prepareStamp</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">stamp</span>();
};</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-60">&#x00a7;</a>
              </div>
              <p><code>show</code> - For Cell objects in the wrapper’s <strong>cells</strong> (and associated) Arrays:</p>
<ul>
<li>sort Cell objects depending on their <code>showOrder</code> attribute - Cells with lower order values will be processed first</li>
<li>if the Cell object’s <code>shown</code> flag is true, invoke the Cell’s <code>show</code> function</li>
</ul>
<p>And then:</p>
<ul>
<li>copy the base Cells display over to the Canvas wrapper’s &lt;canvas&gt; element</li>
<li>update ARIA and other associated metadata</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">show</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-61">&#x00a7;</a>
              </div>
              <p>Handle constituent cells</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyCells</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cleanCells</span>();</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-62">&#x00a7;</a>
              </div>
              <p>Handle base dimensions - other cells may use it for their relative dimensions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-property">dirtyDimensions</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-title function_">cleanDimensions</span>();

    <span class="hljs-keyword">const</span> c = <span class="hljs-variable language_">this</span>.<span class="hljs-property">cellBatchesShow</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>, iz = c.<span class="hljs-property">length</span>; i &lt; iz; i++) {

        c[i].<span class="hljs-title function_">show</span>();
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-63">&#x00a7;</a>
              </div>
              <p>Get the base cell to stamp itself onto the display canvas</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">base</span>.<span class="hljs-title function_">show</span>();</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-64">&#x00a7;</a>
              </div>
              <p>Handle DOM-related positioning and display requirements, including ARIA updates</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-title function_">domShow</span>();
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyAria</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cleanAria</span>();
};</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-65">&#x00a7;</a>
              </div>
              <p><code>render</code> - orchestrate a single Display cycle - clear, then compile, then show.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">render</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">clear</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">compile</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">show</span>();
};</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-66">&#x00a7;</a>
              </div>
              <p><code>cleanCells</code> - internal function triggered each time there is an update to the <strong>cells</strong> Array attribute, or a constituent Cell sets the Canvas wrapper’s <code>dirtyCell</code> flag.</p>
<ul>
<li>Cell objects include attribute flags - <code>cleared</code>, <code>compiled</code>, <code>shown</code> - which tell their Canvas wrapper whether they should be included in each part of the Display cycle</li>
<li>For the compile and show steps, Cell objects also include attributes - <code>compileOrder</code>, <code>showOrder</code> - indicating the order in which they should be processed (compared to other Cell objects). </li>
<li>The sorting algorithm for all three operations is a bucket sort. </li>
<li>The results of these operations are deposited in three internal Arrays which are used as part of the Canvas wrapper’s clear/compile/show functionality.</li>
</ul>
<p>We do things this way because there may be situations where a Cell needs to calculate and compile before another cell, but should be shown (applied to) the base Cell after the other Cells (so it appears on top of them).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">cleanCells</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyCells</span> = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">let</span> tempClear = [],
        tempCompile = [],
        tempShow = [],
        cells = <span class="hljs-variable language_">this</span>.<span class="hljs-property">cells</span>,
        order;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>, iz = cells.<span class="hljs-property">length</span>, mycell; i &lt; iz; i++) {

        mycell = cell[cells[i]];

        <span class="hljs-keyword">if</span> (mycell) {

            <span class="hljs-keyword">if</span> (mycell.<span class="hljs-property">cleared</span>) tempClear.<span class="hljs-title function_">push</span>(mycell);

            <span class="hljs-keyword">if</span> (mycell.<span class="hljs-property">compiled</span>) {

                order = mycell.<span class="hljs-property">compileOrder</span>;

                <span class="hljs-keyword">if</span> (!tempCompile[order]) tempCompile[order] = [];

                tempCompile[order].<span class="hljs-title function_">push</span>(mycell);
            }

            <span class="hljs-keyword">if</span> (mycell.<span class="hljs-property">shown</span>) {

                order = mycell.<span class="hljs-property">showOrder</span>;

                <span class="hljs-keyword">if</span> (!tempShow[order]) tempShow[order] = [];
                tempShow[order].<span class="hljs-title function_">push</span>(mycell);
            }
        }
    };

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cellBatchesClear</span> = [].<span class="hljs-title function_">concat</span>(tempClear);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cellBatchesCompile</span> = tempCompile.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, v</span>) =&gt;</span> a.<span class="hljs-title function_">concat</span>(v), []);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cellBatchesShow</span> = tempShow.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, v</span>) =&gt;</span> a.<span class="hljs-title function_">concat</span>(v), []);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-67">&#x00a7;</a>
              </div>
              <h5 id="handling-dom-events">Handling DOM events</h5>
<p><code>cascadeEventAction</code> - The Canvas wrapper’s &lt;canvas&gt; element is part of the DOM, thus it is able to participate in all normal DOM events. We use the cascadeEventAction function to tell the wrapper which of the events it receives should be cascaded down to its constituent Cell objects and, in turn, their Groups’ artefacts. </p>
<p>This allows us to ‘regionalize’ various parts of the &lt;canvas&gt; element so that they respond in a similar way to an HTML <strong>image map</strong> (defined using &lt;map&gt; and &lt;area&gt; elements) </p>
<ul>
<li>Cascaded events are limited to mouse and touch events, which Scrawl-canvas bundles together into 5 types of event: <code>down</code>, <code>up</code> (which also captures click events), <code>enter</code>, <code>leave</code>, <code>move</code>.</li>
<li>Returns an Array of name Strings for the entitys at the current mouse cursor coordinates; the Array is also accessible from the Canvas wrapper’s <code>currentActiveEntityNames</code> attribute.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">cascadeEventAction</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">action, e = {}</span>) {

    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentActiveEntityNames</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentActiveEntityNames</span> = [];

    <span class="hljs-keyword">let</span> currentActiveEntityNames = <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentActiveEntityNames</span>,
        testActiveEntityObjects = [],
        testActiveEntityNames = [],
        newActiveEntityObjects = [],
        newActiveEntityNames = [],
        knownActiveEntityObjects = [],
        knownActiveEntityNames = [],
        i, iz, myCell, item, name, myArt;</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-68">&#x00a7;</a>
              </div>
              <ol>
<li>Find all entitys currently colliding with the mouse/touch coordinate over the canvas</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> c = <span class="hljs-variable language_">this</span>.<span class="hljs-property">cells</span>;
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = c.<span class="hljs-property">length</span>; i &lt; iz; i++) {

        myCell = cell[c[i]];

        <span class="hljs-keyword">if</span> (myCell &amp;&amp; (myCell.<span class="hljs-property">shown</span> || myCell.<span class="hljs-property">isBase</span> || myCell.<span class="hljs-property">includeInCascadeEventActions</span>)) testActiveEntityObjects.<span class="hljs-title function_">push</span>(myCell.<span class="hljs-title function_">getEntityHits</span>());
    };

    testActiveEntityObjects = testActiveEntityObjects.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, v</span>) =&gt;</span> a.<span class="hljs-title function_">concat</span>(v), []);</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-69">&#x00a7;</a>
              </div>
              <ol start="2">
<li>Process the returned test results</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = testActiveEntityObjects.<span class="hljs-property">length</span>; i &lt; iz; i++) {

        item = testActiveEntityObjects[i];
        name = item.<span class="hljs-property">name</span>;

        <span class="hljs-keyword">if</span> (testActiveEntityNames.<span class="hljs-title function_">indexOf</span>(name) &lt; <span class="hljs-number">0</span>) {

            testActiveEntityNames.<span class="hljs-title function_">push</span>(name);

            <span class="hljs-keyword">if</span> (currentActiveEntityNames.<span class="hljs-title function_">indexOf</span>(name) &lt; <span class="hljs-number">0</span>) {

                newActiveEntityObjects.<span class="hljs-title function_">push</span>(item);
                newActiveEntityNames.<span class="hljs-title function_">push</span>(name);
            }
            <span class="hljs-keyword">else</span> {

                knownActiveEntityObjects.<span class="hljs-title function_">push</span>(item);
                knownActiveEntityNames.<span class="hljs-title function_">push</span>(name);
            }
        }
    }

    <span class="hljs-keyword">let</span> currentActiveEntityObjects = newActiveEntityObjects.<span class="hljs-title function_">concat</span>(knownActiveEntityObjects);</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-70">&#x00a7;</a>
              </div>
              <ol start="3">
<li>Trigger the required action on each affected entity</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> doLeave = <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {

        <span class="hljs-keyword">if</span> (currentActiveEntityNames.<span class="hljs-property">length</span>) {

            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = newActiveEntityNames.<span class="hljs-property">length</span>; i &lt; iz; i++) {

                <span class="hljs-title function_">removeItem</span>(currentActiveEntityNames, newActiveEntityNames[i]);
            }
            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = knownActiveEntityNames.<span class="hljs-property">length</span>; i &lt; iz; i++) {

                <span class="hljs-title function_">removeItem</span>(currentActiveEntityNames, knownActiveEntityNames[i]);
            }
            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = currentActiveEntityNames.<span class="hljs-property">length</span>, myArt; i &lt; iz; i++) {

                myArt = artefact[currentActiveEntityNames[i]];

                <span class="hljs-keyword">if</span> (myArt) myArt.<span class="hljs-title function_">onLeave</span>(e);
            }
        }
    };

    <span class="hljs-keyword">const</span> currentActiveLen = currentActiveEntityObjects.<span class="hljs-property">length</span>,
        newActiveLen = newActiveEntityObjects.<span class="hljs-property">length</span>;

    <span class="hljs-keyword">switch</span> (action) {

        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;down&#x27;</span> :
            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; currentActiveLen; i++) {
                currentActiveEntityObjects[i].<span class="hljs-title function_">onDown</span>(e);
            }
            <span class="hljs-keyword">break</span>;

        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;up&#x27;</span> :
            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; currentActiveLen; i++) {
                currentActiveEntityObjects[i].<span class="hljs-title function_">onUp</span>(e);
            }
            <span class="hljs-keyword">break</span>;

        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;enter&#x27;</span> :
            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; newActiveLen; i++) {
                newActiveEntityObjects[i].<span class="hljs-title function_">onEnter</span>(e);
            }
            <span class="hljs-keyword">break</span>;

        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;leave&#x27;</span> :
            <span class="hljs-title function_">doLeave</span>(e);
            <span class="hljs-keyword">break</span>;

        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;move&#x27;</span> :
            <span class="hljs-title function_">doLeave</span>(e);
            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; newActiveLen; i++) {
                newActiveEntityObjects[i].<span class="hljs-title function_">onEnter</span>(e);
            }
            <span class="hljs-keyword">break</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-71">&#x00a7;</a>
              </div>
              <ol start="4">
<li>Cleanup and return</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentActiveEntityNames</span> = newActiveEntityNames.<span class="hljs-title function_">concat</span>(knownActiveEntityNames);

    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentActiveEntityNames</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-72">&#x00a7;</a>
              </div>
              <p><code>getEntityHits</code>, <code>checkHover</code> - returns the names of all entitys associated with this canvas that are currently colliding with the mouse cursor; should also trigger any hover actions active on Group objects associated with the Canvas wrapper </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">getEntityHits</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cascadeEventAction</span>();
};
P.<span class="hljs-property">checkHover</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cascadeEventAction</span>();
};</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-73">&#x00a7;</a>
              </div>
              <p><code>cleanAria</code> - internal function; transfers updated <strong>title</strong>, <strong>label</strong>, <strong>description</strong> and <strong>role</strong> attribute values into the relevant DOM elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">cleanAria</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyAria</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">domElement</span>.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&#x27;title&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">domElement</span>.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&#x27;role&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">role</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ariaLabelElement</span>.<span class="hljs-property">textContent</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">label</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ariaDescriptionElement</span>.<span class="hljs-property">textContent</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">description</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-74">&#x00a7;</a>
              </div>
              <h4 id="factory">Factory</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> makeCanvas = <span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) {

    <span class="hljs-keyword">if</span> (!items) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Canvas</span>(items);
};

constructors.<span class="hljs-property">Canvas</span> = <span class="hljs-title class_">Canvas</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-75">&#x00a7;</a>
              </div>
              <h4 id="canvas-discovery">Canvas discovery</h4>
<p><code>Exported function</code> (to modules). Parse the DOM, looking for &lt;canvas&gt; elements; then create <strong>Canvas</strong> artefact and <strong>Cell</strong> asset wrappers for each canvas found. Canvas elements do not need to be part of a stack and can appear anywhere in the HTML body.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getCanvases = <span class="hljs-keyword">function</span> (<span class="hljs-params">query = <span class="hljs-string">&#x27;[data-scrawl-canvas]&#x27;</span></span>) {

    <span class="hljs-keyword">let</span> item;

    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(query).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">el, index</span>) =&gt;</span> {

        item = <span class="hljs-title function_">addInitialCanvasElement</span>(el);

        <span class="hljs-keyword">if</span> (!index) <span class="hljs-title function_">setCurrentCanvas</span>(item);
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-76">&#x00a7;</a>
              </div>
              <p>Create a <strong>canvas</strong> artefact wrapper for a given canvas element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> addInitialCanvasElement = <span class="hljs-keyword">function</span> (<span class="hljs-params">el</span>) {

    <span class="hljs-keyword">let</span> mygroup = el.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">&#x27;data-scrawl-group&#x27;</span>),
        myname = el.<span class="hljs-property">id</span> || el.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">&#x27;name&#x27;</span>),
        position = <span class="hljs-string">&#x27;absolute&#x27;</span>;

    <span class="hljs-keyword">if</span> (!mygroup) {

        el.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&#x27;data-scrawl-group&#x27;</span>, <span class="hljs-string">&#x27;root&#x27;</span>);
        mygroup = <span class="hljs-string">&#x27;root&#x27;</span>;
        position = el.<span class="hljs-property">style</span>.<span class="hljs-property">position</span>;
    }

    <span class="hljs-keyword">if</span> (!myname) {

        myname = <span class="hljs-title function_">generateUniqueString</span>();
        el.<span class="hljs-property">id</span> = myname;
    }

    <span class="hljs-keyword">return</span> <span class="hljs-title function_">makeCanvas</span>({
        <span class="hljs-attr">name</span>: myname,
        <span class="hljs-attr">domElement</span>: el,
        <span class="hljs-attr">group</span>: mygroup,
        <span class="hljs-attr">host</span>: mygroup,
        <span class="hljs-attr">position</span>: position,
        <span class="hljs-attr">setInitialDimensions</span>: <span class="hljs-literal">true</span>
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-77">&#x00a7;</a>
              </div>
              <p><code>Exported function</code> (to modules and scrawl object). Parse the DOM, looking for a specific &lt;canvas&gt; element id; then create a <strong>Canvas</strong> artefact and <strong>Cell</strong> asset wrapper for it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getCanvas = <span class="hljs-keyword">function</span> (<span class="hljs-params">search</span>) {

    <span class="hljs-keyword">const</span> el = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">`#<span class="hljs-subst">${search}</span>`</span>);

    <span class="hljs-keyword">const</span> c = libCanvas[search];

    <span class="hljs-keyword">if</span> (c) {

        <span class="hljs-keyword">if</span> (el.<span class="hljs-property">dataset</span>.<span class="hljs-property">scrawlGroup</span> != <span class="hljs-literal">null</span>) {

            <span class="hljs-title function_">setCurrentCanvas</span>(c);
            <span class="hljs-keyword">return</span> c;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-title function_">purge</span>(search);
    }

    <span class="hljs-keyword">if</span> (el) {
        <span class="hljs-keyword">const</span> newCanvas = <span class="hljs-title function_">addInitialCanvasElement</span>(el);
        <span class="hljs-title function_">setCurrentCanvas</span>(newCanvas);
        <span class="hljs-keyword">return</span> newCanvas;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-78">&#x00a7;</a>
              </div>
              <p>Scrawl-canvas expects one canvas element (if any canvases are present) to act as the ‘current’ canvas on which other factory functions - such as adding new entitys - can act. The current canvas can be changed at any time using <strong>scrawl.setCurrentCanvas</strong></p>

            </div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-79">&#x00a7;</a>
              </div>
              <p><code>Exported variables</code> (to modules). </p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">let</span> currentCanvas = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">let</span> currentGroup = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-80">&#x00a7;</a>
              </div>
              <p><code>Exported function</code> (to modules and scrawl object). </p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> setCurrentCanvas = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    <span class="hljs-keyword">let</span> changeFlag = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">if</span> (item) {

        <span class="hljs-keyword">if</span> (item.<span class="hljs-property">substring</span>) {

            <span class="hljs-keyword">let</span> mycanvas = libCanvas[item];

            <span class="hljs-keyword">if</span> (mycanvas) {
                currentCanvas = mycanvas;
                changeFlag = <span class="hljs-literal">true</span>;    
            }
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;Canvas&#x27;</span>) {

            currentCanvas = item;    
            changeFlag = <span class="hljs-literal">true</span>;    
        } 
    }

    <span class="hljs-keyword">if</span> (changeFlag &amp;&amp; currentCanvas.<span class="hljs-property">base</span>) {

        <span class="hljs-keyword">let</span> mygroup = group[currentCanvas.<span class="hljs-property">base</span>.<span class="hljs-property">name</span>];

        <span class="hljs-keyword">if</span> (mygroup) currentGroup = mygroup;
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-81">&#x00a7;</a>
              </div>
              <p><code>Exported function</code> (to modules and scrawl object). Use <strong>addCanvas</strong> to add a Scrawl-canvas canvas element to a web page. The items argument should include </p>
<ul>
<li><strong>host</strong> - the host element, either as the DOM element itself, or some sort of CSS search string, or a Scrawl-canvas Stack entity. If no host is supplied, Scrawl-canvas will add the new canvas element to the DOM document body; in all cases, the new canvas element is appended at the end of the host element (or DOM document)</li>
<li><strong>name</strong> - String identifier for the element; will generate a random name for the canvas if no name is supplied.</li>
<li>any other regular Scrawl-canvas Canvas artefact attribute</li>
</ul>
<p>By default, Scrawl-canvas will setup the new Canvas as the ‘current canvas’, and will add mouse/pointer tracking functionality to it. If no dimensions are supplied then the Canvas will default to 300px wide and 150px high.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> addCanvas = <span class="hljs-keyword">function</span> (<span class="hljs-params">items = Ωempty</span>) {

    <span class="hljs-keyword">let</span> el = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;canvas&#x27;</span>),
        myname = (items.<span class="hljs-property">name</span>) ? items.<span class="hljs-property">name</span> : <span class="hljs-title function_">generateUniqueString</span>(),
        host = items.<span class="hljs-property">host</span>,
        mygroup = <span class="hljs-string">&#x27;root&#x27;</span>,
        width = items.<span class="hljs-property">width</span> || <span class="hljs-number">300</span>,
        height = items.<span class="hljs-property">height</span> || <span class="hljs-number">150</span>,
        position = <span class="hljs-string">&#x27;relative&#x27;</span>;

    <span class="hljs-keyword">if</span> (host.<span class="hljs-property">substring</span>) {

        <span class="hljs-keyword">let</span> temphost = artefact[host];

        <span class="hljs-keyword">if</span> (!temphost &amp;&amp; host) {

            host = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(host);

            <span class="hljs-keyword">if</span> (host) mygroup = host.<span class="hljs-property">id</span>;
        }
        <span class="hljs-keyword">else</span> host = temphost;
    }

    <span class="hljs-keyword">if</span> (host) {

        <span class="hljs-keyword">if</span> (host.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;Stack&#x27;</span>) {

            mygroup = host.<span class="hljs-property">name</span>;
            position = <span class="hljs-string">&#x27;absolute&#x27;</span>;
            host = host.<span class="hljs-property">domElement</span>;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isa_dom</span>(host)) host = <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>;
    }
    <span class="hljs-keyword">else</span> host = <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>;

    el.<span class="hljs-property">id</span> = myname;
    el.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&#x27;data-scrawl-group&#x27;</span>, mygroup);
    el.<span class="hljs-property">width</span> = width;
    el.<span class="hljs-property">height</span> = height;
    el.<span class="hljs-property">style</span>.<span class="hljs-property">position</span> = position;

    host.<span class="hljs-title function_">appendChild</span>(el);

    <span class="hljs-keyword">let</span> mycanvas = <span class="hljs-title function_">makeCanvas</span>({
        <span class="hljs-attr">name</span>: myname,
        <span class="hljs-attr">domElement</span>: el,
        <span class="hljs-attr">group</span>: mygroup,
        <span class="hljs-attr">host</span>: mygroup,
        <span class="hljs-attr">position</span>: position,
        <span class="hljs-attr">setInitialDimensions</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">setAsCurrentCanvas</span>: (<span class="hljs-title function_">xt</span>(items.<span class="hljs-property">setAsCurrentCanvas</span>)) ? items.<span class="hljs-property">setAsCurrentCanvas</span> : <span class="hljs-literal">true</span>,
        <span class="hljs-attr">trackHere</span>: (<span class="hljs-title function_">xt</span>(items.<span class="hljs-property">trackHere</span>)) ? items.<span class="hljs-property">trackHere</span> : <span class="hljs-string">&#x27;subscribe&#x27;</span>,
    });

    <span class="hljs-keyword">delete</span> items.<span class="hljs-property">group</span>;
    <span class="hljs-keyword">delete</span> items.<span class="hljs-property">host</span>;
    <span class="hljs-keyword">delete</span> items.<span class="hljs-property">name</span>;
    <span class="hljs-keyword">delete</span> items.<span class="hljs-property">element</span>;
    <span class="hljs-keyword">delete</span> items.<span class="hljs-property">position</span>;
    <span class="hljs-keyword">delete</span> items.<span class="hljs-property">setInitialDimensions</span>;
    <span class="hljs-keyword">delete</span> items.<span class="hljs-property">setAsCurrentCanvas</span>;
    <span class="hljs-keyword">delete</span> items.<span class="hljs-property">trackHere</span>;

    mycanvas.<span class="hljs-title function_">set</span>(items);

    <span class="hljs-keyword">return</span> mycanvas;
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
