<!DOCTYPE html>

<html>
<head>
  <title>Group factory</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="../core/animation-loop.html">
                  ./source/core/animation-loop.js
                </a>
              
                
                <a class="source" href="../core/display-cycle.html">
                  ./source/core/display-cycle.js
                </a>
              
                
                <a class="source" href="../core/document-root-elements.html">
                  ./source/core/document-root-elements.js
                </a>
              
                
                <a class="source" href="../core/document.html">
                  ./source/core/document.js
                </a>
              
                
                <a class="source" href="../core/events.html">
                  ./source/core/events.js
                </a>
              
                
                <a class="source" href="../core/init.html">
                  ./source/core/init.js
                </a>
              
                
                <a class="source" href="../core/library.html">
                  ./source/core/library.js
                </a>
              
                
                <a class="source" href="../core/random-seed.html">
                  ./source/core/random-seed.js
                </a>
              
                
                <a class="source" href="../core/shared-vars.html">
                  ./source/core/shared-vars.js
                </a>
              
                
                <a class="source" href="../core/snippets.html">
                  ./source/core/snippets.js
                </a>
              
                
                <a class="source" href="../core/system-flags.html">
                  ./source/core/system-flags.js
                </a>
              
                
                <a class="source" href="../core/user-interaction.html">
                  ./source/core/user-interaction.js
                </a>
              
                
                <a class="source" href="../core/utilities.html">
                  ./source/core/utilities.js
                </a>
              
                
                <a class="source" href="action.html">
                  ./source/factory/action.js
                </a>
              
                
                <a class="source" href="anchor.html">
                  ./source/factory/anchor.js
                </a>
              
                
                <a class="source" href="animation.html">
                  ./source/factory/animation.js
                </a>
              
                
                <a class="source" href="array-pool.html">
                  ./source/factory/array-pool.js
                </a>
              
                
                <a class="source" href="bezier.html">
                  ./source/factory/bezier.js
                </a>
              
                
                <a class="source" href="block.html">
                  ./source/factory/block.js
                </a>
              
                
                <a class="source" href="canvas.html">
                  ./source/factory/canvas.js
                </a>
              
                
                <a class="source" href="cell-fragment.html">
                  ./source/factory/cell-fragment.js
                </a>
              
                
                <a class="source" href="cell.html">
                  ./source/factory/cell.js
                </a>
              
                
                <a class="source" href="cog.html">
                  ./source/factory/cog.js
                </a>
              
                
                <a class="source" href="color.html">
                  ./source/factory/color.js
                </a>
              
                
                <a class="source" href="conic-gradient.html">
                  ./source/factory/conic-gradient.js
                </a>
              
                
                <a class="source" href="coordinate.html">
                  ./source/factory/coordinate.js
                </a>
              
                
                <a class="source" href="crescent.html">
                  ./source/factory/crescent.js
                </a>
              
                
                <a class="source" href="drag-zone.html">
                  ./source/factory/drag-zone.js
                </a>
              
                
                <a class="source" href="element.html">
                  ./source/factory/element.js
                </a>
              
                
                <a class="source" href="emitter.html">
                  ./source/factory/emitter.js
                </a>
              
                
                <a class="source" href="filter-engine-bluenoise-data.html">
                  ./source/factory/filter-engine-bluenoise-data.js
                </a>
              
                
                <a class="source" href="filter-engine.html">
                  ./source/factory/filter-engine.js
                </a>
              
                
                <a class="source" href="filter.html">
                  ./source/factory/filter.js
                </a>
              
                
                <a class="source" href="font-attributes.html">
                  ./source/factory/font-attributes.js
                </a>
              
                
                <a class="source" href="gradient.html">
                  ./source/factory/gradient.js
                </a>
              
                
                <a class="source" href="grid.html">
                  ./source/factory/grid.js
                </a>
              
                
                <a class="source" href="group.html">
                  ./source/factory/group.js
                </a>
              
                
                <a class="source" href="image-asset.html">
                  ./source/factory/image-asset.js
                </a>
              
                
                <a class="source" href="keyboard-zone.html">
                  ./source/factory/keyboard-zone.js
                </a>
              
                
                <a class="source" href="line-spiral.html">
                  ./source/factory/line-spiral.js
                </a>
              
                
                <a class="source" href="line.html">
                  ./source/factory/line.js
                </a>
              
                
                <a class="source" href="loom.html">
                  ./source/factory/loom.js
                </a>
              
                
                <a class="source" href="mesh.html">
                  ./source/factory/mesh.js
                </a>
              
                
                <a class="source" href="net.html">
                  ./source/factory/net.js
                </a>
              
                
                <a class="source" href="noise-asset.html">
                  ./source/factory/noise-asset.js
                </a>
              
                
                <a class="source" href="observe-update.html">
                  ./source/factory/observe-update.js
                </a>
              
                
                <a class="source" href="oval.html">
                  ./source/factory/oval.js
                </a>
              
                
                <a class="source" href="palette.html">
                  ./source/factory/palette.js
                </a>
              
                
                <a class="source" href="particle-force.html">
                  ./source/factory/particle-force.js
                </a>
              
                
                <a class="source" href="particle-history.html">
                  ./source/factory/particle-history.js
                </a>
              
                
                <a class="source" href="particle-spring.html">
                  ./source/factory/particle-spring.js
                </a>
              
                
                <a class="source" href="particle-world.html">
                  ./source/factory/particle-world.js
                </a>
              
                
                <a class="source" href="particle.html">
                  ./source/factory/particle.js
                </a>
              
                
                <a class="source" href="pattern.html">
                  ./source/factory/pattern.js
                </a>
              
                
                <a class="source" href="phrase.html">
                  ./source/factory/phrase.js
                </a>
              
                
                <a class="source" href="picture.html">
                  ./source/factory/picture.js
                </a>
              
                
                <a class="source" href="polygon.html">
                  ./source/factory/polygon.js
                </a>
              
                
                <a class="source" href="polyline.html">
                  ./source/factory/polyline.js
                </a>
              
                
                <a class="source" href="quadratic.html">
                  ./source/factory/quadratic.js
                </a>
              
                
                <a class="source" href="quaternion.html">
                  ./source/factory/quaternion.js
                </a>
              
                
                <a class="source" href="radial-gradient.html">
                  ./source/factory/radial-gradient.js
                </a>
              
                
                <a class="source" href="raw-asset.html">
                  ./source/factory/raw-asset.js
                </a>
              
                
                <a class="source" href="reaction-diffusion-asset.html">
                  ./source/factory/reaction-diffusion-asset.js
                </a>
              
                
                <a class="source" href="rectangle.html">
                  ./source/factory/rectangle.js
                </a>
              
                
                <a class="source" href="render-animation.html">
                  ./source/factory/render-animation.js
                </a>
              
                
                <a class="source" href="shape.html">
                  ./source/factory/shape.js
                </a>
              
                
                <a class="source" href="spiral.html">
                  ./source/factory/spiral.js
                </a>
              
                
                <a class="source" href="sprite-asset.html">
                  ./source/factory/sprite-asset.js
                </a>
              
                
                <a class="source" href="stack.html">
                  ./source/factory/stack.js
                </a>
              
                
                <a class="source" href="star.html">
                  ./source/factory/star.js
                </a>
              
                
                <a class="source" href="state.html">
                  ./source/factory/state.js
                </a>
              
                
                <a class="source" href="tetragon.html">
                  ./source/factory/tetragon.js
                </a>
              
                
                <a class="source" href="ticker.html">
                  ./source/factory/ticker.js
                </a>
              
                
                <a class="source" href="tracer.html">
                  ./source/factory/tracer.js
                </a>
              
                
                <a class="source" href="tween.html">
                  ./source/factory/tween.js
                </a>
              
                
                <a class="source" href="unstacked-element.html">
                  ./source/factory/unstacked-element.js
                </a>
              
                
                <a class="source" href="vector.html">
                  ./source/factory/vector.js
                </a>
              
                
                <a class="source" href="video-asset.html">
                  ./source/factory/video-asset.js
                </a>
              
                
                <a class="source" href="wheel.html">
                  ./source/factory/wheel.js
                </a>
              
                
                <a class="source" href="../mixin/anchor.html">
                  ./source/mixin/anchor.js
                </a>
              
                
                <a class="source" href="../mixin/asset-advanced-functionality.html">
                  ./source/mixin/asset-advanced-functionality.js
                </a>
              
                
                <a class="source" href="../mixin/asset-consumer.html">
                  ./source/mixin/asset-consumer.js
                </a>
              
                
                <a class="source" href="../mixin/asset.html">
                  ./source/mixin/asset.js
                </a>
              
                
                <a class="source" href="../mixin/base.html">
                  ./source/mixin/base.js
                </a>
              
                
                <a class="source" href="../mixin/cascade.html">
                  ./source/mixin/cascade.js
                </a>
              
                
                <a class="source" href="../mixin/cell-key-functions.html">
                  ./source/mixin/cell-key-functions.js
                </a>
              
                
                <a class="source" href="../mixin/delta.html">
                  ./source/mixin/delta.js
                </a>
              
                
                <a class="source" href="../mixin/display-shape.html">
                  ./source/mixin/display-shape.js
                </a>
              
                
                <a class="source" href="../mixin/dom.html">
                  ./source/mixin/dom.js
                </a>
              
                
                <a class="source" href="../mixin/entity.html">
                  ./source/mixin/entity.js
                </a>
              
                
                <a class="source" href="../mixin/filter.html">
                  ./source/mixin/filter.js
                </a>
              
                
                <a class="source" href="../mixin/mimic.html">
                  ./source/mixin/mimic.js
                </a>
              
                
                <a class="source" href="../mixin/path.html">
                  ./source/mixin/path.js
                </a>
              
                
                <a class="source" href="../mixin/pattern.html">
                  ./source/mixin/pattern.js
                </a>
              
                
                <a class="source" href="../mixin/pivot.html">
                  ./source/mixin/pivot.js
                </a>
              
                
                <a class="source" href="../mixin/position.html">
                  ./source/mixin/position.js
                </a>
              
                
                <a class="source" href="../mixin/shape-basic.html">
                  ./source/mixin/shape-basic.js
                </a>
              
                
                <a class="source" href="../mixin/shape-curve.html">
                  ./source/mixin/shape-curve.js
                </a>
              
                
                <a class="source" href="../mixin/shape-path-calculation.html">
                  ./source/mixin/shape-path-calculation.js
                </a>
              
                
                <a class="source" href="../mixin/styles.html">
                  ./source/mixin/styles.js
                </a>
              
                
                <a class="source" href="../mixin/tween.html">
                  ./source/mixin/tween.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-1">&#x00a7;</a>
              </div>
              <h1 id="group-factory">Group factory</h1>
<p>Scrawl-canvas uses Group objects to gather together artefact objects (Block, Canvas, Element, Grid, Loom, Phrase, Picture, Shape, Stack, Wheel) for common functions.</p>
<p>Groups connect artefacts with controller objects - Stack, Cell - through which the Display cycle can cascade. Each controller object can have more than one Group associated with it. Only Groups whose <strong>visibility</strong> flag has been set to true will propagate the Display cycle cascade to their member artefacts. The order in which each controller object invokes its Group objects is determined by each Group object’s <strong>order</strong> value.</p>
<p>Groups can also be used for purposes beyond the Display cycle:</p>
<ul>
<li>They are closely involved in collision detection functionality.</li>
<li>They can be used to propagate updates to their constituent artefacts - for instance animating them in a coordinated manner.</li>
<li>Filters can be applied to entity objects at the Group level</li>
</ul>
<p>Additional functionality to help control and interact with Groups is defined in the <strong>cascade</strong> mixin. Groups also use the <strong>base</strong> mixin, thus they come equipped with packet functionality, alongside clone and kill functions.</p>
<p>NOTE: <strong>Groups are NOT used to position a set of artefacts in the display</strong> - they have no positioning functionality, which is instead handled by the artefact objects themselves. To position and move a collection of artefacts around the display, choose one of them to act as a a reference, and then <strong>pivot</strong> or <strong>mimic</strong> other artefacts to that reference. When you position or animate the reference artefact, all the other artefacts will position/move with it. See Demo <a href="../../demo/canvas-002.html">Canvas-002</a> for an example.</p>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-2">&#x00a7;</a>
              </div>
              <h4 id="demos">Demos:</h4>
<ul>
<li><a href="../../demo/canvas-014.html">Canvas-014</a> - Line, quadratic and bezier Shapes - control lock alternatives</li>
<li><a href="../../demo/canvas-020.html">Canvas-020</a> - Testing createImageFromXXX functionality</li>
<li><a href="../../demo/dom-003.html">DOM-003</a> - Dynamically create and clone Element artefacts; drag and drop elements (including SVG elements) around a Stack</li>
<li><a href="../../demo/dom-008.html">DOM-008</a> - 3d animated cube</li>
<li><a href="../../demo/dom-009.html">DOM-009</a> - Stop and restart the main animation loop; add and remove event listener; retrieve all artefacts at a given coordinate</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-3">&#x00a7;</a>
              </div>
              <h4 id="imports">Imports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { artefact, cell, constructors, entity, group } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/library.js&#x27;</span>;

<span class="hljs-keyword">import</span> { doCreate, mergeOver, pushUnique, removeItem, λ<span class="hljs-literal">null</span>, Ωempty } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/utilities.js&#x27;</span>;

<span class="hljs-keyword">import</span> { scrawlCanvasHold } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/document.js&#x27;</span>;

<span class="hljs-keyword">import</span> { filterEngine } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./filter-engine.js&#x27;</span>;

<span class="hljs-keyword">import</span> { releaseCell, requestCell } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./cell-fragment.js&#x27;</span>;

<span class="hljs-keyword">import</span> { importDomImage } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./image-asset.js&#x27;</span>;

<span class="hljs-keyword">import</span> { releaseArray, requestArray } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./array-pool.js&#x27;</span>;

<span class="hljs-keyword">import</span> baseMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/base.js&#x27;</span>;
<span class="hljs-keyword">import</span> filterMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/filter.js&#x27;</span>;

<span class="hljs-keyword">import</span> { _isArray, _floor, _values, <span class="hljs-variable constant_">ACCEPTED_OWNERS</span>, <span class="hljs-variable constant_">ADD_CLASSES</span>, <span class="hljs-variable constant_">ENTITY</span>, <span class="hljs-variable constant_">GROUP</span>, <span class="hljs-variable constant_">REMOVE_CLASSES</span>, <span class="hljs-variable constant_">REVERSE_BY_DELTA</span>, <span class="hljs-variable constant_">SET</span>, <span class="hljs-variable constant_">SET_DELTA</span>, <span class="hljs-variable constant_">SOURCE_IN</span>, <span class="hljs-variable constant_">SOURCE_OVER</span>, <span class="hljs-variable constant_">T_GROUP</span>, <span class="hljs-variable constant_">UPDATE_BY_DELTA</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/shared-vars.js&#x27;</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-4">&#x00a7;</a>
              </div>
              <h4 id="group-constructor">Group constructor</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> <span class="hljs-title class_">Group</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">items = Ωempty</span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">makeName</span>(items.<span class="hljs-property">name</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">register</span>();

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">artefacts</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">artefactCalculateBuckets</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">artefactStampBuckets</span> = [];

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">set</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">defs</span>);

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">onEntityHover</span> = λ<span class="hljs-literal">null</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">onEntityNoHover</span> = λ<span class="hljs-literal">null</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isHovering</span> = <span class="hljs-literal">null</span>;

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">set</span>(items);

    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-5">&#x00a7;</a>
              </div>
              <h4 id="group-prototype">Group prototype</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> P = <span class="hljs-title class_">Group</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title function_">doCreate</span>();
P.<span class="hljs-property">type</span> = <span class="hljs-variable constant_">T_GROUP</span>;
P.<span class="hljs-property">lib</span> = <span class="hljs-variable constant_">GROUP</span>;
P.<span class="hljs-property">isArtefact</span> = <span class="hljs-literal">false</span>;
P.<span class="hljs-property">isAsset</span> = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-6">&#x00a7;</a>
              </div>
              <h4 id="mixins">Mixins</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-title function_">baseMix</span>(P);
<span class="hljs-title function_">filterMix</span>(P);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-7">&#x00a7;</a>
              </div>
              <h4 id="group-attributes">Group attributes</h4>
<ul>
<li>Attributes defined in the <a href="../mixin/base.html">base mixin</a>: <strong>name</strong>.</li>
<li>Attributes defined in the <a href="../mixin/filter.html">filter mixin</a>: <strong>filters, isStencil</strong>.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> defaultAttributes = {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-8">&#x00a7;</a>
              </div>
              <p><strong>artefacts</strong> - an Array containing the names of all artefact objects included in this group.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">artefacts</span>: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-9">&#x00a7;</a>
              </div>
              <p><strong>order</strong> - positive integer Number, which determines the order in which Stack and Cell controllers will process this Group object during the Display cycle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">order</span>: <span class="hljs-number">0</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-10">&#x00a7;</a>
              </div>
              <p><strong>visibility</strong> - Boolean flag; when unset, the Group will <strong>not</strong> be processed by Stack and Cell controllers as part of the Display cycle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">visibility</span>: <span class="hljs-literal">true</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-11">&#x00a7;</a>
              </div>
              <p><strong>regionRadius</strong> - positive Number (measured in px), used as an initial test as part of collision detection functionality</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">regionRadius</span>: <span class="hljs-number">0</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-12">&#x00a7;</a>
              </div>
              <p><strong>checkForEntityHover</strong> - we can trigger groups, as part of the Display cycle, to check if any of their entitys are currently hittable (the mouse cursor is hovering over them) and run functions based on changes in hover state. This is not the same as canvas <code>cascadeEventActions</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">checkForEntityHover</span>: <span class="hljs-literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-13">&#x00a7;</a>
              </div>
              <p><strong>onEntityHover</strong> - define tasks to be performed for <code>down</code> events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">onEntityHover</span>: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-14">&#x00a7;</a>
              </div>
              <p><strong>onEntityNoHover</strong> - define tasks to be performed for <code>up</code> events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">onEntityNoHover</span>: <span class="hljs-literal">null</span>,
};
P.<span class="hljs-property">defs</span> = <span class="hljs-title function_">mergeOver</span>(P.<span class="hljs-property">defs</span>, defaultAttributes);</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-15">&#x00a7;</a>
              </div>
              <h4 id="packet-management">Packet management</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">packetExclusions</span> = <span class="hljs-title function_">pushUnique</span>(P.<span class="hljs-property">packetExclusions</span>, [<span class="hljs-string">&#x27;artefactCalculateBuckets&#x27;</span>, <span class="hljs-string">&#x27;artefactStampBuckets&#x27;</span>, <span class="hljs-string">&#x27;batchResort&#x27;</span>]);
P.<span class="hljs-property">packetFunctions</span> = <span class="hljs-title function_">pushUnique</span>(P.<span class="hljs-property">packetFunctions</span>, [<span class="hljs-string">&#x27;onEntityHover&#x27;</span>, <span class="hljs-string">&#x27;onEntityNoHover&#x27;</span>]);</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-16">&#x00a7;</a>
              </div>
              <h4 id="clone-management">Clone management</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">postCloneAction</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">clone, items</span>) {

    <span class="hljs-keyword">let</span> host;

    <span class="hljs-keyword">if</span> (items.<span class="hljs-property">host</span>) {

        host = artefact[items.<span class="hljs-property">host</span>];
    }
    <span class="hljs-keyword">else</span> {

        host = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentHost</span>) ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentHost</span> : (<span class="hljs-variable language_">this</span>.<span class="hljs-property">host</span>) ? artefact[<span class="hljs-variable language_">this</span>.<span class="hljs-property">host</span>] : <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">if</span> (host) {

        host.<span class="hljs-title function_">addGroups</span>(clone.<span class="hljs-property">name</span>);
        <span class="hljs-keyword">if</span> (!clone.<span class="hljs-property">host</span>) clone.<span class="hljs-property">host</span> = host.<span class="hljs-property">name</span>;
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">onEntityHover</span>) clone.<span class="hljs-property">onEntityHover</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">onEntityHover</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">onEntityNoHover</span>) clone.<span class="hljs-property">onEntityNoHover</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">onEntityNoHover</span>;

    <span class="hljs-keyword">return</span> clone;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-17">&#x00a7;</a>
              </div>
              <h4 id="kill-management">Kill management</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">kill</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">killArtefacts = <span class="hljs-literal">false</span></span>) {

    <span class="hljs-keyword">if</span> (killArtefacts) <span class="hljs-variable language_">this</span>.<span class="hljs-property">artefactCalculateBuckets</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-title function_">kill</span>());

    <span class="hljs-keyword">const</span> myname = <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-18">&#x00a7;</a>
              </div>
              <p>Remove the Group object from affected Stack and Cell objects’ <code>groups</code> attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-title function_">_values</span>(artefact).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">art</span> =&gt;</span> {

        <span class="hljs-keyword">if</span> (<span class="hljs-title function_">_isArray</span>(art.<span class="hljs-property">groups</span>) &amp;&amp; art.<span class="hljs-property">groups</span>.<span class="hljs-title function_">includes</span>(myname)) {

            <span class="hljs-title function_">removeItem</span>(art.<span class="hljs-property">groups</span>, myname);
            art.<span class="hljs-property">batchResort</span> = <span class="hljs-literal">true</span>;
        }
    });

    <span class="hljs-title function_">_values</span>(cell).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">obj</span> =&gt;</span> {

        <span class="hljs-keyword">if</span> (<span class="hljs-title function_">_isArray</span>(obj.<span class="hljs-property">groups</span>) &amp;&amp; obj.<span class="hljs-property">groups</span>.<span class="hljs-title function_">includes</span>(myname)) {

            <span class="hljs-title function_">removeItem</span>(obj.<span class="hljs-property">groups</span>, myname);
            obj.<span class="hljs-property">batchResort</span> = <span class="hljs-literal">true</span>;
        }
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-19">&#x00a7;</a>
              </div>
              <p>Remove Group object from the Scrawl-canvas library</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">deregister</span>();
}

P.<span class="hljs-property">killArtefacts</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">artefactCalculateBuckets</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-title function_">kill</span>());

    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-20">&#x00a7;</a>
              </div>
              <h4 id="get-set-deltaset">Get, Set, deltaSet</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> G = P.<span class="hljs-property">getters</span>,
    S = P.<span class="hljs-property">setters</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-21">&#x00a7;</a>
              </div>
              <p>Artefect membership of the Group object is better handled by the dedicated artefact management functions - <strong>addArtefacts</strong>, <strong>removeArtefacts</strong>, <strong>clearArtefacts</strong>, <strong>moveArtefactsIntoGroup</strong>.</p>

            </div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-22">&#x00a7;</a>
              </div>
              <p>Returns a new Array containing the name String values of current artefact members</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>G.<span class="hljs-property">artefacts</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-keyword">return</span> [].<span class="hljs-title function_">concat</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">artefacts</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-23">&#x00a7;</a>
              </div>
              <p>Replaces the existing artefact membership with new members, supplied as an Array of name-String values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.<span class="hljs-property">artefacts</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">artefacts</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-property">artefacts</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">artefacts</span>.<span class="hljs-property">length</span> = <span class="hljs-number">0</span>;

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addArtefacts</span>(item);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-24">&#x00a7;</a>
              </div>
              <p>Adds the Group to a new controller Stack or Cell object. NOTE that this does not remove the Group from its existing host!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.<span class="hljs-property">host</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    <span class="hljs-keyword">const</span> host = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getHost</span>(item);

    <span class="hljs-keyword">if</span> (host &amp;&amp; host.<span class="hljs-property">addGroups</span>) {

        <span class="hljs-variable language_">this</span>.<span class="hljs-property">host</span> = item;
        host.<span class="hljs-title function_">addGroups</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);

        <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyHost</span> = <span class="hljs-literal">true</span>;
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-25">&#x00a7;</a>
              </div>
              <p>Update the Group’s <code>order</code> attribute, and tell its current host that it will need to resort its associated Groups</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.<span class="hljs-property">order</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    <span class="hljs-keyword">const</span> host = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getHost</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">host</span>);

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">order</span> = item;

    <span class="hljs-keyword">if</span> (host) {

        host.<span class="hljs-title function_">set</span>({
            <span class="hljs-attr">batchResort</span>: <span class="hljs-literal">true</span>
        });
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-26">&#x00a7;</a>
              </div>
              <p><strong>noFilters</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.<span class="hljs-property">noFilters</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">noFilters</span> = item;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyFilterIdentifier</span> = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-27">&#x00a7;</a>
              </div>
              <h4 id="prototype-functions">Prototype functions</h4>

            </div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-28">&#x00a7;</a>
              </div>
              <p><code>getHost</code> - internal helper function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">getHost</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    <span class="hljs-keyword">if</span> (item) {

        <span class="hljs-keyword">if</span> (item.<span class="hljs-property">type</span> &amp;&amp; <span class="hljs-variable constant_">ACCEPTED_OWNERS</span>.<span class="hljs-title function_">includes</span>(item.<span class="hljs-property">type</span>)) <span class="hljs-keyword">return</span> item;
        <span class="hljs-keyword">if</span> (item.<span class="hljs-property">substring</span>) <span class="hljs-keyword">return</span> artefact[item] || cell[item];
    }

    <span class="hljs-keyword">const</span> host = <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentHost</span>;

    <span class="hljs-keyword">if</span> (host &amp;&amp; host.<span class="hljs-property">substring</span>) <span class="hljs-keyword">return</span> artefact[host] || cell[host];

    <span class="hljs-keyword">return</span> host;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-29">&#x00a7;</a>
              </div>
              <p><code>forceStamp</code> - invoke the Group to instruct its artefact members to perform a <code>stamp</code> action, ignoring whether the Group <code>visibility</code> flag setting</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">forceStamp</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-keyword">const</span> v = <span class="hljs-variable language_">this</span>.<span class="hljs-property">visibility</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">visibility</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">stamp</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">visibility</span> = v;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-30">&#x00a7;</a>
              </div>
              <p><code>stamp</code> - the Display Cycle is mediated through Groups.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">stamp</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-31">&#x00a7;</a>
              </div>
              <p>Check we have a host of some sort (either a Stack artefact or a Cell asset)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyHost</span> || !<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentHost</span>) {

        <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyHost</span> = <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">const</span> currentHost = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getHost</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">host</span>);

        <span class="hljs-keyword">if</span> (currentHost) <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentHost</span> = currentHost;
        <span class="hljs-keyword">else</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyHost</span> = <span class="hljs-literal">true</span>;
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">visibility</span>) {

        <span class="hljs-keyword">const</span> { currentHost, stashOutput, noFilters, filters } = <span class="hljs-variable language_">this</span>;

        <span class="hljs-keyword">if</span> (currentHost) {</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-32">&#x00a7;</a>
              </div>
              <p>Check if artefacts need to be sorterd and, if yes, sort them by their order attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sortArtefacts</span>();</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-33">&#x00a7;</a>
              </div>
              <p>Check to see if there is a Group filter in place or if the Group needs to stash its output and, if yes, pull a Cell asset from the pool</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">const</span> filterCell = (stashOutput || (!noFilters &amp;&amp; filters &amp;&amp; filters.<span class="hljs-property">length</span>)) ?
                <span class="hljs-title function_">requestCell</span>() :
                <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-34">&#x00a7;</a>
              </div>
              <p>Setup the pool Cell, if required</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (filterCell &amp;&amp; filterCell.<span class="hljs-property">element</span>) {

                <span class="hljs-keyword">const</span> dims = currentHost.<span class="hljs-property">currentDimensions</span>,
                    fEl = filterCell.<span class="hljs-property">element</span>;

                <span class="hljs-keyword">if</span> (dims &amp;&amp; fEl) {

                    fEl.<span class="hljs-property">width</span> = dims[<span class="hljs-number">0</span>];
                    fEl.<span class="hljs-property">height</span> = dims[<span class="hljs-number">1</span>];
                }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-35">&#x00a7;</a>
              </div>
              <p>We save/restore the canvas engine at this point because some entitys may have their <code>method</code> attribute set to <code>clip</code> and the only way to get rid of a clip region from an engine is to save the engine before applying the clip, then restoring the engine afterwards</p>
<ul>
<li>This has implications for tracking engine attributes</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (currentHost.<span class="hljs-property">engine</span>) currentHost.<span class="hljs-property">engine</span>.<span class="hljs-title function_">save</span>();</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-36">&#x00a7;</a>
              </div>
              <p>Prepare the Group’s artefacts for the forthcoming stamp activity</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">prepareStamp</span>(filterCell);</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-37">&#x00a7;</a>
              </div>
              <p>Get the Group’s artefacts to stamp themselves on the current host or pool Cell</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">stampAction</span>(filterCell);

            <span class="hljs-keyword">if</span> (filterCell) <span class="hljs-title function_">releaseCell</span>(filterCell);
            <span class="hljs-keyword">else</span> {

                <span class="hljs-keyword">if</span> (currentHost.<span class="hljs-property">engine</span>) {

                    currentHost.<span class="hljs-property">engine</span>.<span class="hljs-title function_">restore</span>();
                    currentHost.<span class="hljs-title function_">setEngineFromState</span>(currentHost.<span class="hljs-property">engine</span>);
                }
            }
        }
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-38">&#x00a7;</a>
              </div>
              <p><code>sortArtefacts</code> - internal function. Uses a bucket sort algorithm</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">sortArtefacts</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">batchResort</span>) {

        <span class="hljs-variable language_">this</span>.<span class="hljs-property">batchResort</span> = <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">const</span> calcBuckets = <span class="hljs-title function_">requestArray</span>(),
            stampBuckets = <span class="hljs-title function_">requestArray</span>();

        <span class="hljs-keyword">const</span> { artefacts, artefactCalculateBuckets, artefactStampBuckets } = <span class="hljs-variable language_">this</span>;

        <span class="hljs-keyword">let</span> obj, order, i, iz, name, arr;

        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = artefacts.<span class="hljs-property">length</span>; i &lt; iz; i++) {

            name = artefacts[i];
            obj = artefact[name];

            <span class="hljs-keyword">if</span> (obj) {</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-39">&#x00a7;</a>
              </div>
              <p>Sort for artefact calculateOrder</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                order = <span class="hljs-title function_">_floor</span>(obj.<span class="hljs-property">calculateOrder</span>);
                <span class="hljs-keyword">if</span> (!calcBuckets[order]) calcBuckets[order] = <span class="hljs-title function_">requestArray</span>();
                calcBuckets[order].<span class="hljs-title function_">push</span>(obj);</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-40">&#x00a7;</a>
              </div>
              <p>Sort for artefact stampOrder</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                order = <span class="hljs-title function_">_floor</span>(obj.<span class="hljs-property">stampOrder</span>);
                <span class="hljs-keyword">if</span> (!stampBuckets[order]) stampBuckets[order] = <span class="hljs-title function_">requestArray</span>();
                stampBuckets[order].<span class="hljs-title function_">push</span>(obj);
            }
        }

        artefactCalculateBuckets.<span class="hljs-property">length</span> = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = calcBuckets.<span class="hljs-property">length</span>; i &lt; iz; i++) {

            arr = calcBuckets[i];

            <span class="hljs-keyword">if</span> (arr) {

                artefactCalculateBuckets.<span class="hljs-title function_">push</span>(...arr);
                <span class="hljs-title function_">releaseArray</span>(arr);
            }
        }
        <span class="hljs-title function_">releaseArray</span>(calcBuckets);

        artefactStampBuckets.<span class="hljs-property">length</span> = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = stampBuckets.<span class="hljs-property">length</span>; i &lt; iz; i++) {

            arr = stampBuckets[i];

            <span class="hljs-keyword">if</span> (arr) {

                artefactStampBuckets.<span class="hljs-title function_">push</span>(...arr);
                <span class="hljs-title function_">releaseArray</span>(arr);
            }
        }
        <span class="hljs-title function_">releaseArray</span>(stampBuckets);
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-41">&#x00a7;</a>
              </div>
              <p><code>prepareStamp</code> - initial action in the Display cycle, before Stacks/Cells start their clear/compile/show cascade</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">prepareStamp</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">myCell</span>) {

    <span class="hljs-keyword">let</span> host = <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentHost</span>;

    <span class="hljs-keyword">if</span> (myCell) host = myCell;

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">artefactCalculateBuckets</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">art</span> =&gt;</span> {

        <span class="hljs-keyword">if</span> (art.<span class="hljs-property">lib</span> == <span class="hljs-variable constant_">ENTITY</span>) {

            <span class="hljs-keyword">if</span> (!art.<span class="hljs-property">currentHost</span> || art.<span class="hljs-property">currentHost</span>.<span class="hljs-property">name</span> != host.<span class="hljs-property">name</span>) {

                art.<span class="hljs-property">currentHost</span> = host;
                <span class="hljs-keyword">if</span> (!myCell) art.<span class="hljs-property">dirtyHost</span> = <span class="hljs-literal">true</span>;
            }
        }

        <span class="hljs-keyword">if</span> (!art.<span class="hljs-property">noDeltaUpdates</span>) art.<span class="hljs-title function_">updateByDelta</span>();

        art.<span class="hljs-title function_">prepareStamp</span>();
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-42">&#x00a7;</a>
              </div>
              <p><code>stampAction</code> - the key Group-mediated action in the Display cycle, invoked as part of the <code>compile</code> functionality.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">stampAction</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">myCell</span>) {

    <span class="hljs-keyword">const</span> { dirtyFilters, currentFilters, artefactStampBuckets, noFilters, filters, stashOutput, currentHost } = <span class="hljs-variable language_">this</span>;

    <span class="hljs-keyword">if</span> (dirtyFilters || !currentFilters) <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cleanFilters</span>();

    artefactStampBuckets.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">art</span> =&gt;</span> {

        <span class="hljs-keyword">if</span> (art &amp;&amp; art.<span class="hljs-property">stamp</span>) art.<span class="hljs-title function_">stamp</span>();
    });

    <span class="hljs-keyword">if</span> (myCell) {

        <span class="hljs-keyword">if</span> (!noFilters &amp;&amp; filters &amp;&amp; filters.<span class="hljs-property">length</span>) {

            <span class="hljs-keyword">const</span> img = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">applyFilters</span>(myCell);
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">stashAction</span>(img);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (stashOutput) {</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-43">&#x00a7;</a>
              </div>
              <p>We set up things to draw the group on a pool cell if the Group’s <code>stashOutput</code> flag is set to true - so now we have to paint it back into the host Cell</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">const</span> tempElement = myCell.<span class="hljs-property">element</span>,
                tempEngine = myCell.<span class="hljs-property">engine</span>,
                realEngine = (currentHost &amp;&amp; currentHost.<span class="hljs-property">engine</span>) ? currentHost.<span class="hljs-property">engine</span> : <span class="hljs-literal">false</span>;

            <span class="hljs-keyword">if</span> (realEngine) {

                realEngine.<span class="hljs-title function_">save</span>();

                realEngine.<span class="hljs-property">globalCompositeOperation</span> = <span class="hljs-variable constant_">SOURCE_OVER</span>;
                realEngine.<span class="hljs-property">globalAlpha</span> = <span class="hljs-number">1</span>;
                realEngine.<span class="hljs-title function_">setTransform</span>(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);

                realEngine.<span class="hljs-title function_">drawImage</span>(tempElement, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);

                realEngine.<span class="hljs-title function_">restore</span>();

                <span class="hljs-keyword">const</span> tempImg = tempEngine.<span class="hljs-title function_">getImageData</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, tempElement.<span class="hljs-property">width</span>, tempElement.<span class="hljs-property">height</span>);

                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">stashAction</span>(tempImg);
            }
        }
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-44">&#x00a7;</a>
              </div>
              <p><code>applyFilters</code> - filters can be applied to entity artefacts at the group level, in addition to any filters applied at the entity level.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">applyFilters</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">myCell</span>) {

    <span class="hljs-keyword">const</span> currentHost = <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentHost</span>;

    <span class="hljs-keyword">if</span> (!currentHost || !myCell) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-45">&#x00a7;</a>
              </div>
              <p>Get handles to current and filter Cell elements and engines</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> currentElement = currentHost.<span class="hljs-property">element</span>,
        currentEngine = currentHost.<span class="hljs-property">engine</span>;

    <span class="hljs-keyword">const</span> filterCellElement = myCell.<span class="hljs-property">element</span>,
        filterCellEngine = myCell.<span class="hljs-property">engine</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-46">&#x00a7;</a>
              </div>
              <p>Action a request to use the filtered artefacts as a stencil - as determined by the Group’s <code>isStencil</code> flag</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isStencil</span>) {

        filterCellEngine.<span class="hljs-title function_">save</span>();
        filterCellEngine.<span class="hljs-property">globalCompositeOperation</span> = <span class="hljs-variable constant_">SOURCE_IN</span>;
        filterCellEngine.<span class="hljs-property">globalAlpha</span> = <span class="hljs-number">1</span>;
        filterCellEngine.<span class="hljs-title function_">setTransform</span>(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        filterCellEngine.<span class="hljs-title function_">drawImage</span>(currentElement, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        filterCellEngine.<span class="hljs-title function_">restore</span>();

        <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyFilterIdentifier</span> = <span class="hljs-literal">true</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-47">&#x00a7;</a>
              </div>
              <p>At this point we will send the contents of the filterHost canvas over to the filter engine</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    filterCellEngine.<span class="hljs-title function_">setTransform</span>(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);

    <span class="hljs-keyword">const</span> myimage = filterCellEngine.<span class="hljs-title function_">getImageData</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, filterCellElement.<span class="hljs-property">width</span>, filterCellElement.<span class="hljs-property">height</span>);

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">preprocessFilters</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentFilters</span>);

    <span class="hljs-keyword">const</span> img = filterEngine.<span class="hljs-title function_">action</span>({
        <span class="hljs-attr">identifier</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">filterIdentifier</span>,
        <span class="hljs-attr">image</span>: myimage,
        <span class="hljs-attr">filters</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentFilters</span>,
    })

    <span class="hljs-keyword">if</span> (img) {

        filterCellEngine.<span class="hljs-property">globalCompositeOperation</span> = <span class="hljs-variable constant_">SOURCE_OVER</span>;
        filterCellEngine.<span class="hljs-property">globalAlpha</span> = <span class="hljs-number">1</span>;
        filterCellEngine.<span class="hljs-title function_">setTransform</span>(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        filterCellEngine.<span class="hljs-title function_">putImageData</span>(img, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
    }

    currentEngine.<span class="hljs-title function_">save</span>();
    currentEngine.<span class="hljs-title function_">setTransform</span>(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
    currentEngine.<span class="hljs-title function_">drawImage</span>(filterCellElement, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
    currentEngine.<span class="hljs-title function_">restore</span>();

    <span class="hljs-keyword">return</span> img;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-48">&#x00a7;</a>
              </div>
              <p><code>stashAction</code> - internal function which creates an ImageAsset object (and, as determined by the setting of the Group’s <code>stashOutputAsAsset</code> flag, an &lt;img&gt; element which gets attached to the DOM document in the <code>scrawlCanvasHold</code> hidden &lt;div&gt; element) from the Group’s entity’s output.</p>
<p>NOTE: the <code>stashOutput</code> and <code>stashOutputAsAsset</code> flags are not Group object attributes. They are set on the group as a result of invoking the <code>scrawl.createImageFromGroup</code> function, and will be set to false as soon as the <code>Group.stashAction</code> function runs (in other words, stashing a Group’s output is a one-off operation).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">stashAction</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">img</span>) {

    <span class="hljs-keyword">if</span> (!img) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">stashOutput</span>) {

        <span class="hljs-variable language_">this</span>.<span class="hljs-property">stashOutput</span> = <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">const</span> [x, y, width, height] = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getCellCoverage</span>(img);

        <span class="hljs-keyword">const</span> myCell = <span class="hljs-title function_">requestCell</span>(),
            myEngine = myCell.<span class="hljs-property">engine</span>,
            myElement = myCell.<span class="hljs-property">element</span>;

        myElement.<span class="hljs-property">width</span> = width;
        myElement.<span class="hljs-property">height</span> = height;

        myEngine.<span class="hljs-title function_">putImageData</span>(img, -x, -y);

        <span class="hljs-variable language_">this</span>.<span class="hljs-property">stashedImageData</span> = myEngine.<span class="hljs-title function_">getImageData</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height);

        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">stashOutputAsAsset</span>) {

            <span class="hljs-keyword">const</span> stashId = <span class="hljs-variable language_">this</span>.<span class="hljs-property">stashOutputAsAsset</span>.<span class="hljs-property">substring</span> ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">stashOutputAsAsset</span> : <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>-groupimage`</span>;

            <span class="hljs-variable language_">this</span>.<span class="hljs-property">stashOutputAsAsset</span> = <span class="hljs-literal">false</span>;

            <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">stashedImage</span>) {

                <span class="hljs-keyword">const</span> newimg = <span class="hljs-variable language_">this</span>.<span class="hljs-property">stashedImage</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;img&#x27;</span>);

                newimg.<span class="hljs-property">id</span> = stashId;

                newimg.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

                    scrawlCanvasHold.<span class="hljs-title function_">appendChild</span>(newimg);
                    <span class="hljs-title function_">importDomImage</span>(<span class="hljs-string">`#<span class="hljs-subst">${stashId}</span>`</span>);
                };

                newimg.<span class="hljs-property">src</span> = myElement.<span class="hljs-title function_">toDataURL</span>();
            }
            <span class="hljs-keyword">else</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">stashedImage</span>.<span class="hljs-property">src</span> = myElement.<span class="hljs-title function_">toDataURL</span>();
        }
        <span class="hljs-title function_">releaseCell</span>(myCell);
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-49">&#x00a7;</a>
              </div>
              <p><code>getCellCoverage</code> - internal function which calculates the cumulative coverage of the Group’s artefacts. Used as part of the <code>stashAction</code> functionality</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">getCellCoverage</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">img</span>) {

    <span class="hljs-keyword">const</span> { width, height, data } = img;

    <span class="hljs-keyword">let</span> maxX = <span class="hljs-number">0</span>,
        maxY = <span class="hljs-number">0</span>,
        minX = width,
        minY = height,
        counter = <span class="hljs-number">3</span>,
        x, y, i, iz;

    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = width * height; i &lt; iz; i++) {

        <span class="hljs-keyword">if</span> (data[counter]) {

            y = <span class="hljs-title function_">_floor</span>(i / width);
            x = i - (y * width);

            <span class="hljs-keyword">if</span> (minX &gt; x) minX = x;
            <span class="hljs-keyword">if</span> (maxX &lt; x) maxX = x;
            <span class="hljs-keyword">if</span> (minY &gt; y) minY = y;
            <span class="hljs-keyword">if</span> (maxY &lt; y) maxY = y;
        }
        counter += <span class="hljs-number">4</span>;
    }
    <span class="hljs-keyword">if</span> (minX &lt; maxX &amp;&amp; minY &lt; maxY) <span class="hljs-keyword">return</span> [minX, minY, maxX - minX, maxY - minY];
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height];
};</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-50">&#x00a7;</a>
              </div>
              <h4 id="artefact-management">Artefact management</h4>
<p>Artefacts should be added to, and removed from, the Group object using the functions detailed below.</p>
<p>The argument for each function can be one or more artefact object’s name attribute, or the artefact objects themselves, separated by commas.</p>

            </div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-51">&#x00a7;</a>
              </div>
              <p><code>addArtefacts</code> - an artefact can belong to more than one Group</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">addArtefacts</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) {

    <span class="hljs-keyword">if</span> (args &amp;&amp; <span class="hljs-title function_">_isArray</span>(args[<span class="hljs-number">0</span>])) args = args[<span class="hljs-number">0</span>];

    args.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {

        <span class="hljs-keyword">if</span> (item) {

            <span class="hljs-keyword">if</span> (item.<span class="hljs-property">substring</span>) <span class="hljs-title function_">pushUnique</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">artefacts</span>, item);
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.<span class="hljs-property">name</span>) <span class="hljs-title function_">pushUnique</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">artefacts</span>, item.<span class="hljs-property">name</span>);
        }
    }, <span class="hljs-variable language_">this</span>);

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">batchResort</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-52">&#x00a7;</a>
              </div>
              <p><code>getArtefact</code> - return the artifact with the given name IF the artefact is a member of the group</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">getArtefact</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">name</span>) {

    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">artefacts</span>.<span class="hljs-title function_">includes</span>(name)) <span class="hljs-keyword">return</span> artefact[name] || <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-53">&#x00a7;</a>
              </div>
              <p><code>removeArtefacts</code> - remove an artefact from this Group</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">removeArtefacts</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) {

    args.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {

        <span class="hljs-keyword">if</span> (item) {

            <span class="hljs-keyword">if</span> (item.<span class="hljs-property">substring</span>) <span class="hljs-title function_">removeItem</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">artefacts</span>, item);
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.<span class="hljs-property">name</span>) <span class="hljs-title function_">removeItem</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">artefacts</span>, item.<span class="hljs-property">name</span>);
        }
    }, <span class="hljs-variable language_">this</span>);

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">batchResort</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-54">&#x00a7;</a>
              </div>
              <p><code>moveArtefactsIntoGroup</code> - remove the artefact from their current Group (which is generally their Display cycle group, as set in their <code>group</code> and/or <code>host</code> attribute) and add them to this Group</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">moveArtefactsIntoGroup</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) {

    <span class="hljs-keyword">let</span> temp, art;

    args.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {

        <span class="hljs-keyword">if</span> (item) {

            art = (item.<span class="hljs-property">substring</span>) ? artefact[item] : item;

            <span class="hljs-keyword">if</span> (art &amp;&amp; art.<span class="hljs-property">isArtefact</span>) {

                <span class="hljs-keyword">if</span> (art.<span class="hljs-property">group</span>) temp = art.<span class="hljs-property">group</span>;
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (art.<span class="hljs-property">host</span>) temp = group[art.<span class="hljs-property">host</span>];
                <span class="hljs-keyword">else</span> temp = <span class="hljs-literal">false</span>;
            }

            <span class="hljs-keyword">if</span> (temp) {

                temp.<span class="hljs-title function_">removeArtefacts</span>(item);
                temp.<span class="hljs-property">batchResort</span> = <span class="hljs-literal">true</span>;
            }
            <span class="hljs-title function_">pushUnique</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">artefacts</span>, item);
        }
    }, <span class="hljs-variable language_">this</span>);

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">batchResort</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-55">&#x00a7;</a>
              </div>
              <p><code>clearArtefacts</code> - remove all artefacts from this Group</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">clearArtefacts</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">artefacts</span>.<span class="hljs-property">length</span> = <span class="hljs-number">0</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">artefactCalculateBuckets</span>.<span class="hljs-property">length</span> = <span class="hljs-number">0</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">artefactStampBuckets</span>.<span class="hljs-property">length</span> = <span class="hljs-number">0</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">batchResort</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-56">&#x00a7;</a>
              </div>
              <p><code>updateArtefacts</code> - passes the <strong>items</strong> argument object through to each of the Group’s artefact’s <code>setDelta</code> function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">updateArtefacts</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cascadeAction</span>(items, <span class="hljs-variable constant_">SET_DELTA</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-57">&#x00a7;</a>
              </div>
              <p><code>setArtefacts</code> - passes the <strong>items</strong> argument object through to each of the Group’s artefact’s <code>set</code> function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">setArtefacts</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cascadeAction</span>(items, <span class="hljs-variable constant_">SET</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-58">&#x00a7;</a>
              </div>
              <p><code>updateByDelta</code> - passes the <strong>items</strong> argument object through to each of the Group’s artefact’s <code>updateByDelta</code> function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">updateByDelta</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cascadeAction</span>(<span class="hljs-literal">false</span>, <span class="hljs-variable constant_">UPDATE_BY_DELTA</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-59">&#x00a7;</a>
              </div>
              <p><code>reverseByDelta</code> - passes the <strong>items</strong> argument object through to each of the Group’s artefact’s <code>reverseByDelta</code> function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">reverseByDelta</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cascadeAction</span>(<span class="hljs-literal">false</span>, <span class="hljs-variable constant_">REVERSE_BY_DELTA</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-60">&#x00a7;</a>
              </div>
              <p><code>addArtefactClasses</code> - specifically for non-entity artefacts. Passes the <strong>items</strong> argument String through to each of the Group’s artefact’s <code>addClasses</code> function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">addArtefactClasses</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cascadeAction</span>(items, <span class="hljs-variable constant_">ADD_CLASSES</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-61">&#x00a7;</a>
              </div>
              <p><code>removeArtefactClasses</code> - specifically for non-entity artefacts. Passes the <strong>items</strong> argument String through to each of the Group’s artefact’s <code>removeClasses</code> function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">removeArtefactClasses</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cascadeAction</span>(items, <span class="hljs-variable constant_">REMOVE_CLASSES</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-62">&#x00a7;</a>
              </div>
              <p><code>cascadeAction</code> - internal helper function for the above artefact manipulation functionality</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">cascadeAction</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">items, action</span>) {

    <span class="hljs-keyword">let</span> art;

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">artefacts</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> {

        art = artefact[name];

        <span class="hljs-keyword">if</span>(art &amp;&amp; art[action]) art[action](items);
    });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-63">&#x00a7;</a>
              </div>
              <p><code>setDeltaValues</code> - passes the <strong>items</strong> argument object through to each of the Group’s artefact’s <code>setDeltaValues</code> function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">setDeltaValues</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">items = Ωempty</span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">artefactCalculateBuckets</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">art</span> =&gt;</span> art.<span class="hljs-title function_">setDeltaValues</span>(items));

    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-64">&#x00a7;</a>
              </div>
              <p>We can add and remove filters to each of the Group’s entity artefacts using the following functions. The argument for each function can be one or more Filter name-Strings, or the Filter objects themselves, separated by commas.</p>

            </div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-65">&#x00a7;</a>
              </div>
              <p><code>addFiltersToEntitys</code>
TODO: don’t think this is tested anywhere - build test!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">addFiltersToEntitys</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) {

    <span class="hljs-keyword">let</span> ent;

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">artefacts</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> {

        ent = entity[name];

        <span class="hljs-keyword">if</span> (ent &amp;&amp; ent.<span class="hljs-property">addFilters</span>) ent.<span class="hljs-title function_">addFilters</span>(args);
    });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-66">&#x00a7;</a>
              </div>
              <p><code>removeFiltersFromEntitys</code>
TODO: don’t think this is tested anywhere - build test!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">removeFiltersFromEntitys</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) {

    <span class="hljs-keyword">let</span> ent;

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">artefacts</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> {

        ent = entity[name];

        <span class="hljs-keyword">if</span> (ent &amp;&amp; ent.<span class="hljs-property">removeFilters</span>) ent.<span class="hljs-title function_">removeFilters</span>(args);
    });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-67">&#x00a7;</a>
              </div>
              <p><code>clearFiltersFromEntitys</code> - clears all filters from all the Group’s entity artefacts.
TODO: don’t think this is tested anywhere - build test!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">clearFiltersFromEntitys</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-keyword">let</span> ent;

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">artefacts</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> {

        ent = entity[name];

        <span class="hljs-keyword">if</span> (ent &amp;&amp; ent.<span class="hljs-property">clearFilters</span>) ent.<span class="hljs-title function_">clearFilters</span>();
    });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-68">&#x00a7;</a>
              </div>
              <h4 id="collision-functionality">Collision functionality</h4>
<p>The <code>getArtefactAt</code> function checks to see if any of the Group object’s artefacts are located at the supplied coordinates in the argument object.</p>
<p>The hit report from the first artefact to respond back positively (artefacts with the highest order value are checked first) will be returned by the function.</p>
<p>Where no artefacts are present at that coordinate the function returns false.</p>
<p>A <strong>hit report</strong> is a Javascript object with the following attributes:</p>
<ul>
<li><code>x</code> - the x coordinate supplied in this functions argument object</li>
<li><code>y</code> - the y coordinate supplied in this functions argument object</li>
<li><code>artefact</code> - the Scrawl-canvas artefact object reporting the hit</li>
</ul>
<p>This function forms part of the Scrawl-canvas library’s <strong>drag-and-drop</strong> functionality.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">getArtefactAt</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sortArtefacts</span>();

    <span class="hljs-keyword">const</span> myCell = <span class="hljs-title function_">requestCell</span>(),
        artBuckets = <span class="hljs-variable language_">this</span>.<span class="hljs-property">artefactStampBuckets</span>;

    <span class="hljs-keyword">let</span> art, result;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = artBuckets.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {

        art = artBuckets[i];

        <span class="hljs-keyword">if</span> (art) {

            result = art.<span class="hljs-title function_">checkHit</span>(items, myCell);

            <span class="hljs-keyword">if</span> (result) {

                <span class="hljs-title function_">releaseCell</span>(myCell);
                <span class="hljs-keyword">return</span> result;
            }
        }
    }
    <span class="hljs-title function_">releaseCell</span>(myCell);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-69">&#x00a7;</a>
              </div>
              <p>The <code>getAllArtefactsAt</code> function returns an array of hit reports from all of the Group object’s artefacts located at the supplied coordinates in the argument object. The artefact with the highest order attribute value will be returned first in the response array.</p>
<p>The function will always return an array of hit reports, or an empty array if no hits are reported.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">getAllArtefactsAt</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sortArtefacts</span>();

    <span class="hljs-keyword">const</span> myCell = <span class="hljs-title function_">requestCell</span>(),
        artBuckets = <span class="hljs-variable language_">this</span>.<span class="hljs-property">artefactStampBuckets</span>,
        resultNames = <span class="hljs-title function_">requestArray</span>(),
        results = [];

    <span class="hljs-keyword">let</span> art, result, hit;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = artBuckets.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {

        art = artBuckets[i];

        <span class="hljs-keyword">if</span> (art) {

            result = art.<span class="hljs-title function_">checkHit</span>(items, myCell);

            <span class="hljs-keyword">if</span> (result &amp;&amp; result.<span class="hljs-property">artefact</span>) {

                hit = result.<span class="hljs-property">artefact</span>;

                <span class="hljs-keyword">if</span> (!resultNames.<span class="hljs-title function_">includes</span>(hit.<span class="hljs-property">name</span>)) {

                    resultNames.<span class="hljs-title function_">push</span>(hit.<span class="hljs-property">name</span>);
                    results.<span class="hljs-title function_">push</span>(result);
                }
            }
        }
    }
    <span class="hljs-title function_">releaseCell</span>(myCell);
    <span class="hljs-title function_">releaseArray</span>(resultNames);

    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">checkForEntityHover</span>) {

        <span class="hljs-keyword">const</span> foundArtefacts = (results.<span class="hljs-property">length</span>) ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>,
            isHovering = <span class="hljs-variable language_">this</span>.<span class="hljs-property">isHovering</span>;

        <span class="hljs-keyword">if</span> (isHovering != foundArtefacts) {

            <span class="hljs-variable language_">this</span>.<span class="hljs-property">isHovering</span> = foundArtefacts;

            <span class="hljs-keyword">if</span> (foundArtefacts) <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onEntityHover</span>();
            <span class="hljs-keyword">else</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onEntityNoHover</span>();
        }
    }
    <span class="hljs-keyword">return</span> results;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-70">&#x00a7;</a>
              </div>
              <h4 id="factory">Factory</h4>
<pre><code><span class="hljs-keyword">let</span> faces = scrawl.<span class="hljs-title function_">makeGroup</span>({

    <span class="hljs-comment">// Unique name to keep track of the Group</span>
    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;faces&#x27;</span>,

    <span class="hljs-comment">// Groups generally associate with a primary controller (a Stack or Cell object)</span>
    <span class="hljs-attr">host</span>: <span class="hljs-string">&#x27;mystack&#x27;</span>,
});
</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> makeGroup = <span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) {

    <span class="hljs-keyword">if</span> (!items) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Group</span>(items);
};

constructors.<span class="hljs-property">Group</span> = <span class="hljs-title class_">Group</span>;</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
