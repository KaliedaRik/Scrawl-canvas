<!DOCTYPE html>

<html>
<head>
  <title>Stack factory</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="../core/animation-loop.html">
                  ./source/core/animation-loop.js
                </a>
              
                
                <a class="source" href="../core/display-cycle.html">
                  ./source/core/display-cycle.js
                </a>
              
                
                <a class="source" href="../core/document-root-elements.html">
                  ./source/core/document-root-elements.js
                </a>
              
                
                <a class="source" href="../core/document.html">
                  ./source/core/document.js
                </a>
              
                
                <a class="source" href="../core/events.html">
                  ./source/core/events.js
                </a>
              
                
                <a class="source" href="../core/init.html">
                  ./source/core/init.js
                </a>
              
                
                <a class="source" href="../core/library.html">
                  ./source/core/library.js
                </a>
              
                
                <a class="source" href="../core/random-seed.html">
                  ./source/core/random-seed.js
                </a>
              
                
                <a class="source" href="../core/shared-vars.html">
                  ./source/core/shared-vars.js
                </a>
              
                
                <a class="source" href="../core/snippets.html">
                  ./source/core/snippets.js
                </a>
              
                
                <a class="source" href="../core/system-flags.html">
                  ./source/core/system-flags.js
                </a>
              
                
                <a class="source" href="../core/user-interaction.html">
                  ./source/core/user-interaction.js
                </a>
              
                
                <a class="source" href="../core/utilities.html">
                  ./source/core/utilities.js
                </a>
              
                
                <a class="source" href="action.html">
                  ./source/factory/action.js
                </a>
              
                
                <a class="source" href="anchor.html">
                  ./source/factory/anchor.js
                </a>
              
                
                <a class="source" href="animation.html">
                  ./source/factory/animation.js
                </a>
              
                
                <a class="source" href="array-pool.html">
                  ./source/factory/array-pool.js
                </a>
              
                
                <a class="source" href="bezier.html">
                  ./source/factory/bezier.js
                </a>
              
                
                <a class="source" href="block.html">
                  ./source/factory/block.js
                </a>
              
                
                <a class="source" href="canvas.html">
                  ./source/factory/canvas.js
                </a>
              
                
                <a class="source" href="cell-fragment.html">
                  ./source/factory/cell-fragment.js
                </a>
              
                
                <a class="source" href="cell.html">
                  ./source/factory/cell.js
                </a>
              
                
                <a class="source" href="cog.html">
                  ./source/factory/cog.js
                </a>
              
                
                <a class="source" href="color.html">
                  ./source/factory/color.js
                </a>
              
                
                <a class="source" href="conic-gradient.html">
                  ./source/factory/conic-gradient.js
                </a>
              
                
                <a class="source" href="coordinate.html">
                  ./source/factory/coordinate.js
                </a>
              
                
                <a class="source" href="crescent.html">
                  ./source/factory/crescent.js
                </a>
              
                
                <a class="source" href="drag-zone.html">
                  ./source/factory/drag-zone.js
                </a>
              
                
                <a class="source" href="element.html">
                  ./source/factory/element.js
                </a>
              
                
                <a class="source" href="emitter.html">
                  ./source/factory/emitter.js
                </a>
              
                
                <a class="source" href="filter-engine-bluenoise-data.html">
                  ./source/factory/filter-engine-bluenoise-data.js
                </a>
              
                
                <a class="source" href="filter-engine.html">
                  ./source/factory/filter-engine.js
                </a>
              
                
                <a class="source" href="filter.html">
                  ./source/factory/filter.js
                </a>
              
                
                <a class="source" href="font-attributes.html">
                  ./source/factory/font-attributes.js
                </a>
              
                
                <a class="source" href="gradient.html">
                  ./source/factory/gradient.js
                </a>
              
                
                <a class="source" href="grid.html">
                  ./source/factory/grid.js
                </a>
              
                
                <a class="source" href="group.html">
                  ./source/factory/group.js
                </a>
              
                
                <a class="source" href="image-asset.html">
                  ./source/factory/image-asset.js
                </a>
              
                
                <a class="source" href="keyboard-zone.html">
                  ./source/factory/keyboard-zone.js
                </a>
              
                
                <a class="source" href="line-spiral.html">
                  ./source/factory/line-spiral.js
                </a>
              
                
                <a class="source" href="line.html">
                  ./source/factory/line.js
                </a>
              
                
                <a class="source" href="loom.html">
                  ./source/factory/loom.js
                </a>
              
                
                <a class="source" href="mesh.html">
                  ./source/factory/mesh.js
                </a>
              
                
                <a class="source" href="net.html">
                  ./source/factory/net.js
                </a>
              
                
                <a class="source" href="noise-asset.html">
                  ./source/factory/noise-asset.js
                </a>
              
                
                <a class="source" href="observe-update.html">
                  ./source/factory/observe-update.js
                </a>
              
                
                <a class="source" href="oval.html">
                  ./source/factory/oval.js
                </a>
              
                
                <a class="source" href="palette.html">
                  ./source/factory/palette.js
                </a>
              
                
                <a class="source" href="particle-force.html">
                  ./source/factory/particle-force.js
                </a>
              
                
                <a class="source" href="particle-history.html">
                  ./source/factory/particle-history.js
                </a>
              
                
                <a class="source" href="particle-spring.html">
                  ./source/factory/particle-spring.js
                </a>
              
                
                <a class="source" href="particle-world.html">
                  ./source/factory/particle-world.js
                </a>
              
                
                <a class="source" href="particle.html">
                  ./source/factory/particle.js
                </a>
              
                
                <a class="source" href="pattern.html">
                  ./source/factory/pattern.js
                </a>
              
                
                <a class="source" href="phrase.html">
                  ./source/factory/phrase.js
                </a>
              
                
                <a class="source" href="picture.html">
                  ./source/factory/picture.js
                </a>
              
                
                <a class="source" href="polygon.html">
                  ./source/factory/polygon.js
                </a>
              
                
                <a class="source" href="polyline.html">
                  ./source/factory/polyline.js
                </a>
              
                
                <a class="source" href="quadratic.html">
                  ./source/factory/quadratic.js
                </a>
              
                
                <a class="source" href="quaternion.html">
                  ./source/factory/quaternion.js
                </a>
              
                
                <a class="source" href="radial-gradient.html">
                  ./source/factory/radial-gradient.js
                </a>
              
                
                <a class="source" href="raw-asset.html">
                  ./source/factory/raw-asset.js
                </a>
              
                
                <a class="source" href="reaction-diffusion-asset.html">
                  ./source/factory/reaction-diffusion-asset.js
                </a>
              
                
                <a class="source" href="rectangle.html">
                  ./source/factory/rectangle.js
                </a>
              
                
                <a class="source" href="render-animation.html">
                  ./source/factory/render-animation.js
                </a>
              
                
                <a class="source" href="shape.html">
                  ./source/factory/shape.js
                </a>
              
                
                <a class="source" href="spiral.html">
                  ./source/factory/spiral.js
                </a>
              
                
                <a class="source" href="sprite-asset.html">
                  ./source/factory/sprite-asset.js
                </a>
              
                
                <a class="source" href="stack.html">
                  ./source/factory/stack.js
                </a>
              
                
                <a class="source" href="star.html">
                  ./source/factory/star.js
                </a>
              
                
                <a class="source" href="state.html">
                  ./source/factory/state.js
                </a>
              
                
                <a class="source" href="tetragon.html">
                  ./source/factory/tetragon.js
                </a>
              
                
                <a class="source" href="ticker.html">
                  ./source/factory/ticker.js
                </a>
              
                
                <a class="source" href="tracer.html">
                  ./source/factory/tracer.js
                </a>
              
                
                <a class="source" href="tween.html">
                  ./source/factory/tween.js
                </a>
              
                
                <a class="source" href="unstacked-element.html">
                  ./source/factory/unstacked-element.js
                </a>
              
                
                <a class="source" href="vector.html">
                  ./source/factory/vector.js
                </a>
              
                
                <a class="source" href="video-asset.html">
                  ./source/factory/video-asset.js
                </a>
              
                
                <a class="source" href="wheel.html">
                  ./source/factory/wheel.js
                </a>
              
                
                <a class="source" href="../mixin/anchor.html">
                  ./source/mixin/anchor.js
                </a>
              
                
                <a class="source" href="../mixin/asset-advanced-functionality.html">
                  ./source/mixin/asset-advanced-functionality.js
                </a>
              
                
                <a class="source" href="../mixin/asset-consumer.html">
                  ./source/mixin/asset-consumer.js
                </a>
              
                
                <a class="source" href="../mixin/asset.html">
                  ./source/mixin/asset.js
                </a>
              
                
                <a class="source" href="../mixin/base.html">
                  ./source/mixin/base.js
                </a>
              
                
                <a class="source" href="../mixin/cascade.html">
                  ./source/mixin/cascade.js
                </a>
              
                
                <a class="source" href="../mixin/cell-key-functions.html">
                  ./source/mixin/cell-key-functions.js
                </a>
              
                
                <a class="source" href="../mixin/delta.html">
                  ./source/mixin/delta.js
                </a>
              
                
                <a class="source" href="../mixin/display-shape.html">
                  ./source/mixin/display-shape.js
                </a>
              
                
                <a class="source" href="../mixin/dom.html">
                  ./source/mixin/dom.js
                </a>
              
                
                <a class="source" href="../mixin/entity.html">
                  ./source/mixin/entity.js
                </a>
              
                
                <a class="source" href="../mixin/filter.html">
                  ./source/mixin/filter.js
                </a>
              
                
                <a class="source" href="../mixin/mimic.html">
                  ./source/mixin/mimic.js
                </a>
              
                
                <a class="source" href="../mixin/path.html">
                  ./source/mixin/path.js
                </a>
              
                
                <a class="source" href="../mixin/pattern.html">
                  ./source/mixin/pattern.js
                </a>
              
                
                <a class="source" href="../mixin/pivot.html">
                  ./source/mixin/pivot.js
                </a>
              
                
                <a class="source" href="../mixin/position.html">
                  ./source/mixin/position.js
                </a>
              
                
                <a class="source" href="../mixin/shape-basic.html">
                  ./source/mixin/shape-basic.js
                </a>
              
                
                <a class="source" href="../mixin/shape-curve.html">
                  ./source/mixin/shape-curve.js
                </a>
              
                
                <a class="source" href="../mixin/shape-path-calculation.html">
                  ./source/mixin/shape-path-calculation.js
                </a>
              
                
                <a class="source" href="../mixin/styles.html">
                  ./source/mixin/styles.js
                </a>
              
                
                <a class="source" href="../mixin/tween.html">
                  ./source/mixin/tween.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-1">&#x00a7;</a>
              </div>
              <h1 id="stack-factory">Stack factory</h1>
<p>The Scrawl-canvas Stack/Element system is an attempt to supplement DOM elements with Scrawl-canvas entity positioning and dimensioning functionality.</p>
<ul>
<li>Entitys exist in a Cell environment</li>
<li>They can position themselves within that Cell either <strong>absolutely</strong> (px coordinates), or <strong>relatively</strong> (% coordinates, with values relative to the Cell’s dimensions), or <strong>by reference</strong> (using other entity’s coordinates to calculate their own coordinates - <code>pivot</code>, <code>mimic</code>, <code>path</code>)</li>
<li>They can also base their dimensions on absolute (px) or relative (%) values</li>
<li>They can be <strong>animated</strong> directly (<code>set</code>, <code>deltaSet</code>), or through automation (<code>delta</code> object), or through the Scrawl-canvas <code>tween</code> functionality</li>
<li>They can be stored and retrieved (‘packet’ functionality), cloned (‘clone’, based on packets) and killed (‘kill’ functions)</li>
</ul>
<p><strong>A Stack is a wrapper object around a DOM element</strong>, whose direct children are given Scrawl-canvas Element wrappers:</p>
<pre><code><span class="hljs-title class_">Stack</span>    ~~&gt; <span class="hljs-title class_">Canvas</span>/<span class="hljs-title class_">Cell</span>  
<span class="hljs-title class_">Element</span>  ~~&gt; <span class="hljs-title class_">Entity</span> (eg <span class="hljs-title class_">Block</span>)  
</code></pre>
<p>During initialization Scrawl-canvas will search the DOM tree and automatically create Stack wrappers for any element which has been given a <code>data-scrawl-stack</code> attribute which resolves to true. Every direct (first level) child inside the stack element will have Element wrappers created for them (except for &lt;canvas&gt; elements). As part of this work, Scrawl-canvas will modify the affected elements’ <code>position</code> CSS style:</p>
<ul>
<li>Stack elements have <code>relative</code> positioning within the DOM</li>
<li>Element elements have <code>absolute</code> positioning within the Stack</li>
</ul>
<p>The Stack factory is not used directly; the factory is not exported as part of the <strong>scrawl object</strong> during Scrawl-canvas initialization. Instead, wrappers can be created for a DOM-based &lt;div&gt; element using the following scrawl function:</p>
<ul>
<li><code>scrawl.addStack</code> - generates a new &lt;div&gt; element, creates a wrapper for it, then adds it to the DOM.</li>
</ul>
<p>Stack wrapper objects use the <strong>base</strong>, <strong>position</strong>, <strong>anchor</strong>, <strong>cascade</strong> and <strong>dom</strong> mixins. Thus Stack wrappers are also <strong>artefact</strong> objects: if a Stack’s DOM element is a direct child of another Stack wrapper’s element then it can be positioned, dimensioned and rotated like any other artefact.</p>
<p>By default, all Stack wrappers will track mouse/touch movements across their DOM element, supplying this data to constituent Canvas objects and artefacts as-and-when-required.</p>
<p>Stack wrappers are used by Scrawl-canvas to invoke the <strong>Display cycle cascade</strong>. As such, they include <code>clear</code>, <code>compile</code>, <code>show</code> and <code>render</code> functions to manage the Display cycle. These functions are asynchronous, returning Promises.</p>
<p>Stack wrappers are excluded from the Scrawl-canvas packet system; they cannot be saved or cloned. Killing a Stack wrapper will remove its DOM element from the document - <strong>including all Elements and Canvases that it contains</strong>.</p>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-2">&#x00a7;</a>
              </div>
              <h4 id="demos">Demos:</h4>
<ul>
<li>All stack demos include Stack wrapper functionality - most of which happens behind the scenes and does not need to be directly coded. </li>
<li><a href="../../demo/dom-001.html">DOM-001</a> - Loading the scrawl-canvas library using a script tag in the HTML code</li>
<li><a href="../../demo/dom-003.html">DOM-003</a> - Dynamically create and clone Element artefacts; drag and drop elements (including SVG elements) around a Stack</li>
<li><a href="../../demo/dom-010.html">DOM-010</a> - Add and remove (kill) Scrawl-canvas Stack elements programmatically</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-3">&#x00a7;</a>
              </div>
              <h4 id="imports">Imports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { artefact, canvas, constructors, element, group, purge, stack } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/library.js&#x27;</span>;

<span class="hljs-keyword">import</span> { addStrings, doCreate, isa_canvas, isa_dom, mergeOver, pushUnique, removeItem, xt, λ<span class="hljs-literal">null</span>, λ<span class="hljs-variable language_">this</span>, Ωempty } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/utilities.js&#x27;</span>;

<span class="hljs-keyword">import</span> { domShow } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/document.js&#x27;</span>;

<span class="hljs-keyword">import</span> { rootElementsAdd, rootElementsIncludes, rootElementsRemove } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../core/document-root-elements.js&quot;</span>;

<span class="hljs-keyword">import</span> { currentCorePosition, uiSubscribedElements } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/user-interaction.js&#x27;</span>;

<span class="hljs-keyword">import</span> { makeGroup } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./group.js&#x27;</span>;
<span class="hljs-keyword">import</span> { makeElement } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./element.js&#x27;</span>;
<span class="hljs-keyword">import</span> { makeCoordinate } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./coordinate.js&#x27;</span>;

<span class="hljs-keyword">import</span> baseMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/base.js&#x27;</span>;
<span class="hljs-keyword">import</span> cascadeMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/cascade.js&#x27;</span>;
<span class="hljs-keyword">import</span> domMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/dom.js&#x27;</span>;
<span class="hljs-keyword">import</span> displayMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/display-shape.js&#x27;</span>;

<span class="hljs-keyword">import</span> { $DATA_SCRAWL_STACK, $SCRIPT, _computed, _entries, _isArray, <span class="hljs-variable constant_">ABSOLUTE</span>, <span class="hljs-variable constant_">BORDER_BOX</span>, <span class="hljs-variable constant_">DATA_SCRAWL_GROUP</span>, <span class="hljs-variable constant_">DATA_SCRAWL_STACK</span>, <span class="hljs-variable constant_">DIV</span>, <span class="hljs-variable constant_">NAME</span>, <span class="hljs-title class_">PC50</span>, <span class="hljs-variable constant_">RELATIVE</span>, <span class="hljs-variable constant_">ROOT</span>, <span class="hljs-variable constant_">STACK</span>, <span class="hljs-variable constant_">SUBSCRIBE</span>, <span class="hljs-variable constant_">T_STACK</span>, <span class="hljs-variable constant_">ZERO_STR</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/shared-vars.js&#x27;</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-4">&#x00a7;</a>
              </div>
              <h4 id="stack-constructor">Stack constructor</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> <span class="hljs-title class_">Stack</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">items = Ωempty</span>) {

    <span class="hljs-keyword">let</span> g, el;

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">makeName</span>(items.<span class="hljs-property">name</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">register</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initializePositions</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initializeCascade</span>();

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dimensions</span>[<span class="hljs-number">0</span>] = <span class="hljs-number">300</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dimensions</span>[<span class="hljs-number">1</span>] = <span class="hljs-number">150</span>;

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pathCorners</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">css</span> = {};
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">here</span> = {};
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">perspective</span> = {

        <span class="hljs-attr">x</span>: <span class="hljs-title class_">PC50</span>,
        <span class="hljs-attr">y</span>: <span class="hljs-title class_">PC50</span>,
        <span class="hljs-attr">z</span>: <span class="hljs-number">0</span>
    };
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyPerspective</span> = <span class="hljs-literal">true</span>;

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initializeDomLayout</span>(items);

    g = <span class="hljs-title function_">makeGroup</span>({
        <span class="hljs-attr">name</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>,
        <span class="hljs-attr">host</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>
    });
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addGroups</span>(g.<span class="hljs-property">name</span>);

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">set</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">defs</span>);

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initializeDisplayShapeActions</span>();

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initializeAccessibility</span>();

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">set</span>(items);

    el = <span class="hljs-variable language_">this</span>.<span class="hljs-property">domElement</span>;

    <span class="hljs-keyword">if</span> (el) {

        <span class="hljs-keyword">const</span> ds = el.<span class="hljs-property">dataset</span>;

        <span class="hljs-keyword">if</span> (ds.<span class="hljs-property">isResponsive</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-property">isResponsive</span> = <span class="hljs-literal">true</span>;

        <span class="hljs-keyword">if</span> (el.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-variable constant_">DATA_SCRAWL_GROUP</span>) == <span class="hljs-variable constant_">ROOT</span>) <span class="hljs-title function_">rootElementsAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-5">&#x00a7;</a>
              </div>
              <h4 id="stack-prototype">Stack prototype</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> P = <span class="hljs-title class_">Stack</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title function_">doCreate</span>();
P.<span class="hljs-property">type</span> = <span class="hljs-variable constant_">T_STACK</span>;
P.<span class="hljs-property">lib</span> = <span class="hljs-variable constant_">STACK</span>;
P.<span class="hljs-property">isArtefact</span> = <span class="hljs-literal">true</span>;
P.<span class="hljs-property">isAsset</span> = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-6">&#x00a7;</a>
              </div>
              <h4 id="mixins">Mixins</h4>
<ul>
<li><a href="../mixin/base.html">base</a></li>
<li><a href="../mixin/cascade.html">cascade</a></li>
<li><a href="../mixin/dom.html">dom</a></li>
<li><a href="../mixin/displayShape.html">display</a></li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-title function_">baseMix</span>(P);
<span class="hljs-title function_">cascadeMix</span>(P);
<span class="hljs-title function_">domMix</span>(P);
<span class="hljs-title function_">displayMix</span>(P);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-7">&#x00a7;</a>
              </div>
              <h4 id="stack-attributes">Stack attributes</h4>
<ul>
<li>Attributes defined in the <a href="../mixin/base.html">base mixin</a>: <strong>name</strong>.</li>
<li>Attributes defined in the <a href="../mixin/position.html">position mixin</a>: <strong>group, visibility, order, calculateOrder, stampOrder, start, <em>startX</em>, <em>startY</em>, handle, <em>handleX</em>, <em>handleY</em>, offset, <em>offsetX</em>, <em>offsetY</em>, dimensions, <em>width</em>, <em>height</em>, pivoted, mimicked, lockTo, <em>lockXTo</em>, <em>lockYTo</em>, scale, roll, noUserInteraction, noPositionDependencies, noCanvasEngineUpdates, noFilters, noPathUpdates, purge, bringToFrontOnDrag</strong>.</li>
<li>Attributes defined in the <a href="../mixin/delta.html">delta mixin</a>: <strong>delta, noDeltaUpdates</strong>.</li>
<li>Attributes defined in the <a href="../mixin/pivot.html">pivot mixin</a>: <strong>pivot, pivotCorner, addPivotHandle, addPivotOffset, addPivotRotation</strong>.</li>
<li>Attributes defined in the <a href="../mixin/mimic.html">mimic mixin</a>: <strong>mimic, useMimicDimensions, useMimicScale, useMimicStart, useMimicHandle, useMimicOffset, useMimicRotation, useMimicFlip, addOwnDimensionsToMimic, addOwnScaleToMimic, addOwnStartToMimic, addOwnHandleToMimic, addOwnOffsetToMimic, addOwnRotationToMimic</strong>.</li>
<li>Attributes defined in the <a href="../mixin/path.html">path mixin</a>: <strong>path, pathPosition, addPathHandle, addPathOffset, addPathRotation, constantPathSpeed</strong>.</li>
<li>Attributes defined in the <a href="../mixin/anchor.html">anchor mixin</a>: <strong>anchor</strong>.</li>
<li>Attributes defined in the <a href="../mixin/cascade.html">cascade mixin</a>: <strong>groups</strong>.</li>
<li>Attributes defined in the <a href="../mixin/dom.html">dom mixin</a>: <strong>domElement, pitch, yaw, offsetZ, css, classes, position, actionResize, trackHere, domAttributes</strong>.</li>
<li>Attributes defined in the <a href="../mixin/displayShape.html">display mixin</a>: <strong>breakToBanner, breakToLandscape, breakToPortrait, breakToSkyscraper, actionBannerShape, actionLandscapeShape, actionRectangleShape, actionPortraitShape, actionSkyscraperShape</strong>.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> defaultAttributes = {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-8">&#x00a7;</a>
              </div>
              <p><strong>position</strong>, <strong>perspective</strong> - while most of the Stack wrapper’s DOM element’s attributes are handled through CSS, Scrawl-canvas takes control of some positioning-related attributes. Most of these are defined in the <a href="../mixin/dom.html">dom mixin</a> - but the position and perspective attributes are managed in this module</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">position</span>: <span class="hljs-variable constant_">RELATIVE</span>,
    <span class="hljs-attr">perspective</span>: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-9">&#x00a7;</a>
              </div>
              <p><strong>trackHere</strong> </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">trackHere</span>: <span class="hljs-variable constant_">SUBSCRIBE</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-10">&#x00a7;</a>
              </div>
              <p>TODO: This is all about a mad idea we may have for making stacks ‘responsive’ to viewport changes. It needs a lot more thinking through. Search on ‘isResponsive’ to find the relevant function below</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">isResponsive</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">containElementsInHeight</span>: <span class="hljs-literal">false</span>,
};
P.<span class="hljs-property">defs</span> = <span class="hljs-title function_">mergeOver</span>(P.<span class="hljs-property">defs</span>, defaultAttributes);</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-11">&#x00a7;</a>
              </div>
              <h4 id="packetclone-management">Packet/Clone management</h4>
<p>This functionality is disabled for Stack objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">stringifyFunction</span> = λ<span class="hljs-literal">null</span>;
P.<span class="hljs-property">processPacketOut</span> = λ<span class="hljs-literal">null</span>;
P.<span class="hljs-property">finalizePacketOut</span> = λ<span class="hljs-literal">null</span>;
P.<span class="hljs-property">saveAsPacket</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-keyword">return</span> <span class="hljs-string">`[<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.type}</span>, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.lib}</span>, {}]`</span>
};
P.<span class="hljs-property">clone</span> = λ<span class="hljs-variable language_">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-12">&#x00a7;</a>
              </div>
              <h4 id="kill-functionality">Kill functionality</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">factoryKill</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-keyword">let</span> myname = <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-13">&#x00a7;</a>
              </div>
              <p>rootElements and uiSubscribedElements arrays</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-title function_">rootElementsRemove</span>(myname);
    <span class="hljs-title function_">removeItem</span>(uiSubscribedElements, myname);</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-14">&#x00a7;</a>
              </div>
              <p>Groups</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (group[myname]) group[myname].<span class="hljs-title function_">kill</span>();

    <span class="hljs-title function_">_entries</span>(artefact).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">[name, art]</span>) =&gt;</span> {

        <span class="hljs-keyword">if</span> (art.<span class="hljs-property">host</span> === myname) art.<span class="hljs-title function_">kill</span>();
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-15">&#x00a7;</a>
              </div>
              <p>DOM removals</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">domElement</span>.<span class="hljs-title function_">remove</span>();
}</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-16">&#x00a7;</a>
              </div>
              <h4 id="get-set-deltaset">Get, Set, deltaSet</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> G = P.<span class="hljs-property">getters</span>,
    S = P.<span class="hljs-property">setters</span>,
    D = P.<span class="hljs-property">deltaSetters</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-17">&#x00a7;</a>
              </div>
              <p>Similar to start, handle, dimensions, etc Scrawl-canvas supplies some pseudo-attributes to help set and manage the Stack wrapper’s <code>perspective</code> object:</p>
<ul>
<li><code>perspectiveX</code></li>
<li><code>perspectiveY</code></li>
<li><code>perspectiveZ</code></li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>G.<span class="hljs-property">perspectiveX</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">perspective</span>.<span class="hljs-property">x</span>;
};
G.<span class="hljs-property">perspectiveY</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">perspective</span>.<span class="hljs-property">y</span>;
};
G.<span class="hljs-property">perspectiveZ</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">perspective</span>.<span class="hljs-property">z</span>;
};

S.<span class="hljs-property">perspectiveX</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">perspective</span>.<span class="hljs-property">x</span> = item;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyPerspective</span> = <span class="hljs-literal">true</span>;
};
S.<span class="hljs-property">perspectiveY</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">perspective</span>.<span class="hljs-property">y</span> = item;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyPerspective</span> = <span class="hljs-literal">true</span>;
};
S.<span class="hljs-property">perspectiveZ</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">perspective</span>.<span class="hljs-property">z</span> = item;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyPerspective</span> = <span class="hljs-literal">true</span>;
};
S.<span class="hljs-property">perspective</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item = Ωempty</span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">perspective</span>.<span class="hljs-property">x</span> = (<span class="hljs-title function_">xt</span>(item.<span class="hljs-property">x</span>)) ? item.<span class="hljs-property">x</span> : <span class="hljs-variable language_">this</span>.<span class="hljs-property">perspective</span>.<span class="hljs-property">x</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">perspective</span>.<span class="hljs-property">y</span> = (<span class="hljs-title function_">xt</span>(item.<span class="hljs-property">y</span>)) ? item.<span class="hljs-property">y</span> : <span class="hljs-variable language_">this</span>.<span class="hljs-property">perspective</span>.<span class="hljs-property">y</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">perspective</span>.<span class="hljs-property">z</span> = (<span class="hljs-title function_">xt</span>(item.<span class="hljs-property">z</span>)) ? item.<span class="hljs-property">z</span> : <span class="hljs-variable language_">this</span>.<span class="hljs-property">perspective</span>.<span class="hljs-property">z</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyPerspective</span> = <span class="hljs-literal">true</span>;
};
D.<span class="hljs-property">perspectiveX</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">perspective</span>.<span class="hljs-property">x</span> = <span class="hljs-title function_">addStrings</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">perspective</span>.<span class="hljs-property">x</span>, item);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyPerspective</span> = <span class="hljs-literal">true</span>;
};
D.<span class="hljs-property">perspectiveY</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">perspective</span>.<span class="hljs-property">y</span> = <span class="hljs-title function_">addStrings</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">perspective</span>.<span class="hljs-property">y</span>, item);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyPerspective</span> = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-18">&#x00a7;</a>
              </div>
              <p><code>group</code> - get the Stack’s namesake group</p>
<ul>
<li>Note that Stack wrappers can action more than one group</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>G.<span class="hljs-property">group</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-keyword">return</span> group[<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>];
};</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-19">&#x00a7;</a>
              </div>
              <h4 id="prototype-functions">Prototype functions</h4>

            </div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-20">&#x00a7;</a>
              </div>
              <p><code>updateArtefacts</code> - internal function. Iterate through all Element and Canvas wrappers associated with the Stack wrapper’s Group object and set a range of dirty flags on them, for future processing by each as appropriate.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">updateArtefacts</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">items = Ωempty</span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">groupBuckets</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">grp</span> =&gt;</span> {

        grp.<span class="hljs-property">artefactCalculateBuckets</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">art</span> =&gt;</span> {

            <span class="hljs-keyword">if</span> (items.<span class="hljs-property">dirtyScale</span>) art.<span class="hljs-property">dirtyScale</span> = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.<span class="hljs-property">dirtyDimensions</span>) art.<span class="hljs-property">dirtyDimensions</span> = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.<span class="hljs-property">dirtyLock</span>) art.<span class="hljs-property">dirtyLock</span> = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.<span class="hljs-property">dirtyStart</span>) art.<span class="hljs-property">dirtyStart</span> = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.<span class="hljs-property">dirtyOffset</span>) art.<span class="hljs-property">dirtyOffset</span> = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.<span class="hljs-property">dirtyHandle</span>) art.<span class="hljs-property">dirtyHandle</span> = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.<span class="hljs-property">dirtyRotation</span>) art.<span class="hljs-property">dirtyRotation</span> = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.<span class="hljs-property">dirtyPathObject</span>) art.<span class="hljs-property">dirtyPathObject</span> = <span class="hljs-literal">true</span>;
        })
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-21">&#x00a7;</a>
              </div>
              <p><code>cleanDimensionsAdditionalActions</code> - overwrites mixin/position function. Promulgates Stack dimension changes through to all Element and Canvas wrappers associated with the Stack wrapper’s Group object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">cleanDimensionsAdditionalActions</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">groupBuckets</span>) {

        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateArtefacts</span>({
            <span class="hljs-attr">dirtyDimensions</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">dirtyPath</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">dirtyStart</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">dirtyHandle</span>: <span class="hljs-literal">true</span>,
        });
    }

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyDomDimensions</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyPath</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyStart</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyHandle</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyDisplayShape</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyDisplayArea</span> = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-22">&#x00a7;</a>
              </div>
              <p><code>cleanPerspective</code> - internal function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">cleanPerspective</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyPerspective</span> = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">let</span> p = <span class="hljs-variable language_">this</span>.<span class="hljs-property">perspective</span>;

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">domPerspectiveString</span> = <span class="hljs-string">`perspective-origin: <span class="hljs-subst">${p.x}</span> <span class="hljs-subst">${p.y}</span>; perspective: <span class="hljs-subst">${p.z}</span>px;`</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">domShowRequired</span> = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">groupBuckets</span>) {

        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateArtefacts</span>({
            <span class="hljs-attr">dirtyHandle</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">dirtyPathObject</span>: <span class="hljs-literal">true</span>,
        });
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-23">&#x00a7;</a>
              </div>
              <p>TODO - experimental! <code>checkResponsive</code></p>
<p>Scrawl-canvas Stack artefacts - at the <strong>root</strong> level - cannot have ‘String%’ dimensions, which means they have absolute dimensions - because everything that relies on ‘String%’ dimensions needs an absolute (number) value for their calculations at the root, which is the stack. </p>
<p>But we still need to make Stacks responsive. We do this by checking if the viewport dimensions have changed (a resize action has taken place) and - if yes - update the stack’s absolute dimensions accordingly … if the <strong>isResponsive</strong> flag has been set to true for the Stack (default is ‘false’ - may change this in due course).</p>
<p>We call this check in the <strong>clear</strong> function below, because it’s doing nothing else useful at the moment and it makes sense to get updates in place here before everything launches into the compile part of the display cycle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">checkResponsive</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isResponsive</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">trackHere</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-24">&#x00a7;</a>
              </div>
              <p>Start keeping track of the viewport dimensions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentVportWidth</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentVportWidth</span> = currentCorePosition.<span class="hljs-property">w</span>;
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentVportHeight</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentVportHeight</span> = currentCorePosition.<span class="hljs-property">h</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-25">&#x00a7;</a>
              </div>
              <p>If last display cycle responded to dimension changes, need to finalise height now</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyHeight</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">containElementsInHeight</span>) {

            <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyHeight</span> = <span class="hljs-literal">false</span>;
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentVportWidth</span> !== currentCorePosition.<span class="hljs-property">w</span>) {

            <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentVportWidth</span> = currentCorePosition.<span class="hljs-property">w</span>;

            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">containElementsInHeight</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-26">&#x00a7;</a>
              </div>
              <p>Won’t be updated until the next display cycle, but flag it now for action</p>
<ul>
<li>needed because text in elements flow as part of normal DOM operations</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirtyHeight</span> = <span class="hljs-literal">true</span>;
            }
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentVportHeight</span> !== currentCorePosition.<span class="hljs-property">h</span>) {

            <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentVportHeight</span> = currentCorePosition.<span class="hljs-property">h</span>;
        }
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-27">&#x00a7;</a>
              </div>
              <h5 id="display-cycle-functions">Display cycle functions</h5>

            </div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-28">&#x00a7;</a>
              </div>
              <p><code>clear</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">clear</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">checkResponsive</span>();
};</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-29">&#x00a7;</a>
              </div>
              <p><code>compile</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">compile</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sortGroups</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">prepareStamp</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">stamp</span>();

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">groupBuckets</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">mygroup</span> =&gt;</span> mygroup.<span class="hljs-title function_">stamp</span>());
};</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-30">&#x00a7;</a>
              </div>
              <p><code>show</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">show</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-title function_">domShow</span>();
};</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-31">&#x00a7;</a>
              </div>
              <p><code>render</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">render</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">compile</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">show</span>();
};</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-32">&#x00a7;</a>
              </div>
              <p><code>addExistingDomElements</code> - argument is a CSS query search String. All elements in the DOM matching the search will be <strong>moved</strong> into the Stack wrapper’s DOM element and given Scrawl-canvas Element wrappers. While Scrawl-canvas will try its best to respect the elements’ CSS attributes, they will be <strong>positioned absolutely</strong> within the Stack and given start, handle and offset values of <code>[0, 0]</code>. </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">addExistingDomElements</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">search</span>) {

    <span class="hljs-keyword">let</span> elements, el, captured, i, iz;

    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">xt</span>(search)) {

        elements = (search.<span class="hljs-property">substring</span>) ? <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(search) : [].<span class="hljs-title function_">concat</span>(search);

        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = elements.<span class="hljs-property">length</span>; i &lt; iz; i++) {

            el = elements[i];
            
            <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isa_dom</span>(el)) {

                captured = <span class="hljs-title function_">makeElement</span>({
                    <span class="hljs-attr">name</span>: el.<span class="hljs-property">id</span> || el.<span class="hljs-property">name</span>,
                    <span class="hljs-attr">domElement</span>: el,
                    <span class="hljs-attr">group</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>,
                    <span class="hljs-attr">host</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>,
                    <span class="hljs-attr">position</span>: <span class="hljs-variable constant_">ABSOLUTE</span>,
                    <span class="hljs-attr">setInitialDimensions</span>: <span class="hljs-literal">true</span>,
                });

                <span class="hljs-keyword">if</span> (captured &amp;&amp; captured.<span class="hljs-property">domElement</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-property">domElement</span>.<span class="hljs-title function_">appendChild</span>(captured.<span class="hljs-property">domElement</span>);
            }
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-33">&#x00a7;</a>
              </div>
              <p><code>addNewElement</code> - takes an ‘items’ object as an argument. The only required attribute of the argument is <strong>tag</strong>, which determines the type of element that will be created (for example - setting tag to ‘div’ will create a new &lt;div&gt; element)</p>
<ul>
<li>Any other Element artefact attribute can also be included in the argument object, including <strong>text</strong> and <strong>content</strong> attributes to set the new DOM Element’s textContent and innerHTML attributes.</li>
<li>If position and dimension values are not included in the argument, the element will be given default values of [0,0] for start, offset and handle; and dimensions of 100px width and height.</li>
<li>The new element will also default to a CSS box-sizing style value of ‘border-box’, unless the argument’s <strong>boxSizing</strong> attribute has been set to ‘content-box’ - this will override any ‘borderBox’ attribute value in the argument’s <strong>.css</strong> object (if one has been included)</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.<span class="hljs-property">addNewElement</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) {

    <span class="hljs-keyword">if</span> (items &amp;&amp; items.<span class="hljs-property">tag</span>) {

        items.<span class="hljs-property">domElement</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(items.<span class="hljs-property">tag</span>);
        items.<span class="hljs-property">domElement</span>.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-variable constant_">DATA_SCRAWL_GROUP</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">xt</span>(items.<span class="hljs-property">group</span>)) items.<span class="hljs-property">group</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>;
        items.<span class="hljs-property">host</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>;

        <span class="hljs-keyword">if</span> (!items.<span class="hljs-property">position</span>) items.<span class="hljs-property">position</span> = <span class="hljs-variable constant_">ABSOLUTE</span>;

        <span class="hljs-keyword">if</span> (items.<span class="hljs-property">dimensions</span> &amp;&amp; <span class="hljs-title function_">_isArray</span>(items.<span class="hljs-property">dimensions</span>)) {

            items.<span class="hljs-property">width</span> = items.<span class="hljs-property">dimensions</span>[<span class="hljs-number">0</span>] || <span class="hljs-number">100</span>;
            items.<span class="hljs-property">height</span> = items.<span class="hljs-property">dimensions</span>[<span class="hljs-number">1</span>] || <span class="hljs-number">100</span>;
        }

        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">xt</span>(items.<span class="hljs-property">width</span>)) items.<span class="hljs-property">width</span> = <span class="hljs-number">100</span>;
        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">xt</span>(items.<span class="hljs-property">height</span>)) items.<span class="hljs-property">height</span> = <span class="hljs-number">100</span>;

        <span class="hljs-keyword">const</span> myElement = <span class="hljs-title function_">makeElement</span>(items);

        <span class="hljs-keyword">if</span> (myElement &amp;&amp; myElement.<span class="hljs-property">domElement</span>) {

            <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">xt</span>(items.<span class="hljs-property">boxSizing</span>)) myElement.<span class="hljs-property">domElement</span>.<span class="hljs-property">style</span>.<span class="hljs-property">boxSizing</span> = <span class="hljs-variable constant_">BORDER_BOX</span>;

            <span class="hljs-variable language_">this</span>.<span class="hljs-property">domElement</span>.<span class="hljs-title function_">appendChild</span>(myElement.<span class="hljs-property">domElement</span>);
        }

        <span class="hljs-keyword">return</span> myElement;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-34">&#x00a7;</a>
              </div>
              <h4 id="factory">Factory</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> makeStack = <span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) {

    <span class="hljs-keyword">if</span> (!items) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stack</span>(items);
};

constructors.<span class="hljs-property">Stack</span> = <span class="hljs-title class_">Stack</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-35">&#x00a7;</a>
              </div>
              <h4 id="stack-discovery">Stack discovery</h4>
<p><code>Exported function</code> (to modules). Parse the DOM, looking for all elements that have been given a <strong>data-stack</strong> attribute; then create <strong>Stack</strong> artefact wrappers for each of them. </p>
<p>This function will also create wrappers for all <strong>direct child elements</strong> (one level down) within the stack, and create appropriate wrappers (Stack, Canvas, Element) for them.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getStacks = <span class="hljs-keyword">function</span> (<span class="hljs-params">query = $DATA_SCRAWL_STACK</span>) {

    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(query).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">el</span> =&gt;</span> <span class="hljs-title function_">addInitialStackElement</span>(el));
};</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-36">&#x00a7;</a>
              </div>
              <p>Create a <strong>stack</strong> artefact wrapper for a given stack element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> addInitialStackElement = <span class="hljs-keyword">function</span> (<span class="hljs-params">el</span>) {

    <span class="hljs-keyword">let</span> mygroup = el.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-variable constant_">DATA_SCRAWL_GROUP</span>),
        myname = el.<span class="hljs-property">id</span> || el.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-variable constant_">NAME</span>),
        position = <span class="hljs-variable constant_">ABSOLUTE</span>;

    <span class="hljs-keyword">if</span> (!mygroup) {

        el.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-variable constant_">DATA_SCRAWL_GROUP</span>, <span class="hljs-variable constant_">ROOT</span>);
        mygroup = <span class="hljs-variable constant_">ROOT</span>;
        position = <span class="hljs-variable constant_">RELATIVE</span>;
    }

    <span class="hljs-keyword">if</span> (!myname) {

        myname = <span class="hljs-title function_">generateUniqueString</span>();
        el.<span class="hljs-property">id</span> = myname;
    }

    <span class="hljs-keyword">const</span> mystack = <span class="hljs-title function_">makeStack</span>({
        <span class="hljs-attr">name</span>: myname,
        <span class="hljs-attr">domElement</span>: el,
        <span class="hljs-attr">group</span>: mygroup,
        <span class="hljs-attr">host</span>: mygroup,
        <span class="hljs-attr">position</span>: position,
        <span class="hljs-attr">setInitialDimensions</span>: <span class="hljs-literal">true</span>,
    });

    <span class="hljs-title function_">processNewStackChildren</span>(el, myname);

    <span class="hljs-keyword">return</span> mystack;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-37">&#x00a7;</a>
              </div>
              <p>Helper function for addInitialStackElement()</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> processNewStackChildren = <span class="hljs-keyword">function</span> (<span class="hljs-params">el, name</span>) {

    <span class="hljs-keyword">let</span> hostDims = el.<span class="hljs-title function_">getBoundingClientRect</span>(),
        y = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-38">&#x00a7;</a>
              </div>
              <p>Only go down one level of hierarchy here; stacks don’t do hierarchies, only interested in knowing about immediate child elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(el.<span class="hljs-property">children</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> {
    
        <span class="hljs-keyword">if</span> (child.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-variable constant_">DATA_SCRAWL_STACK</span>) == <span class="hljs-literal">null</span> &amp;&amp; !<span class="hljs-title function_">isa_canvas</span>(child) &amp;&amp; child.<span class="hljs-property">tagName</span> != $SCRIPT) {

            <span class="hljs-keyword">let</span> dims = child.<span class="hljs-title function_">getBoundingClientRect</span>(),
                computed = <span class="hljs-title function_">_computed</span>(child);

            <span class="hljs-keyword">let</span> yHeight = <span class="hljs-built_in">parseFloat</span>(computed.<span class="hljs-property">marginTop</span>) + <span class="hljs-built_in">parseFloat</span>(computed.<span class="hljs-property">borderTopWidth</span>) + <span class="hljs-built_in">parseFloat</span>(computed.<span class="hljs-property">paddingTop</span>) + <span class="hljs-built_in">parseFloat</span>(computed.<span class="hljs-property">paddingBottom</span>) + <span class="hljs-built_in">parseFloat</span>(computed.<span class="hljs-property">borderBottomWidth</span>) + <span class="hljs-built_in">parseFloat</span>(computed.<span class="hljs-property">marginBottom</span>);

            y = (!y) ? dims.<span class="hljs-property">top</span> - hostDims.<span class="hljs-property">top</span> : y;

            <span class="hljs-keyword">const</span> args = {
                <span class="hljs-attr">name</span>: child.<span class="hljs-property">id</span> || child.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-variable constant_">NAME</span>),
                <span class="hljs-attr">domElement</span>: child,
                <span class="hljs-attr">group</span>: name,
                <span class="hljs-attr">host</span>: name,
                <span class="hljs-attr">position</span>: <span class="hljs-variable constant_">ABSOLUTE</span>,
                <span class="hljs-attr">width</span>: dims.<span class="hljs-property">width</span>,
                <span class="hljs-attr">height</span>: dims.<span class="hljs-property">height</span>,
                <span class="hljs-attr">startX</span>: dims.<span class="hljs-property">left</span> - hostDims.<span class="hljs-property">left</span>,
                <span class="hljs-attr">startY</span>: y,
                <span class="hljs-attr">classes</span>: (child.<span class="hljs-property">className</span>) ? child.<span class="hljs-property">className</span> : <span class="hljs-variable constant_">ZERO_STR</span>,
            };

            y += yHeight + dims.<span class="hljs-property">height</span>;

            <span class="hljs-title function_">makeElement</span>(args);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-39">&#x00a7;</a>
              </div>
              <p>No need to worry about processing child stacks - they’ll already be in the list of stacks to be processed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> child.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-variable constant_">DATA_SCRAWL_GROUP</span>, name);
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-40">&#x00a7;</a>
              </div>
              <p><code>Exported function</code> (to modules and scrawl object). Use <strong>addStack</strong> to add a Scrawl-canvas stack element to a web page, or transform an existing element into a stack element. The items argument can include </p>
<ul>
<li><strong>element</strong> - the DOM element to be the stack - if not present, will autogenerate a div element</li>
<li><strong>host</strong> - the host element, either as the DOM element itself, or some sort of CSS search string; if not present, will create the stack at the stack element’s current place or, failing all else, add the stack to the end of the document body</li>
<li><strong>name</strong> - String identifier for the stack; if not included the function will attempt to use the element’s existing id or name attribute or, failing that, generate a random name for the stack.</li>
<li>any other regular stack attribute</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> addStack = <span class="hljs-keyword">function</span> (<span class="hljs-params">items = Ωempty</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-41">&#x00a7;</a>
              </div>
              <p>define variables</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> el, host, hostinscrawl, mystack, mygroup, name,
        position = <span class="hljs-variable constant_">ABSOLUTE</span>,
        newElement = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-42">&#x00a7;</a>
              </div>
              <p>get, or generate a new, stack-to-be element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (items.<span class="hljs-property">element</span> &amp;&amp; items.<span class="hljs-property">element</span>.<span class="hljs-property">substring</span>) el = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(items.<span class="hljs-property">element</span>);
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isa_dom</span>(items.<span class="hljs-property">element</span>)) el = items.<span class="hljs-property">element</span>;
    <span class="hljs-keyword">else</span> {

        newElement = <span class="hljs-literal">true</span>;
        el = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-variable constant_">DIV</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-43">&#x00a7;</a>
              </div>
              <p>get element’s host (parent-to-be) element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (items.<span class="hljs-property">host</span> &amp;&amp; items.<span class="hljs-property">host</span>.<span class="hljs-property">substring</span>) {

        host = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(items.<span class="hljs-property">host</span>);
        <span class="hljs-keyword">if</span> (!host) host = <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>;
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isa_dom</span>(items.<span class="hljs-property">host</span>)) host = items.<span class="hljs-property">host</span>;
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">xt</span>(el.<span class="hljs-property">parentElement</span>)) host = el.<span class="hljs-property">parentElement</span>;
    <span class="hljs-keyword">else</span> host = <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-44">&#x00a7;</a>
              </div>
              <p>if dimensions have been set in the argument, apply them to the stack-to-be element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">xt</span>(items.<span class="hljs-property">width</span>)) el.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = (items.<span class="hljs-property">width</span>.<span class="hljs-property">toFixed</span>) ? <span class="hljs-string">`<span class="hljs-subst">${items.width}</span>px`</span> : items.<span class="hljs-property">width</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">xt</span>(items.<span class="hljs-property">height</span>)) el.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = (items.<span class="hljs-property">height</span>.<span class="hljs-property">toFixed</span>) ? <span class="hljs-string">`<span class="hljs-subst">${items.height}</span>px`</span> : items.<span class="hljs-property">height</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-45">&#x00a7;</a>
              </div>
              <p>make sure the stack-to-be element has an id attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    name = items.<span class="hljs-property">name</span> || el.<span class="hljs-property">id</span> || el.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-variable constant_">NAME</span>) || <span class="hljs-variable constant_">ZERO_STR</span>;
    <span class="hljs-keyword">if</span> (!name) name = <span class="hljs-title function_">generateUniqueString</span>();
    el.<span class="hljs-property">id</span> = name;</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-46">&#x00a7;</a>
              </div>
              <p>set the ‘data-scrawl-stack’ attribute on the stack-to-be element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    el.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-variable constant_">DATA_SCRAWL_STACK</span>, <span class="hljs-variable constant_">DATA_SCRAWL_STACK</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-47">&#x00a7;</a>
              </div>
              <p>determine whether the parent element is already known to Scrawl-canvas - affects the stack-to-be element’s group </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (host &amp;&amp; host.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-variable constant_">DATA_SCRAWL_STACK</span>) != <span class="hljs-literal">null</span>) {

        hostinscrawl = artefact[host.<span class="hljs-property">id</span>];

        mygroup = (hostinscrawl) ? hostinscrawl.<span class="hljs-property">name</span> : <span class="hljs-variable constant_">ROOT</span>;
    }
    <span class="hljs-keyword">else</span> mygroup = <span class="hljs-variable constant_">ROOT</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-48">&#x00a7;</a>
              </div>
              <p>set the ‘data-scrawl-group’ attribute on the stack-to-be element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    el.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-variable constant_">DATA_SCRAWL_GROUP</span>, mygroup);</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-49">&#x00a7;</a>
              </div>
              <p>determine what the stack-to-be element’s position style attribute will be</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (mygroup == <span class="hljs-variable constant_">ROOT</span>) position = <span class="hljs-variable constant_">RELATIVE</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-50">&#x00a7;</a>
              </div>
              <p>add (or move) the stack-to-be element to/in the DOM</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!el.<span class="hljs-property">parentElement</span> || host.<span class="hljs-property">id</span> !== el.<span class="hljs-property">parentElement</span>.<span class="hljs-property">id</span>) host.<span class="hljs-title function_">appendChild</span>(el);</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-51">&#x00a7;</a>
              </div>
              <p>create the Scrawl-canvas Stack artefact</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    mystack = <span class="hljs-title function_">makeStack</span>({
        <span class="hljs-attr">name</span>: name,
        <span class="hljs-attr">domElement</span>: el,
        <span class="hljs-attr">group</span>: mygroup,
        <span class="hljs-attr">host</span>: mygroup,
        <span class="hljs-attr">position</span>: position,
        <span class="hljs-attr">setInitialDimensions</span>: <span class="hljs-literal">true</span>
    });

    <span class="hljs-title function_">processNewStackChildren</span>(el, name);</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-52">&#x00a7;</a>
              </div>
              <p>in case any of the child elements were already a Scrawl-canvas stack, un-root them (if required)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(el.<span class="hljs-property">childNodes</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> {

        <span class="hljs-keyword">if</span> (child.<span class="hljs-property">id</span> &amp;&amp; <span class="hljs-title function_">rootElementsIncludes</span>(child.<span class="hljs-property">id</span>)) <span class="hljs-title function_">rootElementsRemove</span>(child.<span class="hljs-property">id</span>);
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-53">&#x00a7;</a>
              </div>
              <p>set the new Stack’s remaining attributes, clearing out any attributes already handled</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">delete</span> items.<span class="hljs-property">name</span>;
    <span class="hljs-keyword">delete</span> items.<span class="hljs-property">element</span>;
    <span class="hljs-keyword">delete</span> items.<span class="hljs-property">host</span>;
    <span class="hljs-keyword">delete</span> items.<span class="hljs-property">width</span>;
    <span class="hljs-keyword">delete</span> items.<span class="hljs-property">height</span>;
    mystack.<span class="hljs-title function_">set</span>(items);</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-54">&#x00a7;</a>
              </div>
              <p>tidy up and complete</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-title function_">rootElementsSort</span>(<span class="hljs-literal">true</span>);
    <span class="hljs-keyword">return</span> mystack;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-55">&#x00a7;</a>
              </div>
              <p><code>Exported function</code> (to modules and scrawl object). Parse the DOM, looking for a specific element; then create a <strong>Stack</strong> artefact wrapper for it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getStack = <span class="hljs-keyword">function</span> (<span class="hljs-params">search</span>) {

    <span class="hljs-keyword">const</span> el = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">`#<span class="hljs-subst">${search}</span>`</span>);

    <span class="hljs-keyword">const</span> s = stack[search];

    <span class="hljs-keyword">if</span> (s) {

        <span class="hljs-keyword">if</span> (el.<span class="hljs-property">dataset</span>.<span class="hljs-property">scrawlGroup</span> != <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> s;
        <span class="hljs-keyword">else</span> <span class="hljs-title function_">purge</span>(search);
    }

    <span class="hljs-keyword">if</span> (el) {
        <span class="hljs-keyword">const</span> newStack = <span class="hljs-title function_">addInitialStackElement</span>(el);
        <span class="hljs-keyword">return</span> newStack;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
