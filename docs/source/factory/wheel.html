<!DOCTYPE html>

<html>
<head>
  <title>Wheel factory</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="../core/animationloop.html">
                  ./source/core/animationloop.js
                </a>
              
                
                <a class="source" href="../core/component.html">
                  ./source/core/component.js
                </a>
              
                
                <a class="source" href="../core/document.html">
                  ./source/core/document.js
                </a>
              
                
                <a class="source" href="../core/init.html">
                  ./source/core/init.js
                </a>
              
                
                <a class="source" href="../core/library.html">
                  ./source/core/library.js
                </a>
              
                
                <a class="source" href="../core/userInteraction.html">
                  ./source/core/userInteraction.js
                </a>
              
                
                <a class="source" href="../core/utilities.html">
                  ./source/core/utilities.js
                </a>
              
                
                <a class="source" href="action.html">
                  ./source/factory/action.js
                </a>
              
                
                <a class="source" href="anchor.html">
                  ./source/factory/anchor.js
                </a>
              
                
                <a class="source" href="animation.html">
                  ./source/factory/animation.js
                </a>
              
                
                <a class="source" href="block.html">
                  ./source/factory/block.js
                </a>
              
                
                <a class="source" href="canvas.html">
                  ./source/factory/canvas.js
                </a>
              
                
                <a class="source" href="cell.html">
                  ./source/factory/cell.js
                </a>
              
                
                <a class="source" href="color.html">
                  ./source/factory/color.js
                </a>
              
                
                <a class="source" href="coordinate.html">
                  ./source/factory/coordinate.js
                </a>
              
                
                <a class="source" href="element.html">
                  ./source/factory/element.js
                </a>
              
                
                <a class="source" href="filter.html">
                  ./source/factory/filter.js
                </a>
              
                
                <a class="source" href="fontAttributes.html">
                  ./source/factory/fontAttributes.js
                </a>
              
                
                <a class="source" href="gradient.html">
                  ./source/factory/gradient.js
                </a>
              
                
                <a class="source" href="grid.html">
                  ./source/factory/grid.js
                </a>
              
                
                <a class="source" href="group.html">
                  ./source/factory/group.js
                </a>
              
                
                <a class="source" href="imageAsset.html">
                  ./source/factory/imageAsset.js
                </a>
              
                
                <a class="source" href="loom.html">
                  ./source/factory/loom.js
                </a>
              
                
                <a class="source" href="palette.html">
                  ./source/factory/palette.js
                </a>
              
                
                <a class="source" href="pattern.html">
                  ./source/factory/pattern.js
                </a>
              
                
                <a class="source" href="phrase.html">
                  ./source/factory/phrase.js
                </a>
              
                
                <a class="source" href="picture.html">
                  ./source/factory/picture.js
                </a>
              
                
                <a class="source" href="quaternion.html">
                  ./source/factory/quaternion.js
                </a>
              
                
                <a class="source" href="radialGradient.html">
                  ./source/factory/radialGradient.js
                </a>
              
                
                <a class="source" href="renderAnimation.html">
                  ./source/factory/renderAnimation.js
                </a>
              
                
                <a class="source" href="shape.html">
                  ./source/factory/shape.js
                </a>
              
                
                <a class="source" href="spriteAsset.html">
                  ./source/factory/spriteAsset.js
                </a>
              
                
                <a class="source" href="stack.html">
                  ./source/factory/stack.js
                </a>
              
                
                <a class="source" href="state.html">
                  ./source/factory/state.js
                </a>
              
                
                <a class="source" href="ticker.html">
                  ./source/factory/ticker.js
                </a>
              
                
                <a class="source" href="tween.html">
                  ./source/factory/tween.js
                </a>
              
                
                <a class="source" href="unstackedElement.html">
                  ./source/factory/unstackedElement.js
                </a>
              
                
                <a class="source" href="vector.html">
                  ./source/factory/vector.js
                </a>
              
                
                <a class="source" href="videoAsset.html">
                  ./source/factory/videoAsset.js
                </a>
              
                
                <a class="source" href="wheel.html">
                  ./source/factory/wheel.js
                </a>
              
                
                <a class="source" href="../mixin/anchor.html">
                  ./source/mixin/anchor.js
                </a>
              
                
                <a class="source" href="../mixin/asset.html">
                  ./source/mixin/asset.js
                </a>
              
                
                <a class="source" href="../mixin/assetConsumer.html">
                  ./source/mixin/assetConsumer.js
                </a>
              
                
                <a class="source" href="../mixin/base.html">
                  ./source/mixin/base.js
                </a>
              
                
                <a class="source" href="../mixin/cascade.html">
                  ./source/mixin/cascade.js
                </a>
              
                
                <a class="source" href="../mixin/dom.html">
                  ./source/mixin/dom.js
                </a>
              
                
                <a class="source" href="../mixin/entity.html">
                  ./source/mixin/entity.js
                </a>
              
                
                <a class="source" href="../mixin/filter.html">
                  ./source/mixin/filter.js
                </a>
              
                
                <a class="source" href="../mixin/position.html">
                  ./source/mixin/position.js
                </a>
              
                
                <a class="source" href="../mixin/shapePathCalculation.html">
                  ./source/mixin/shapePathCalculation.js
                </a>
              
                
                <a class="source" href="../mixin/styles.html">
                  ./source/mixin/styles.js
                </a>
              
                
                <a class="source" href="../mixin/tween.html">
                  ./source/mixin/tween.js
                </a>
              
                
                <a class="source" href="../worker/filter.html">
                  ./source/worker/filter.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="wheel-factory">Wheel factory</h1>
<p>Wheel entitys are circles and part-circles rendered onto a DOM &lt;canvas&gt; element using the Canvas 2D API’s <a href="https://developer.mozilla.org/en-US/docs/Web/API/Path2D">Path2D interface</a> - specifically the arc() and lineTo() methods.</p>
<ul>
<li>Positioning functionality for the Wheel is supplied by the <strong>position</strong> mixin, while rendering functionality comes from the <strong>entity</strong> mixin. </li>
<li>Wheel dimensions are tied closely to its <strong>radius</strong> attribute; relative dimensions are calculated using the Wheel’s Cell container’s width.</li>
<li>Wheels can use CSS color Strings for their fillStyle and strokeStyle values, alongside <strong>Gradient</strong>, <strong>RadialGradient</strong>, <strong>Color</strong> and <strong>Pattern</strong> objects. </li>
<li>They will also accept <strong>Filter</strong> objects.</li>
<li>They can use <strong>Anchor</strong> objects for user navigation. </li>
<li>They can be rendered to the canvas by including them in a <strong>Cell</strong> object’s <strong>Group</strong>. </li>
<li>They can be animated directly, or using delta animation, or act as the target for <strong>Tween</strong> animations.</li>
<li>Wheels can be cloned, and killed.</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h4 id="demos">Demos:</h4>
<ul>
<li><a href="../../demo/canvas-001.html">Canvas-001</a> - Block and Wheel entitys (make, clone, method); drag and drop block and wheel entitys</li>
<li><a href="../../demo/canvas-005.html">Canvas-005</a> - Cell-locked, and Entity-locked, gradients; animating gradients by delta, and by tween</li>
<li><a href="../../demo/canvas-007.html">Canvas-007</a> - Apply filters at the entity, group and cell level</li>
<li><a href="../../demo/component-004.html">Component-004</a> - Scrawl-canvas packets; save and load a range of different entitys</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h4 id="imports">Imports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { constructors, radian } <span class="hljs-keyword">from</span> <span class="hljs-string">'../core/library.js'</span>;
<span class="hljs-keyword">import</span> { mergeOver, xt, xto, ensureFloat } <span class="hljs-keyword">from</span> <span class="hljs-string">'../core/utilities.js'</span>;

<span class="hljs-keyword">import</span> baseMix <span class="hljs-keyword">from</span> <span class="hljs-string">'../mixin/base.js'</span>;
<span class="hljs-keyword">import</span> positionMix <span class="hljs-keyword">from</span> <span class="hljs-string">'../mixin/position.js'</span>;
<span class="hljs-keyword">import</span> anchorMix <span class="hljs-keyword">from</span> <span class="hljs-string">'../mixin/anchor.js'</span>;
<span class="hljs-keyword">import</span> entityMix <span class="hljs-keyword">from</span> <span class="hljs-string">'../mixin/entity.js'</span>;
<span class="hljs-keyword">import</span> filterMix <span class="hljs-keyword">from</span> <span class="hljs-string">'../mixin/filter.js'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h4 id="wheel-constructor">Wheel constructor</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Wheel = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

    <span class="hljs-keyword">if</span> (!xto(items.dimensions, items.width, items.height, items.radius)) items.radius = <span class="hljs-number">5</span>;

    <span class="hljs-keyword">this</span>.entityInit(items);

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h4 id="wheel-prototype">Wheel prototype</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> P = Wheel.prototype = <span class="hljs-built_in">Object</span>.create(<span class="hljs-built_in">Object</span>.prototype);
P.type = <span class="hljs-string">'Wheel'</span>;
P.lib = <span class="hljs-string">'entity'</span>;
P.isArtefact = <span class="hljs-literal">true</span>;
P.isAsset = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h4 id="mixins">Mixins</h4>
<ul>
<li><a href="../mixin/base.html">base</a></li>
<li><a href="../mixin/position.html">position</a></li>
<li><a href="../mixin/anchor.html">anchor</a></li>
<li><a href="../mixin/entity.html">entity</a></li>
<li><a href="../mixin/filter.html">filter</a></li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P = baseMix(P);
P = positionMix(P);
P = anchorMix(P);
P = entityMix(P);
P = filterMix(P);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h4 id="wheel-attributes">Wheel attributes</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> defaultAttributes = {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p><strong>radius</strong> - the circle’s radius measured in Number pixels, or as a String% - `’10%’ - of the Cell’s width</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    radius: <span class="hljs-number">5</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p><strong>startAngle</strong>, <strong>endAngle</strong> - the Number angles at which the rendered arc starts and ends, in <strong>degrees</strong> (not radians), with 0&deg; and 360&deg; set horizontally to the right (+ve x axis) of the circle’s center.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    startAngle: <span class="hljs-number">0</span>,
    <span class="hljs-attr">endAngle</span>: <span class="hljs-number">360</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p><strong>clockwise</strong> - a Boolean flag which, when true, draws the arc in a clockwise rotation between the start and end angles; a false value causes the arc to be drawn in an anti-clockwise direction.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    clockwise: <span class="hljs-literal">true</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p><strong>includeCenter</strong> - a Boolean flag which, when true, draws a line from the end angle to the center of the circle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    includeCenter: <span class="hljs-literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p><strong>closed</strong> - a Boolean flag which, when true, draws a line from the end angle to the start angle. If includeCenter has been set to true, the line will be drawn from the center of the circle to the start angle position on the circle circumference.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    closed: <span class="hljs-literal">true</span>,
};
P.defs = mergeOver(P.defs, defaultAttributes);</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <h4 id="packet-management">Packet management</h4>
<p>No additional packet functionality required</p>

            </div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <h4 id="clone-management">Clone management</h4>
<p>No additional clone functionality required</p>

            </div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h4 id="kill-management">Kill management</h4>
<p>No additional kill functionality required</p>

            </div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <h4 id="get-set-deltaset">Get, Set, deltaSet</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> G = P.getters,
    S = P.setters,
    D = P.deltaSetters;</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p><strong>width</strong> and <strong>height</strong> (and dimensions) values are largely irrelevant to Wheel entitys; they get used internally purely as part of the Display cycle stamp functionality. </p>

            </div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>If they are used to (delta)set the entity’s values then the radius will be set to half the supplied value with String% values calculated from the entity’s host’s width, while height and width will equalize to maintain dimensional integrity.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.width = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{

    <span class="hljs-keyword">if</span> (val != <span class="hljs-literal">null</span>) {

        <span class="hljs-keyword">let</span> dims = <span class="hljs-keyword">this</span>.dimensions;

        dims[<span class="hljs-number">0</span>] = dims[<span class="hljs-number">1</span>] = val;
        <span class="hljs-keyword">this</span>.dimensionsHelper();
    }
};
D.width = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{

    <span class="hljs-keyword">let</span> dims = <span class="hljs-keyword">this</span>.dimensions;

    dims[<span class="hljs-number">0</span>] = dims[<span class="hljs-number">1</span>] = addStrings(dims[<span class="hljs-number">0</span>], val);
    <span class="hljs-keyword">this</span>.dimensionsHelper();
};

S.height = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{

    <span class="hljs-keyword">if</span> (val != <span class="hljs-literal">null</span>) {

        <span class="hljs-keyword">let</span> dims = <span class="hljs-keyword">this</span>.dimensions;

        dims[<span class="hljs-number">0</span>] = dims[<span class="hljs-number">1</span>] = val;
        <span class="hljs-keyword">this</span>.dimensionsHelper();
    }
};
D.height = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{

    <span class="hljs-keyword">let</span> dims = <span class="hljs-keyword">this</span>.dimensions;

    dims[<span class="hljs-number">0</span>] = dims[<span class="hljs-number">1</span>] = addStrings(dims[<span class="hljs-number">0</span>], val);
    <span class="hljs-keyword">this</span>.dimensionsHelper();
};

S.dimensions = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">w, h</span>) </span>{

    <span class="hljs-keyword">this</span>.setCoordinateHelper(<span class="hljs-string">'dimensions'</span>, w, h);
    <span class="hljs-keyword">this</span>.dimensionsHelper();
};
D.dimensions = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">w, h</span>) </span>{

    <span class="hljs-keyword">this</span>.setDeltaCoordinateHelper(<span class="hljs-string">'dimensions'</span>, w, h);
    <span class="hljs-keyword">this</span>.dimensionsHelper();
}</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Setters for attributes specific to the Wheel entity</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.radius = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{

    <span class="hljs-keyword">this</span>.radius = val;
    <span class="hljs-keyword">this</span>.radiusHelper();
};
D.radius = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{

    <span class="hljs-keyword">this</span>.radius = addStrings(<span class="hljs-keyword">this</span>.radius, val);
    <span class="hljs-keyword">this</span>.radiusHelper();
};

S.startAngle = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{

    <span class="hljs-keyword">this</span>.startAngle = ensureFloat(val, <span class="hljs-number">4</span>);
    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
};
D.startAngle = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{

    <span class="hljs-keyword">this</span>.startAngle += ensureFloat(val, <span class="hljs-number">4</span>);
    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
};

S.endAngle = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{

    <span class="hljs-keyword">this</span>.endAngle = ensureFloat(val, <span class="hljs-number">4</span>);
    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
};
D.endAngle = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{

    <span class="hljs-keyword">this</span>.endAngle += ensureFloat(val, <span class="hljs-number">4</span>);
    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
};

S.closed = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">bool</span>) </span>{

    <span class="hljs-keyword">if</span>(xt(bool)) {

        <span class="hljs-keyword">this</span>.closed = !!bool;
        <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
    }
};

S.includeCenter = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">bool</span>) </span>{

    <span class="hljs-keyword">if</span>(xt(bool)) {

        <span class="hljs-keyword">this</span>.includeCenter = !!bool;
        <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
    }
};

S.clockwise = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">bool</span>) </span>{

    <span class="hljs-keyword">if</span>(xt(bool)) {

        <span class="hljs-keyword">this</span>.clockwise = !!bool;
        <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <h4 id="prototype-functions">Prototype functions</h4>

            </div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Internal functions for reconciling dimensions and radius attribute values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.dimensionsHelper = function () {

    let width = this.dimensions[0];

    if (width.substring) this.radius = `${(parseFloat(width) / 2)}%`;
    else this.radius = (width / 2);

    this.dirtyDimensions = true;
};
P.radiusHelper = function () {

    let radius = this.radius,
        dims = this.dimensions;

    if (radius.substring) dims[0] = dims[1] = (parseFloat(radius) * 2) + '%';
    else dims[0] = dims[1] = (radius * 2);

    this.dirtyDimensions = true;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Dimensions calculations - overwrites mixin/position.js function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.cleanDimensionsAdditionalActions = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> radius = <span class="hljs-keyword">this</span>.radius,
        dims = <span class="hljs-keyword">this</span>.currentDimensions,
        calculatedRadius = (radius.substring) ? (<span class="hljs-built_in">parseFloat</span>(radius) / <span class="hljs-number">100</span>) * dims[<span class="hljs-number">0</span>] : radius;

    <span class="hljs-keyword">if</span> (dims[<span class="hljs-number">0</span>] !== calculatedRadius * <span class="hljs-number">2</span>) {

        dims[<span class="hljs-number">1</span>] = dims[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">this</span>.currentRadius = dims[<span class="hljs-number">0</span>] / <span class="hljs-number">2</span>;
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">this</span>.currentRadius = calculatedRadius;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>A Wheel entitys will place <strong>collision sensors</strong> around its circumference. The following functions completely overwrite the sensor functionality defined in mixin/position.js</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.calculateSensors = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> rotate = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">coords, angle, sx, sy</span>) </span>{

        <span class="hljs-keyword">let</span> [x, y] = coords,
            arr = [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>];

        arr[<span class="hljs-number">0</span>] = <span class="hljs-built_in">Math</span>.atan2(y, x);
        arr[<span class="hljs-number">0</span>] += (angle * <span class="hljs-number">0.01745329251</span>);
        arr[<span class="hljs-number">1</span>] = <span class="hljs-built_in">Math</span>.sqrt((x * x) + (y * y));

        <span class="hljs-keyword">return</span> [<span class="hljs-built_in">Math</span>.round(arr[<span class="hljs-number">1</span>] * <span class="hljs-built_in">Math</span>.cos(arr[<span class="hljs-number">0</span>])) + sx, <span class="hljs-built_in">Math</span>.round(arr[<span class="hljs-number">1</span>] * <span class="hljs-built_in">Math</span>.sin(arr[<span class="hljs-number">0</span>])) + sy];
    };

    <span class="hljs-keyword">let</span> smallRotate = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x, y, angle</span>) </span>{

        <span class="hljs-keyword">let</span> arr = [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>];

        arr[<span class="hljs-number">0</span>] = <span class="hljs-built_in">Math</span>.atan2(y, x);
        arr[<span class="hljs-number">0</span>] += (angle * <span class="hljs-number">0.01745329251</span>);
        arr[<span class="hljs-number">1</span>] = <span class="hljs-built_in">Math</span>.sqrt((x * x) + (y * y));

        <span class="hljs-keyword">return</span> [<span class="hljs-built_in">Math</span>.round(arr[<span class="hljs-number">1</span>] * <span class="hljs-built_in">Math</span>.cos(arr[<span class="hljs-number">0</span>])), <span class="hljs-built_in">Math</span>.round(arr[<span class="hljs-number">1</span>] * <span class="hljs-built_in">Math</span>.sin(arr[<span class="hljs-number">0</span>]))];
    };

    <span class="hljs-keyword">this</span>.calculatePerimeterLength();

    <span class="hljs-keyword">let</span> stamp = <span class="hljs-keyword">this</span>.currentStampPosition,
        handle = <span class="hljs-keyword">this</span>.currentStampHandlePosition,
        scale = <span class="hljs-keyword">this</span>.currentScale,
        radius = <span class="hljs-keyword">this</span>.currentRadius * scale,
        startAngle = <span class="hljs-keyword">this</span>.startAngle,
        endAngle = <span class="hljs-keyword">this</span>.endAngle,
        circumferenceLength = <span class="hljs-keyword">this</span>.circumferenceLength,
        circumferenceRatio = <span class="hljs-keyword">this</span>.circumferenceRatio,
        upend = <span class="hljs-keyword">this</span>.flipUpend,
        reverse = <span class="hljs-keyword">this</span>.flipReverse;

    <span class="hljs-keyword">let</span> roll = <span class="hljs-keyword">this</span>.roll,
        sx = stamp[<span class="hljs-number">0</span>],
        sy = stamp[<span class="hljs-number">1</span>],
        handleX = (reverse) ? -handle[<span class="hljs-number">0</span>] * scale : handle[<span class="hljs-number">0</span>] * scale,
        handleY = (upend) ? -handle[<span class="hljs-number">1</span>] * scale : handle[<span class="hljs-number">1</span>] * scale;

    <span class="hljs-keyword">let</span> sensorSpacing = <span class="hljs-keyword">this</span>.sensorSpacing || <span class="hljs-number">50</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>There’s two components of the wheel we need to add sensors to - the circumference, and any straight bits</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> sensors = <span class="hljs-keyword">this</span>.currentSensors;
    sensors.length = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>For the circumference</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> circumferenceSensors = <span class="hljs-built_in">Math</span>.ceil(circumferenceLength / sensorSpacing);

    <span class="hljs-keyword">if</span> (circumferenceRatio &lt; <span class="hljs-number">0.25</span> &amp;&amp; circumferenceSensors &lt; <span class="hljs-number">2</span>) circumferenceSensors = <span class="hljs-number">2</span>;
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (circumferenceRatio &lt; <span class="hljs-number">0.5</span> &amp;&amp; circumferenceSensors &lt; <span class="hljs-number">4</span>) circumferenceSensors = <span class="hljs-number">4</span>;
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (circumferenceRatio &lt; <span class="hljs-number">0.75</span> &amp;&amp; circumferenceSensors &lt; <span class="hljs-number">6</span>) circumferenceSensors = <span class="hljs-number">6</span>;
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (circumferenceSensors &lt; <span class="hljs-number">8</span>) circumferenceSensors = <span class="hljs-number">8</span>;

    <span class="hljs-keyword">let</span> partialAngle = (circumferenceRatio * <span class="hljs-number">360</span>) / circumferenceSensors;

    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.clockwise) partialAngle = -partialAngle;
    <span class="hljs-keyword">if</span> ((reverse &amp;&amp; !upend) || (!reverse &amp;&amp; upend)) partialAngle = -partialAngle;

    <span class="hljs-keyword">if</span> (reverse &amp;&amp; !upend) {

        <span class="hljs-keyword">if</span> (startAngle &lt;= <span class="hljs-number">180</span>) startAngle = <span class="hljs-number">180</span> - startAngle;
        <span class="hljs-keyword">else</span> startAngle = (<span class="hljs-number">180</span> - startAngle) + <span class="hljs-number">360</span>;

        <span class="hljs-keyword">if</span> (endAngle &lt;= <span class="hljs-number">180</span>) endAngle = <span class="hljs-number">180</span> - endAngle;
        <span class="hljs-keyword">else</span> endAngle = (<span class="hljs-number">180</span> - endAngle) + <span class="hljs-number">360</span>;
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!reverse &amp;&amp; upend) {

        <span class="hljs-keyword">if</span> (startAngle &lt;= <span class="hljs-number">180</span>) startAngle = <span class="hljs-number">360</span> - startAngle;
        <span class="hljs-keyword">else</span> startAngle = (<span class="hljs-number">180</span> - startAngle) + <span class="hljs-number">180</span>;

        <span class="hljs-keyword">if</span> (endAngle &lt;= <span class="hljs-number">180</span>) endAngle = <span class="hljs-number">360</span> - endAngle;
        <span class="hljs-keyword">else</span> endAngle = (<span class="hljs-number">180</span> - endAngle) + <span class="hljs-number">180</span>;
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (reverse &amp;&amp; upend) {

        startAngle += <span class="hljs-number">180</span>;
        endAngle += <span class="hljs-number">180</span>;

        <span class="hljs-keyword">if</span> (startAngle &gt; <span class="hljs-number">360</span>) startAngle -= <span class="hljs-number">360</span>;
        <span class="hljs-keyword">if</span> (endAngle &gt; <span class="hljs-number">360</span>) endAngle -= <span class="hljs-number">360</span>;
    }

    <span class="hljs-keyword">let</span> currentAngle = startAngle,
        coord, i;

    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt;= circumferenceSensors; i++) {

        coord = smallRotate(radius, <span class="hljs-number">0</span>, currentAngle);

        <span class="hljs-keyword">if</span> (reverse) coord[<span class="hljs-number">0</span>] = coord[<span class="hljs-number">0</span>] + handleX - radius;
        <span class="hljs-keyword">else</span> coord[<span class="hljs-number">0</span>] = coord[<span class="hljs-number">0</span>] - handleX + radius;

        <span class="hljs-keyword">if</span> (upend) coord[<span class="hljs-number">1</span>] = coord[<span class="hljs-number">1</span>] + handleY - radius;
        <span class="hljs-keyword">else</span> coord[<span class="hljs-number">1</span>] = coord[<span class="hljs-number">1</span>] - handleY + radius;

        sensors.push(rotate(coord, roll, sx, sy));

        currentAngle += partialAngle;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>For the non-circumference perimeter bits - we’ve already calculated the true positions of the start and end angle sensors on the circumference</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> cx = (reverse) ? handleX - radius : -handleX + radius,
        cy = (upend) ? handleY - radius : -handleY + radius,
        startCoord = sensors[<span class="hljs-number">0</span>],
        endCoord = sensors[sensors.length - <span class="hljs-number">1</span>],
        nonCircumferenceSensors, nonCircumferenceLength,
        centerCoord, dx, dy, plotX, plotY;

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.includeCenter) {

        sensors.push(rotate([cx, cy], roll, sx, sy));

        centerCoord = sensors[sensors.length - <span class="hljs-number">1</span>];

        nonCircumferenceLength = radius * <span class="hljs-number">2</span>;

        nonCircumferenceSensors = <span class="hljs-built_in">Math</span>.ceil(nonCircumferenceLength / sensorSpacing);
        nonCircumferenceSensors = <span class="hljs-built_in">Math</span>.ceil(nonCircumferenceSensors / <span class="hljs-number">2</span>) - <span class="hljs-number">2</span>;
        <span class="hljs-keyword">if</span> (nonCircumferenceSensors &lt; <span class="hljs-number">1</span>) nonCircumferenceSensors = <span class="hljs-number">1</span>;

        dx = (endCoord[<span class="hljs-number">0</span>] - centerCoord[<span class="hljs-number">0</span>]) / (nonCircumferenceSensors + <span class="hljs-number">1</span>);
        dy = (endCoord[<span class="hljs-number">1</span>] - centerCoord[<span class="hljs-number">1</span>]) / (nonCircumferenceSensors + <span class="hljs-number">1</span>);
        plotX = centerCoord[<span class="hljs-number">0</span>];
        plotY = centerCoord[<span class="hljs-number">1</span>];

        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; nonCircumferenceSensors; i++) {

            plotX += dx;
            plotY += dy;
            sensors.push([plotX, plotY]);
        }
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.closed) {

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.includeCenter) {

            dx = (startCoord[<span class="hljs-number">0</span>] - centerCoord[<span class="hljs-number">0</span>]) / (nonCircumferenceSensors + <span class="hljs-number">1</span>);
            dy = (startCoord[<span class="hljs-number">1</span>] - centerCoord[<span class="hljs-number">1</span>]) / (nonCircumferenceSensors + <span class="hljs-number">1</span>);
            plotX = centerCoord[<span class="hljs-number">0</span>];
            plotY = centerCoord[<span class="hljs-number">1</span>];

            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; nonCircumferenceSensors; i++) {

                plotX += dx;
                plotY += dy;
                sensors.push([plotX, plotY]);
            }
        }
        <span class="hljs-keyword">else</span> {

            dx = endCoord[<span class="hljs-number">0</span>] - startCoord[<span class="hljs-number">0</span>];
            dy = endCoord[<span class="hljs-number">1</span>] - startCoord[<span class="hljs-number">1</span>];

            nonCircumferenceLength = <span class="hljs-built_in">Math</span>.sqrt((dx * dx) + (dy * dy));

            nonCircumferenceSensors = <span class="hljs-built_in">Math</span>.ceil(nonCircumferenceLength / sensorSpacing);
            nonCircumferenceSensors -= <span class="hljs-number">2</span>;
            <span class="hljs-keyword">if</span> (nonCircumferenceSensors &lt; <span class="hljs-number">1</span>) nonCircumferenceSensors = <span class="hljs-number">1</span>;

            dx /= (nonCircumferenceSensors + <span class="hljs-number">1</span>);
            dy /= (nonCircumferenceSensors + <span class="hljs-number">1</span>);
            plotX = startCoord[<span class="hljs-number">0</span>];
            plotY = startCoord[<span class="hljs-number">1</span>];

            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; nonCircumferenceSensors; i++) {

                plotX += dx;
                plotY += dy;
                sensors.push([plotX, plotY]);
            }
        }
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>We take account of scaling in these calculations</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.calculatePerimeterLength = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> radius = <span class="hljs-keyword">this</span>.currentRadius * <span class="hljs-keyword">this</span>.currentScale,
        circumference = <span class="hljs-number">2</span> * <span class="hljs-built_in">Math</span>.PI * radius;

    <span class="hljs-keyword">let</span> leastAngle = <span class="hljs-built_in">Math</span>.min(<span class="hljs-keyword">this</span>.startAngle, <span class="hljs-keyword">this</span>.endAngle),
        starts = <span class="hljs-keyword">this</span>.startAngle - leastAngle,
        ends = <span class="hljs-keyword">this</span>.endAngle - leastAngle,
        leastDistance = <span class="hljs-built_in">Math</span>.abs(ends - starts),
        circumferenceRatio; 

    <span class="hljs-keyword">if</span> (leastDistance &gt; <span class="hljs-number">360</span>) circumferenceRatio = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">if</span> (leastDistance &lt;= <span class="hljs-number">0</span>) circumferenceRatio = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">else</span> circumferenceRatio = leastDistance / <span class="hljs-number">360</span>;

    <span class="hljs-keyword">if</span> (circumferenceRatio &lt; <span class="hljs-number">1</span> &amp;&amp; <span class="hljs-keyword">this</span>.clockwise) circumferenceRatio = <span class="hljs-number">1</span> - circumferenceRatio;

    <span class="hljs-keyword">let</span> perimeterCircumference = circumference * circumferenceRatio;</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Not calculating the non-zero parts of the perimeter here - it’s easier to do those calculations when we have real coordinates to work with</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-keyword">this</span>.circumferenceLength = perimeterCircumference;
    <span class="hljs-keyword">this</span>.circumferenceRatio = circumferenceRatio;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Calculate the Wheel entity’s <strong>Path2D object</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.cleanPathObject = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.noPathUpdates || !<span class="hljs-keyword">this</span>.pathObject) {

        <span class="hljs-keyword">let</span> p = <span class="hljs-keyword">this</span>.pathObject = <span class="hljs-keyword">new</span> Path2D();

        <span class="hljs-keyword">let</span> handle = <span class="hljs-keyword">this</span>.currentStampHandlePosition,
            scale = <span class="hljs-keyword">this</span>.currentScale,
            radius = <span class="hljs-keyword">this</span>.currentRadius * scale,
            x = radius - (handle[<span class="hljs-number">0</span>] * scale),
            y = radius - (handle[<span class="hljs-number">1</span>] * scale),
            starts = <span class="hljs-keyword">this</span>.startAngle * radian,
            ends = <span class="hljs-keyword">this</span>.endAngle * radian;

        p.arc(x, y, radius, starts, ends, !<span class="hljs-keyword">this</span>.clockwise);

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.includeCenter) {

            p.lineTo(x, y);
            p.closePath();
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.closed) p.closePath();
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <h4 id="factory">Factory</h4>
<pre><code>scrawl.makeWheel({

    <span class="hljs-attr">name</span>: <span class="hljs-string">'mywheel-fill'</span>,
    <span class="hljs-attr">radius</span>: <span class="hljs-number">50</span>,
    <span class="hljs-attr">startAngle</span>: <span class="hljs-number">15</span>,
    <span class="hljs-attr">endAngle</span>: <span class="hljs-number">-15</span>,
    <span class="hljs-attr">includeCenter</span>: <span class="hljs-literal">true</span>,

    <span class="hljs-attr">startX</span>: <span class="hljs-number">475</span>,
    <span class="hljs-attr">startY</span>: <span class="hljs-number">475</span>,

    <span class="hljs-attr">fillStyle</span>: <span class="hljs-string">'purple'</span>,
    <span class="hljs-attr">strokeStyle</span>: <span class="hljs-string">'gold'</span>,

    <span class="hljs-attr">lineWidth</span>: <span class="hljs-number">6</span>,
    <span class="hljs-attr">lineJoin</span>: <span class="hljs-string">'round'</span>,
    <span class="hljs-attr">shadowOffsetX</span>: <span class="hljs-number">4</span>,
    <span class="hljs-attr">shadowOffsetY</span>: <span class="hljs-number">4</span>,
    <span class="hljs-attr">shadowBlur</span>: <span class="hljs-number">2</span>,
    <span class="hljs-attr">shadowColor</span>: <span class="hljs-string">'black'</span>,

}).clone({

    <span class="hljs-attr">name</span>: <span class="hljs-string">'mywheel-draw'</span>,
    <span class="hljs-attr">startX</span>: <span class="hljs-number">325</span>,

    <span class="hljs-attr">method</span>: <span class="hljs-string">'draw'</span>,
    <span class="hljs-attr">sharedState</span>: <span class="hljs-literal">true</span>,
});</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> makeWheel = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Wheel(items);
};

constructors.Wheel = Wheel;</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <h4 id="exports">Exports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> {
    makeWheel,
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
