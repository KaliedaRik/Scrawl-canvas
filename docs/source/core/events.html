<!DOCTYPE html>

<html>
<head>
  <title>DOM event listeners</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="animationloop.html">
                  ./source/core/animationloop.js
                </a>
              
                
                <a class="source" href="document.html">
                  ./source/core/document.js
                </a>
              
                
                <a class="source" href="events.html">
                  ./source/core/events.js
                </a>
              
                
                <a class="source" href="init.html">
                  ./source/core/init.js
                </a>
              
                
                <a class="source" href="library.html">
                  ./source/core/library.js
                </a>
              
                
                <a class="source" href="snippets.html">
                  ./source/core/snippets.js
                </a>
              
                
                <a class="source" href="userInteraction.html">
                  ./source/core/userInteraction.js
                </a>
              
                
                <a class="source" href="utilities.html">
                  ./source/core/utilities.js
                </a>
              
                
                <a class="source" href="../factory/action.html">
                  ./source/factory/action.js
                </a>
              
                
                <a class="source" href="../factory/anchor.html">
                  ./source/factory/anchor.js
                </a>
              
                
                <a class="source" href="../factory/animation.html">
                  ./source/factory/animation.js
                </a>
              
                
                <a class="source" href="../factory/bezier.html">
                  ./source/factory/bezier.js
                </a>
              
                
                <a class="source" href="../factory/block.html">
                  ./source/factory/block.js
                </a>
              
                
                <a class="source" href="../factory/canvas.html">
                  ./source/factory/canvas.js
                </a>
              
                
                <a class="source" href="../factory/cell.html">
                  ./source/factory/cell.js
                </a>
              
                
                <a class="source" href="../factory/cog.html">
                  ./source/factory/cog.js
                </a>
              
                
                <a class="source" href="../factory/color.html">
                  ./source/factory/color.js
                </a>
              
                
                <a class="source" href="../factory/conicGradient.html">
                  ./source/factory/conicGradient.js
                </a>
              
                
                <a class="source" href="../factory/coordinate.html">
                  ./source/factory/coordinate.js
                </a>
              
                
                <a class="source" href="../factory/element.html">
                  ./source/factory/element.js
                </a>
              
                
                <a class="source" href="../factory/emitter.html">
                  ./source/factory/emitter.js
                </a>
              
                
                <a class="source" href="../factory/filter.html">
                  ./source/factory/filter.js
                </a>
              
                
                <a class="source" href="../factory/filterEngine.html">
                  ./source/factory/filterEngine.js
                </a>
              
                
                <a class="source" href="../factory/fontAttributes.html">
                  ./source/factory/fontAttributes.js
                </a>
              
                
                <a class="source" href="../factory/gradient.html">
                  ./source/factory/gradient.js
                </a>
              
                
                <a class="source" href="../factory/grid.html">
                  ./source/factory/grid.js
                </a>
              
                
                <a class="source" href="../factory/group.html">
                  ./source/factory/group.js
                </a>
              
                
                <a class="source" href="../factory/imageAsset.html">
                  ./source/factory/imageAsset.js
                </a>
              
                
                <a class="source" href="../factory/line.html">
                  ./source/factory/line.js
                </a>
              
                
                <a class="source" href="../factory/lineSpiral.html">
                  ./source/factory/lineSpiral.js
                </a>
              
                
                <a class="source" href="../factory/loom.html">
                  ./source/factory/loom.js
                </a>
              
                
                <a class="source" href="../factory/mesh.html">
                  ./source/factory/mesh.js
                </a>
              
                
                <a class="source" href="../factory/net.html">
                  ./source/factory/net.js
                </a>
              
                
                <a class="source" href="../factory/noise.html">
                  ./source/factory/noise.js
                </a>
              
                
                <a class="source" href="../factory/oval.html">
                  ./source/factory/oval.js
                </a>
              
                
                <a class="source" href="../factory/palette.html">
                  ./source/factory/palette.js
                </a>
              
                
                <a class="source" href="../factory/particle.html">
                  ./source/factory/particle.js
                </a>
              
                
                <a class="source" href="../factory/particleForce.html">
                  ./source/factory/particleForce.js
                </a>
              
                
                <a class="source" href="../factory/particleHistory.html">
                  ./source/factory/particleHistory.js
                </a>
              
                
                <a class="source" href="../factory/particleSpring.html">
                  ./source/factory/particleSpring.js
                </a>
              
                
                <a class="source" href="../factory/particleWorld.html">
                  ./source/factory/particleWorld.js
                </a>
              
                
                <a class="source" href="../factory/pattern.html">
                  ./source/factory/pattern.js
                </a>
              
                
                <a class="source" href="../factory/phrase.html">
                  ./source/factory/phrase.js
                </a>
              
                
                <a class="source" href="../factory/picture.html">
                  ./source/factory/picture.js
                </a>
              
                
                <a class="source" href="../factory/polygon.html">
                  ./source/factory/polygon.js
                </a>
              
                
                <a class="source" href="../factory/polyline.html">
                  ./source/factory/polyline.js
                </a>
              
                
                <a class="source" href="../factory/quadratic.html">
                  ./source/factory/quadratic.js
                </a>
              
                
                <a class="source" href="../factory/quaternion.html">
                  ./source/factory/quaternion.js
                </a>
              
                
                <a class="source" href="../factory/radialGradient.html">
                  ./source/factory/radialGradient.js
                </a>
              
                
                <a class="source" href="../factory/rawAsset.html">
                  ./source/factory/rawAsset.js
                </a>
              
                
                <a class="source" href="../factory/rectangle.html">
                  ./source/factory/rectangle.js
                </a>
              
                
                <a class="source" href="../factory/renderAnimation.html">
                  ./source/factory/renderAnimation.js
                </a>
              
                
                <a class="source" href="../factory/shape.html">
                  ./source/factory/shape.js
                </a>
              
                
                <a class="source" href="../factory/spiral.html">
                  ./source/factory/spiral.js
                </a>
              
                
                <a class="source" href="../factory/spriteAsset.html">
                  ./source/factory/spriteAsset.js
                </a>
              
                
                <a class="source" href="../factory/stack.html">
                  ./source/factory/stack.js
                </a>
              
                
                <a class="source" href="../factory/star.html">
                  ./source/factory/star.js
                </a>
              
                
                <a class="source" href="../factory/state.html">
                  ./source/factory/state.js
                </a>
              
                
                <a class="source" href="../factory/tetragon.html">
                  ./source/factory/tetragon.js
                </a>
              
                
                <a class="source" href="../factory/ticker.html">
                  ./source/factory/ticker.js
                </a>
              
                
                <a class="source" href="../factory/tracer.html">
                  ./source/factory/tracer.js
                </a>
              
                
                <a class="source" href="../factory/tween.html">
                  ./source/factory/tween.js
                </a>
              
                
                <a class="source" href="../factory/unstackedElement.html">
                  ./source/factory/unstackedElement.js
                </a>
              
                
                <a class="source" href="../factory/vector.html">
                  ./source/factory/vector.js
                </a>
              
                
                <a class="source" href="../factory/videoAsset.html">
                  ./source/factory/videoAsset.js
                </a>
              
                
                <a class="source" href="../factory/wheel.html">
                  ./source/factory/wheel.js
                </a>
              
                
                <a class="source" href="../mixin/anchor.html">
                  ./source/mixin/anchor.js
                </a>
              
                
                <a class="source" href="../mixin/asset.html">
                  ./source/mixin/asset.js
                </a>
              
                
                <a class="source" href="../mixin/assetConsumer.html">
                  ./source/mixin/assetConsumer.js
                </a>
              
                
                <a class="source" href="../mixin/base.html">
                  ./source/mixin/base.js
                </a>
              
                
                <a class="source" href="../mixin/cascade.html">
                  ./source/mixin/cascade.js
                </a>
              
                
                <a class="source" href="../mixin/delta.html">
                  ./source/mixin/delta.js
                </a>
              
                
                <a class="source" href="../mixin/displayShape.html">
                  ./source/mixin/displayShape.js
                </a>
              
                
                <a class="source" href="../mixin/dom.html">
                  ./source/mixin/dom.js
                </a>
              
                
                <a class="source" href="../mixin/entity.html">
                  ./source/mixin/entity.js
                </a>
              
                
                <a class="source" href="../mixin/filter.html">
                  ./source/mixin/filter.js
                </a>
              
                
                <a class="source" href="../mixin/mimic.html">
                  ./source/mixin/mimic.js
                </a>
              
                
                <a class="source" href="../mixin/path.html">
                  ./source/mixin/path.js
                </a>
              
                
                <a class="source" href="../mixin/pattern.html">
                  ./source/mixin/pattern.js
                </a>
              
                
                <a class="source" href="../mixin/pivot.html">
                  ./source/mixin/pivot.js
                </a>
              
                
                <a class="source" href="../mixin/position.html">
                  ./source/mixin/position.js
                </a>
              
                
                <a class="source" href="../mixin/shapeBasic.html">
                  ./source/mixin/shapeBasic.js
                </a>
              
                
                <a class="source" href="../mixin/shapeCurve.html">
                  ./source/mixin/shapeCurve.js
                </a>
              
                
                <a class="source" href="../mixin/shapePathCalculation.html">
                  ./source/mixin/shapePathCalculation.js
                </a>
              
                
                <a class="source" href="../mixin/styles.html">
                  ./source/mixin/styles.js
                </a>
              
                
                <a class="source" href="../mixin/tween.html">
                  ./source/mixin/tween.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-1">&#x00a7;</a>
              </div>
              <h1 id="dom-event-listeners">DOM event listeners</h1>
<p>Each scrawl-canvas stack and canvas can have <strong>bespoke Scrawl-canvas listeners</strong> attached to them, to track user mouse and touch interactions with that element. Scrawl-canvas defines five bespoke listeners:</p>
<ul>
<li><strong>move</strong> - track mouse cursor and touch movements across the DOM element</li>
<li><strong>down</strong> - register a new touch interaction, or user pressing the left mouse button</li>
<li><strong>up</strong> - register the end of a touch interaction, or user releasing the left mouse button</li>
<li><strong>enter</strong> - trigger an event when the mouse cursor or touch event enters into the DOM element</li>
<li><strong>leave</strong> - trigger an event when the mouse cursor or touch event exits from the DOM element</li>
</ul>
<p>The functions all takes the following arguments:</p>
<ul>
<li><strong>evt</strong> - String name of the event (‘move’, ‘down’, ‘up’, ‘enter’, ‘leave’), or an array of such strings</li>
<li><strong>fn</strong> - the function to be called when the event listener(s) trigger</li>
<li><strong>targ</strong> - either the DOM element object, or an array of DOM element objects, or a query selector String; these elements need to be registered in the Scrawl-canvas library beforehend (done automatically for stack and canvas elements)</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-2">&#x00a7;</a>
              </div>
              <h4 id="imports">Imports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { isa_fn, isa_dom, λ<span class="hljs-literal">null</span>, Ωempty } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./utilities.js&quot;</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-3">&#x00a7;</a>
              </div>
              <p><code>Exported function</code> (to modules and scrawl object) - <strong>scrawl.makeAnimationObserver</strong> - function to create and start a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API">DOM IntersectionObserver</a> object.</p>
<p>The function expects 3 arguments, in the following order:</p>
<ul>
<li>a Scrawl-canvas animation object (required) - either <a href="../factory/Animation.html">Animation</a> or <a href="../factory/RenderAnimation.html">RenderAnimation</a></li>
<li>A Scrawl-canvas element wrapper object (required) - either <a href="../factory/Canvas.html">Canvas</a>, <a href="../factory/Stack.html">Stack</a> or <a href="../factory/Element.html">Element</a></li>
<li>A Javascript object (optional) containing options to be applied to the observer - <code>root</code>, <code>rootMargin</code>, <code>threshold</code></li>
</ul>
<p>The function returns a function which, when invoked, will disconnect the observer from the DOM.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> makeAnimationObserver = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">anim, wrapper, specs = Ωempty</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">window</span>.IntersectionObserver === <span class="hljs-string">&#x27;function&#x27;</span> &amp;&amp; anim &amp;&amp; anim.run) {

        <span class="hljs-keyword">let</span> observer = <span class="hljs-keyword">new</span> IntersectionObserver(<span class="hljs-function">(<span class="hljs-params">entries, observer</span>) =&gt;</span> {

            <span class="hljs-keyword">let</span> i, iz, entry;

            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = entries.length; i &lt; iz; i++) {

                entry = entries[i];
                <span class="hljs-keyword">if</span> (entry.isIntersecting) !anim.isRunning() &amp;&amp; anim.run();
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!entry.isIntersecting) anim.isRunning() &amp;&amp; anim.halt();
            }
        }, specs);

        <span class="hljs-keyword">if</span> (wrapper &amp;&amp; wrapper.domElement) {

            observer.observe(wrapper.domElement);
        }

        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            
            observer.disconnect();
        }
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> λ<span class="hljs-literal">null</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-4">&#x00a7;</a>
              </div>
              <p><code>Exported function</code> (to modules and scrawl object) - <strong>scrawl.addListener</strong>. Returns a kill function which, when invoked (no arguments required), will remove the event listener(s) from all DOM elements to which they have been attached.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> addListener = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt, fn, targ</span>) </span>{

    <span class="hljs-keyword">if</span> (!isa_fn(fn)) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`core/document addListener() error - no function supplied: <span class="hljs-subst">${evt}</span>, <span class="hljs-subst">${targ}</span>`</span>);

    actionListener(evt, fn, targ, <span class="hljs-string">&#x27;removeEventListener&#x27;</span>);
    actionListener(evt, fn, targ, <span class="hljs-string">&#x27;addEventListener&#x27;</span>);

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        removeListener(evt, fn, targ);
    };
};</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-5">&#x00a7;</a>
              </div>
              <p><code>Exported function</code> (to modules and scrawl object) - <strong>scrawl.removeListener</strong>. The counterpart to ‘addListener’ is <strong>removeListener</strong> which removes Scrawl-canvas event listeners from DOM elements in a similar way</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> removeListener = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt, fn, targ</span>) </span>{

    <span class="hljs-keyword">if</span> (!isa_fn(fn)) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`core/document removeListener() error - no function supplied: <span class="hljs-subst">${evt}</span>, <span class="hljs-subst">${targ}</span>`</span>);

    actionListener(evt, fn, targ, <span class="hljs-string">&#x27;removeEventListener&#x27;</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-6">&#x00a7;</a>
              </div>
              <p>Because devices and browsers differ in their approach to user interaction (mouse vs pointer vs touch), the actual functionality for adding and removing the event listeners associated with each approach is handled by dedicated actionXXXListener functions</p>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-7">&#x00a7;</a>
              </div>
              <p>TODO: code up the functionality to manage touch events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> actionListener = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt, fn, targ, action</span>) </span>{

    <span class="hljs-keyword">let</span> events = [].concat(evt),
        targets;
    
    <span class="hljs-keyword">if</span> (targ.substring) targets = <span class="hljs-built_in">document</span>.body.querySelectorAll(targ);
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(targ)) targets = targ;
    <span class="hljs-keyword">else</span> targets = [targ];

    <span class="hljs-keyword">if</span> (navigator.pointerEnabled || navigator.msPointerEnabled) actionPointerListener(events, fn, targets, action);
    <span class="hljs-keyword">else</span> actionMouseListener(events, fn, targets, action);
};

<span class="hljs-keyword">const</span> actionMouseListener = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">events, fn, targets, action</span>) </span>{

    <span class="hljs-keyword">let</span> i, iz, j, jz, myevent, target;

    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = events.length; i &lt; iz; i++) {

        myevent = events[i]; 

        <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>, jz = targets.length; j &lt; jz; j++) {

            target = targets[j];

            <span class="hljs-keyword">if</span> (isa_dom(target) || target.document || target.characterSet) {
                
                <span class="hljs-keyword">switch</span> (myevent) {
                
                    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;move&#x27;</span>:
                        target[action](<span class="hljs-string">&#x27;mousemove&#x27;</span>, fn, <span class="hljs-literal">false</span>);
                        target[action](<span class="hljs-string">&#x27;touchmove&#x27;</span>, fn, <span class="hljs-literal">false</span>);
                        target[action](<span class="hljs-string">&#x27;touchfollow&#x27;</span>, fn, <span class="hljs-literal">false</span>);
                        <span class="hljs-keyword">break</span>;

                    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;up&#x27;</span>:
                        target[action](<span class="hljs-string">&#x27;mouseup&#x27;</span>, fn, <span class="hljs-literal">false</span>);
                        target[action](<span class="hljs-string">&#x27;touchend&#x27;</span>, fn, <span class="hljs-literal">false</span>);
                        <span class="hljs-keyword">break</span>;

                    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;down&#x27;</span>:
                        target[action](<span class="hljs-string">&#x27;mousedown&#x27;</span>, fn, <span class="hljs-literal">false</span>);
                        target[action](<span class="hljs-string">&#x27;touchstart&#x27;</span>, fn, <span class="hljs-literal">false</span>);
                        <span class="hljs-keyword">break</span>;

                    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;leave&#x27;</span>:
                        target[action](<span class="hljs-string">&#x27;mouseleave&#x27;</span>, fn, <span class="hljs-literal">false</span>);
                        target[action](<span class="hljs-string">&#x27;touchleave&#x27;</span>, fn, <span class="hljs-literal">false</span>);
                        <span class="hljs-keyword">break</span>;

                    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;enter&#x27;</span>:
                        target[action](<span class="hljs-string">&#x27;mouseenter&#x27;</span>, fn, <span class="hljs-literal">false</span>);
                        target[action](<span class="hljs-string">&#x27;touchenter&#x27;</span>, fn, <span class="hljs-literal">false</span>);
                        <span class="hljs-keyword">break</span>;
                }
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`core/document actionMouseListener() error - bad target: <span class="hljs-subst">${myevent}</span>, <span class="hljs-subst">${target}</span>`</span>);
        }
    }
};

<span class="hljs-keyword">const</span> actionPointerListener = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">events, fn, targets, action</span>) </span>{

    <span class="hljs-keyword">let</span> i, iz, j, jz, myevent, target;

    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = events.length; i &lt; iz; i++) {

        myevent = events[i]; 

        <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>, jz = targets.length; j &lt; jz; j++) {

            target = targets[j];

            <span class="hljs-keyword">if</span> (isa_dom(target) || target.document || target.characterSet) {

                <span class="hljs-keyword">switch</span> (myevent) {
                
                    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;move&#x27;</span>:
                        target[action](<span class="hljs-string">&#x27;pointermove&#x27;</span>, fn, <span class="hljs-literal">false</span>);
                        <span class="hljs-keyword">break</span>;

                    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;up&#x27;</span>:
                        target[action](<span class="hljs-string">&#x27;pointerup&#x27;</span>, fn, <span class="hljs-literal">false</span>);
                        <span class="hljs-keyword">break</span>;

                    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;down&#x27;</span>:
                        target[action](<span class="hljs-string">&#x27;pointerdown&#x27;</span>, fn, <span class="hljs-literal">false</span>);
                        <span class="hljs-keyword">break</span>;

                    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;leave&#x27;</span>:
                        target[action](<span class="hljs-string">&#x27;pointerleave&#x27;</span>, fn, <span class="hljs-literal">false</span>);
                        <span class="hljs-keyword">break</span>;

                    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;enter&#x27;</span>:
                        target[action](<span class="hljs-string">&#x27;pointerenter&#x27;</span>, fn, <span class="hljs-literal">false</span>);
                        <span class="hljs-keyword">break</span>;
                }
            }
        }
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-8">&#x00a7;</a>
              </div>
              <p><strong>Any event listener</strong> can be added to a Scrawl-canvas stack or canvas DOM element. </p>
<p>The <strong>scrawl.addNativeListener</strong> function makes adding and removing these ‘native’ listeners a little easier: multiple event listeners (which all trigger the same function) can be added to multiple DOM elements (that have been registered in the Scrawl-canvas library) in a single function call.</p>
<p>The function requires three arguments:</p>
<ul>
<li><strong>evt</strong> - String name of the event (‘click’, ‘input’, ‘change’, etc), or an array of such strings</li>
<li><strong>fn</strong> - the function to be called when the event listener(s) trigger</li>
<li><strong>targ</strong> - either the DOM element object, or an array of DOM element objects, or a query selector String. Note that <code>window</code> and ``</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-9">&#x00a7;</a>
              </div>
              <p><code>Exported function</code> (to modules and scrawl object). Returns a kill function which, when invoked (no arguments required), will remove the event listener(s) from all DOM elements to which they have been attached.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> addNativeListener = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt, fn, targ</span>) </span>{

    <span class="hljs-keyword">if</span> (!isa_fn(fn)) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`core/document addNativeListener() error - no function supplied: <span class="hljs-subst">${evt}</span>, <span class="hljs-subst">${targ}</span>`</span>);

    actionNativeListener(evt, fn, targ, <span class="hljs-string">&#x27;removeEventListener&#x27;</span>);
    actionNativeListener(evt, fn, targ, <span class="hljs-string">&#x27;addEventListener&#x27;</span>);

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        removeNativeListener(evt, fn, targ);
    };
};</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-10">&#x00a7;</a>
              </div>
              <p><code>Exported function</code> (to modules and scrawl object). The counterpart to ‘addNativeListener’ is <strong>scrawl.removeNativeListener</strong> which removes event listeners from DOM elements in a similar way</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> removeNativeListener = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt, fn, targ</span>) </span>{

    <span class="hljs-keyword">if</span> (!isa_fn(fn)) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`core/document removeNativeListener() error - no function supplied: <span class="hljs-subst">${evt}</span>, <span class="hljs-subst">${targ}</span>`</span>);

    actionNativeListener(evt, fn, targ, <span class="hljs-string">&#x27;removeEventListener&#x27;</span>);
};

<span class="hljs-keyword">const</span> actionNativeListener = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt, fn, targ, action</span>) </span>{

    <span class="hljs-keyword">let</span> events = [].concat(evt),
        targets, i, iz, j, jz, myevent, target;

    <span class="hljs-keyword">if</span> (targ.substring) targets = <span class="hljs-built_in">document</span>.body.querySelectorAll(targ);
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(targ)) targets = targ;
    <span class="hljs-keyword">else</span> targets = [targ];

    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = events.length; i &lt; iz; i++) {

        myevent = events[i];

        <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>, jz = targets.length; j &lt; jz; j++) {

            target = targets[j];
            <span class="hljs-keyword">if</span> (isa_dom(target) || target.document || target.characterSet) target[action](myevent, fn, <span class="hljs-literal">false</span>);
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`core/document actionNativeListener() error - bad target: <span class="hljs-subst">${myevent}</span>, <span class="hljs-subst">${target}</span>`</span>);
        }
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-11">&#x00a7;</a>
              </div>
              <h2 id="accessibility-and-user-defined-preferences">Accessibility, and user-defined, preferences</h2>

            </div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-12">&#x00a7;</a>
              </div>
              <h4 id="demos">Demos:</h4>
<ul>
<li><a href="../../demo/canvas-033.html">Canvas-033</a> - User preferences: prefers-color-scheme; prefers-reduced-motion</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-13">&#x00a7;</a>
              </div>
              <h4 id="prefers-reduced-motion-media-query">prefers-reduced-motion media query</h4>
<p>In many devices users have the option to set a system-wide flag indicating that, wherever possible, application and website animations should be reduced and/or prevented from playing. Scrawl-canvas investigates for this setting and supplies hooks to which developers can attach hook functions defining the actions to take when reduced motion has been requested, and for whenever this setting is changed.</p>
<p>Exported function <code>reducedMotionActions</code> - <strong>we strongly recommend that, whenever a &lt;canvas&gt; scene is animated, developers call this function as part of their definition code.</strong> By default this function will run the <code>reducedMotion_reduceAction</code> function when reduced motion has been requested; in all other cases the <code>reducedMotion_noPreferenceAction</code> function will be invoked.</p>
<ul>
<li><code>reducedMotion_reduceAction</code> is by default a null-function. If actions need to be taken to reduce the speed of a canvas animation, or to stop it, then coders should replace this hook function with their own. Set using the <code>scrawl.setReduceMotionAction()</code> function</li>
<li><code>reducedMotion_noPreferenceAction</code> - again, a null function by default. Coders can replace it with their own function to revert the actions set out in their reduceAction function (for instance, to restart a canvas animation). Set using the <code>scrawl.setNoPreferenceMotionAction()</code> function</li>
</ul>
<pre><code>__Example code__

<span class="hljs-keyword">const</span> myAnimation = scrawl.makeRender({
    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;scene-animation&#x27;</span>,
    <span class="hljs-attr">target</span>: mycanvas,
    <span class="hljs-attr">delay</span>: <span class="hljs-literal">true</span>,
});

scrawl.setReduceMotionAction(<span class="hljs-function">() =&gt;</span> myAnimation.halt());
scrawl.setNoPreferenceMotionAction(<span class="hljs-function">() =&gt;</span> myAnimation.run());

scrawl.reducedMotionActions();
</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> reducedMotionMediaQuery = <span class="hljs-built_in">window</span>.matchMedia(<span class="hljs-string">&quot;(prefers-reduced-motion: reduce)&quot;</span>);

<span class="hljs-keyword">let</span> prefersReducedMotion = reducedMotionMediaQuery.matches,
    reducedMotion_reduceAction = λ<span class="hljs-literal">null</span>,
    reducedMotion_noPreferenceAction = λ<span class="hljs-literal">null</span>;

<span class="hljs-keyword">const</span> reducedMotionActions = <span class="hljs-function">() =&gt;</span> {

    <span class="hljs-keyword">if</span> (prefersReducedMotion) reducedMotion_reduceAction();
    <span class="hljs-keyword">else</span> reducedMotion_noPreferenceAction();
};

reducedMotionMediaQuery.addEventListener(<span class="hljs-string">&#x27;change&#x27;</span>, <span class="hljs-function">() =&gt;</span> {

    prefersReducedMotion = reducedMotionMediaQuery.matches;
    reducedMotionActions();
});

<span class="hljs-keyword">const</span> setReduceMotionAction = <span class="hljs-function">(<span class="hljs-params">func</span>) =&gt;</span> reducedMotion_reduceAction = func;
<span class="hljs-keyword">const</span> setNoPreferenceMotionAction = <span class="hljs-function">(<span class="hljs-params">func</span>) =&gt;</span> reducedMotion_noPreferenceAction = func;</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-14">&#x00a7;</a>
              </div>
              <h4 id="prefers-color-scheme-media-query">prefers-color-scheme media query</h4>
<p>In many devices users have the option to set a system-wide flag indicating that, wherever possible, application and website interfaces should use a dark, or light, color scheme. Scrawl-canvas investigates for this setting and supplies hooks to which developers can attach hook functions defining the actions to take when a preference has been selected, and for whenever this setting is changed. Where no selection has been made, Scrawl-canvas assumes that a light color scheme is preferred.</p>
<p>Exported function <code>colorSchemeActions</code> - depending on the user selection, the appropriate color scheme hook function is run; where no selection has been made, this will be the lightAction function.</p>
<ul>
<li><code>colorScheme_darkAction</code> is by default a null-function. If actions need to be taken to update a scene to match surrounding dark-theme designs, then coders should replace this hook function with their own. Set using the <code>scrawl.setColorSchemeDarkAction()</code> function</li>
<li><code>colorScheme_lightAction</code> - again, a null function by default. Coders can replace it with their own function to revert the actions set out in their darkAction function. Set using the <code>scrawl.setColorSchemeLightAction()</code> function</li>
</ul>
<pre><code>__Example code__

<span class="hljs-keyword">const</span> canvas = scrawl.library.mycanvas;

<span class="hljs-keyword">const</span> myBlock = scrawl.makeBlock({
    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;myThemedBlock&#x27;</span>,
    <span class="hljs-attr">start</span>: [<span class="hljs-string">&#x27;center&#x27;</span>, <span class="hljs-string">&#x27;center&#x27;</span>],
    <span class="hljs-attr">handle</span>: [<span class="hljs-string">&#x27;center&#x27;</span>, <span class="hljs-string">&#x27;center&#x27;</span>],
    <span class="hljs-attr">dimensions</span>: [<span class="hljs-string">&#x27;30%&#x27;</span>, <span class="hljs-string">&#x27;30%&#x27;</span>],
    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;fill&#x27;</span>,
});

scrawl.setColorSchemeDarkAction(<span class="hljs-function">() =&gt;</span> {
    canvas.set({ <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">&#x27;black&#x27;</span>});
    myBlock.set({ <span class="hljs-attr">fillStyle</span>: <span class="hljs-string">&#x27;white&#x27;</span>});
});

scrawl.setColorSchemeLightAction(<span class="hljs-function">() =&gt;</span> {
    canvas.set({ <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">&#x27;white&#x27;</span>});
    myBlock.set({ <span class="hljs-attr">fillStyle</span>: <span class="hljs-string">&#x27;black&#x27;</span>});
});

scrawl.colorSchemeActions();
</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> colorSchemeMediaQuery = <span class="hljs-built_in">window</span>.matchMedia(<span class="hljs-string">&quot;(prefers-color-scheme: dark)&quot;</span>);

<span class="hljs-keyword">let</span> prefersColorScheme = colorSchemeMediaQuery.matches,
    colorScheme_darkAction = λ<span class="hljs-literal">null</span>,
    colorScheme_lightAction = λ<span class="hljs-literal">null</span>;

<span class="hljs-keyword">const</span> colorSchemeActions = <span class="hljs-function">() =&gt;</span> {

    <span class="hljs-keyword">if</span> (prefersColorScheme) colorScheme_darkAction();
    <span class="hljs-keyword">else</span> colorScheme_lightAction();
};

colorSchemeMediaQuery.addEventListener(<span class="hljs-string">&#x27;change&#x27;</span>, <span class="hljs-function">() =&gt;</span> {

    prefersColorScheme = colorSchemeMediaQuery.matches;
    colorSchemeActions();
});

<span class="hljs-keyword">const</span> setColorSchemeLightAction = <span class="hljs-function">(<span class="hljs-params">func</span>) =&gt;</span> colorScheme_lightAction = func;
<span class="hljs-keyword">const</span> setColorSchemeDarkAction = <span class="hljs-function">(<span class="hljs-params">func</span>) =&gt;</span> colorScheme_darkAction = func;</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-15">&#x00a7;</a>
              </div>
              <h4 id="exports">Exports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> {
    addListener,
    removeListener,
    addNativeListener,
    removeNativeListener,

    makeAnimationObserver,

    reducedMotionActions,
    setReduceMotionAction,
    setNoPreferenceMotionAction,

    colorSchemeActions,
    setColorSchemeDarkAction,
    setColorSchemeLightAction,
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
